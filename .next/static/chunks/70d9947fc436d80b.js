(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,9156,(e,t,r)=>{"use strict";let s;Object.defineProperty(r,"__esModule",{value:!0}),r.parseCookie=h,r.parse=h,r.stringifyCookie=function(e,t){let r=t?.encode||encodeURIComponent,s=[];for(let t of Object.keys(e)){let a=e[t];if(void 0===a)continue;if(!n.test(t))throw TypeError(`cookie name is invalid: ${t}`);let o=r(a);if(!i.test(o))throw TypeError(`cookie val is invalid: ${a}`);s.push(`${t}=${o}`)}return s.join("; ")},r.stringifySetCookie=d,r.serialize=d,r.parseSetCookie=function(e,t){let r=t?.decode||m,s=e.length,n=f(e,0,s),i=p(e,0,n),a=-1===i?{name:"",value:r(g(e,0,n))}:{name:g(e,0,i),value:r(g(e,i+1,n))},o=n+1;for(;o<s;){let t=f(e,o,s),r=p(e,o,t),n=-1===r?g(e,o,t):g(e,o,r),i=-1===r?void 0:g(e,r+1,t);switch(n.toLowerCase()){case"httponly":a.httpOnly=!0;break;case"secure":a.secure=!0;break;case"partitioned":a.partitioned=!0;break;case"domain":a.domain=i;break;case"path":a.path=i;break;case"max-age":i&&l.test(i)&&(a.maxAge=Number(i));break;case"expires":if(!i)break;let u=new Date(i);Number.isFinite(u.valueOf())&&(a.expires=u);break;case"priority":if(!i)break;let c=i.toLowerCase();("low"===c||"medium"===c||"high"===c)&&(a.priority=c);break;case"samesite":if(!i)break;let h=i.toLowerCase();("lax"===h||"strict"===h||"none"===h)&&(a.sameSite=h)}o=t+1}return a},r.stringifySetCookie=d,r.serialize=d;let n=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,i=/^[\u0021-\u003A\u003C-\u007E]*$/,a=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,o=/^[\u0020-\u003A\u003D-\u007E]*$/,l=/^-?\d+$/,u=Object.prototype.toString,c=((s=function(){}).prototype=Object.create(null),s);function h(e,t){let r=new c,s=e.length;if(s<2)return r;let n=t?.decode||m,i=0;do{let t=p(e,i,s);if(-1===t)break;let a=f(e,i,s);if(t>a){i=e.lastIndexOf(";",t-1)+1;continue}let o=g(e,i,t);void 0===r[o]&&(r[o]=n(g(e,t+1,a))),i=a+1}while(i<s)return r}function d(e,t,r){let s="object"==typeof e?e:{...r,name:e,value:String(t)},l=("object"==typeof t?t:r)?.encode||encodeURIComponent;if(!n.test(s.name))throw TypeError(`argument name is invalid: ${s.name}`);let c=s.value?l(s.value):"";if(!i.test(c))throw TypeError(`argument val is invalid: ${s.value}`);let h=s.name+"="+c;if(void 0!==s.maxAge){if(!Number.isInteger(s.maxAge))throw TypeError(`option maxAge is invalid: ${s.maxAge}`);h+="; Max-Age="+s.maxAge}if(s.domain){if(!a.test(s.domain))throw TypeError(`option domain is invalid: ${s.domain}`);h+="; Domain="+s.domain}if(s.path){if(!o.test(s.path))throw TypeError(`option path is invalid: ${s.path}`);h+="; Path="+s.path}if(s.expires){var d;if(d=s.expires,"[object Date]"!==u.call(d)||!Number.isFinite(s.expires.valueOf()))throw TypeError(`option expires is invalid: ${s.expires}`);h+="; Expires="+s.expires.toUTCString()}if(s.httpOnly&&(h+="; HttpOnly"),s.secure&&(h+="; Secure"),s.partitioned&&(h+="; Partitioned"),s.priority)switch("string"==typeof s.priority?s.priority.toLowerCase():void 0){case"low":h+="; Priority=Low";break;case"medium":h+="; Priority=Medium";break;case"high":h+="; Priority=High";break;default:throw TypeError(`option priority is invalid: ${s.priority}`)}if(s.sameSite)switch("string"==typeof s.sameSite?s.sameSite.toLowerCase():s.sameSite){case!0:case"strict":h+="; SameSite=Strict";break;case"lax":h+="; SameSite=Lax";break;case"none":h+="; SameSite=None";break;default:throw TypeError(`option sameSite is invalid: ${s.sameSite}`)}return h}function f(e,t,r){let s=e.indexOf(";",t);return -1===s?r:s}function p(e,t,r){let s=e.indexOf("=",t);return s<r?s:-1}function g(e,t,r){let s=t,n=r;do{let t=e.charCodeAt(s);if(32!==t&&9!==t)break}while(++s<n)for(;n>s;){let t=e.charCodeAt(n-1);if(32!==t&&9!==t)break;n--}return e.slice(s,n)}function m(e){if(-1===e.indexOf("%"))return e;try{return decodeURIComponent(e)}catch(t){return e}}},52683,(e,t,r)=>{},80613,e=>{"use strict";let t,r;var s,n,i,a,o,l,u,c,h,d,f,p,g,m,y,w,v,b,_,S,k,E,T,O,R,j,x,A,C,I,$,P,N,U=e.i(43476),D=e.i(71645),B=e.i(41710),L=e.i(92181),M=e.i(33372),q=e.i(45288),V=e.i(26200),F=e.i(98526),W=e.i(7670),K=e.i(89549),z=e.i(21879),G=e.i(44662),H=e.i(84660);let[J,Y]=(0,H.createSafeContext)("ModalBase component was not found in tree"),X=(0,D.forwardRef)(({className:e,...t},r)=>{let s,n=(s=Y(),(0,D.useEffect)(()=>(s.setBodyMounted(!0),()=>s.setBodyMounted(!1)),[]),s.getBodyId()),i=Y();return(0,U.jsx)(G.Box,{ref:r,...t,id:n,className:(0,W.default)({m_5df29311:!i.unstyled},e)})});X.displayName="@mantine/core/ModalBaseBody";let[Z,Q]=(0,H.createSafeContext)("Modal component was not found in tree");var ee={root:"m_9df02822",content:"m_54c44539",inner:"m_1f958f16",header:"m_d0e2b9cd"};let et=(0,z.factory)((e,t)=>{let{classNames:r,className:s,style:n,styles:i,vars:a,...o}=(0,K.useProps)("ModalBody",null,e),l=Q();return(0,U.jsx)(X,{ref:t,...l.getStyles("body",{classNames:r,style:n,styles:i,className:s}),...o})});et.classes=ee,et.displayName="@mantine/core/ModalBody";var er=e.i(27556);let es=(0,D.forwardRef)(({className:e,onClick:t,...r},s)=>{let n=Y();return(0,U.jsx)(er.CloseButton,{ref:s,...r,onClick:e=>{n.onClose(),t?.(e)},className:(0,W.default)({m_606cb269:!n.unstyled},e),unstyled:n.unstyled})});es.displayName="@mantine/core/ModalBaseCloseButton";let en=(0,z.factory)((e,t)=>{let{classNames:r,className:s,style:n,styles:i,vars:a,...o}=(0,K.useProps)("ModalCloseButton",null,e),l=Q();return(0,U.jsx)(es,{ref:t,...l.getStyles("close",{classNames:r,style:n,styles:i,className:s}),...o})});en.classes=ee,en.displayName="@mantine/core/ModalCloseButton";var ei=e.i(82451),ea=e.i(47167);let eo=/input|select|textarea|button|object/,el="a, input, select, textarea, button, object, [tabindex]";function eu(e){let t=e.getAttribute("tabindex");return null===t&&(t=void 0),parseInt(t,10)}function ec(e){let t=e.nodeName.toLowerCase(),r=!Number.isNaN(eu(e));return(eo.test(t)&&!e.disabled||e instanceof HTMLAnchorElement&&e.href||r)&&function(e){if(e.getAttribute("aria-hidden")||e.getAttribute("hidden")||"hidden"===e.getAttribute("type"))return!1;let t=e;for(;t&&t!==document.body&&11!==t.nodeType;){if("none"===t.style.display)return!1;t=t.parentNode}return!0}(e)}function eh(e){let t=eu(e);return(Number.isNaN(t)||t>=0)&&ec(e)}var ed=e.i(31316),ef=e.i(95991),ep=e.i(14037),eg={root:"m_515a97f8"};let em=(0,z.factory)((e,t)=>{let r=(0,K.useProps)("VisuallyHidden",null,e),{classNames:s,className:n,style:i,styles:a,unstyled:o,vars:l,attributes:u,...c}=r,h=(0,ep.useStyles)({name:"VisuallyHidden",classes:eg,props:r,className:n,style:i,classNames:s,styles:a,unstyled:o,attributes:u});return(0,U.jsx)(G.Box,{component:"span",ref:t,...h("root"),...c})});function ey({children:e,active:t=!0,refProp:r="ref",innerRef:s}){let n,i=function(e=!0){let t=(0,D.useRef)(null),r=e=>{let t=e.querySelector("[data-autofocus]");if(!t){let r=Array.from(e.querySelectorAll(el));!(t=r.find(eh)||r.find(ec)||null)&&ec(e)&&(t=e)}t&&t.focus({preventScroll:!0})},s=(0,D.useCallback)(s=>{e&&null!==s&&t.current!==s&&(s?(setTimeout(()=>{s.getRootNode()&&r(s)}),t.current=s):t.current=null)},[e]);return(0,D.useEffect)(()=>{if(!e)return;t.current&&setTimeout(()=>r(t.current));let s=e=>{"Tab"===e.key&&t.current&&function(e,t){let r=Array.from(e.querySelectorAll(el)).filter(eh);if(!r.length)return t.preventDefault();let s=r[t.shiftKey?0:r.length-1],n=e.getRootNode(),i=s===n.activeElement||e===n.activeElement,a=n.activeElement;if("INPUT"===a.tagName&&"radio"===a.getAttribute("type")&&(i=r.filter(e=>"radio"===e.getAttribute("type")&&e.getAttribute("name")===a.getAttribute("name")).includes(s)),!i)return;t.preventDefault();let o=r[t.shiftKey?r.length-1:0];o&&o.focus()}(t.current,e)};return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)},[e]),s}(t),a=(0,ed.useMergedRef)(i,s),o=1===(n=D.Children.toArray(e)).length&&(0,ef.isElement)(n[0])?n[0]:null;return o?(0,D.cloneElement)(o,{[r]:a}):e}function ew(e){return(0,U.jsx)(em,{tabIndex:-1,"data-autofocus":!0,...e})}em.classes=eg,em.displayName="@mantine/core/VisuallyHidden",ey.displayName="@mantine/core/FocusTrap",ew.displayName="@mantine/core/FocusTrapInitialFocus",ey.InitialFocus=ew;var ev=e.i(55150),eb=e.i(98193);let e_=(0,D.forwardRef)(({transitionProps:e,className:t,innerProps:r,onKeyDown:s,style:n,...i},a)=>{let o=Y();return(0,U.jsx)(eb.Transition,{mounted:o.opened,transition:"pop",...o.transitionProps,onExited:()=>{o.onExitTransitionEnd?.(),o.transitionProps?.onExited?.()},onEntered:()=>{o.onEnterTransitionEnd?.(),o.transitionProps?.onEntered?.()},...e,children:e=>(0,U.jsx)("div",{...r,className:(0,W.default)({m_60c222c7:!o.unstyled},r.className),children:(0,U.jsx)(ey,{active:o.opened&&o.trapFocus,innerRef:a,children:(0,U.jsx)(ev.Paper,{...i,component:"section",role:"dialog",tabIndex:-1,"aria-modal":!0,"aria-describedby":o.bodyMounted?o.getBodyId():void 0,"aria-labelledby":o.titleMounted?o.getTitleId():void 0,style:[n,e],className:(0,W.default)({m_fd1ab0aa:!o.unstyled},t),unstyled:o.unstyled,children:i.children})})})})});function eS({children:e}){return(0,U.jsx)(U.Fragment,{children:e})}e_.displayName="@mantine/core/ModalBaseContent";let ek=(0,z.factory)((e,t)=>{let{classNames:r,className:s,style:n,styles:i,vars:a,children:o,__hidden:l,...u}=(0,K.useProps)("ModalContent",null,e),c=Q(),h=c.scrollAreaComponent||eS;return(0,U.jsx)(e_,{...c.getStyles("content",{className:s,style:n,styles:i,classNames:r}),innerProps:c.getStyles("inner",{className:s,style:n,styles:i,classNames:r}),"data-full-screen":c.fullScreen||void 0,"data-modal-content":!0,"data-hidden":l||void 0,ref:t,...u,children:(0,U.jsx)(h,{style:{maxHeight:c.fullScreen?"100dvh":`calc(100dvh - (${(0,ei.rem)(c.yOffset)} * 2))`},children:o})})});ek.classes=ee,ek.displayName="@mantine/core/ModalContent";let eE=(0,D.forwardRef)(({className:e,...t},r)=>{let s=Y();return(0,U.jsx)(G.Box,{component:"header",ref:r,className:(0,W.default)({m_b5489c3c:!s.unstyled},e),...t})});eE.displayName="@mantine/core/ModalBaseHeader";let eT=(0,z.factory)((e,t)=>{let{classNames:r,className:s,style:n,styles:i,vars:a,...o}=(0,K.useProps)("ModalHeader",null,e),l=Q();return(0,U.jsx)(eE,{ref:t,...l.getStyles("header",{classNames:r,style:n,styles:i,className:s}),...o})});eT.classes=ee,eT.displayName="@mantine/core/ModalHeader";var eO=e.i(13029);let eR={duration:200,timingFunction:"ease",transition:"fade"},ej=(0,D.forwardRef)(({onClick:e,transitionProps:t,style:r,visible:s,...n},i)=>{let a,o=Y(),l=(a=Y(),{...eR,...a.transitionProps,...t});return(0,U.jsx)(eb.Transition,{mounted:void 0!==s?s:o.opened,...l,transition:"fade",children:t=>(0,U.jsx)(eO.Overlay,{ref:i,fixed:!0,style:[r,t],zIndex:o.zIndex,unstyled:o.unstyled,onClick:t=>{e?.(t),o.closeOnClickOutside&&o.onClose()},...n})})});ej.displayName="@mantine/core/ModalBaseOverlay";let ex=(0,z.factory)((e,t)=>{let{classNames:r,className:s,style:n,styles:i,vars:a,...o}=(0,K.useProps)("ModalOverlay",null,e),l=Q();return(0,U.jsx)(ej,{ref:t,...l.getStyles("overlay",{classNames:r,style:n,styles:i,className:s}),...o})});ex.classes=ee,ex.displayName="@mantine/core/ModalOverlay";var eA=e.i(24848),eC=e.i(43798),eI=e.i(90571),e$="right-scroll-bar-position",eP="width-before-scroll-bar";function eN(e,t){return"function"==typeof e?e(t):e&&(e.current=t),e}var eU="undefined"!=typeof window?D.useLayoutEffect:D.useEffect,eD=new WeakMap,eB=(void 0===s&&(s={}),(void 0===n&&(n=function(e){return e}),i=[],a=!1,o={read:function(){if(a)throw Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return i.length?i[i.length-1]:null},useMedium:function(e){var t=n(e,a);return i.push(t),function(){i=i.filter(function(e){return e!==t})}},assignSyncMedium:function(e){for(a=!0;i.length;){var t=i;i=[],t.forEach(e)}i={push:function(t){return e(t)},filter:function(){return i}}},assignMedium:function(e){a=!0;var t=[];if(i.length){var r=i;i=[],r.forEach(e),t=i}var s=function(){var r=t;t=[],r.forEach(e)},n=function(){return Promise.resolve().then(s)};n(),i={push:function(e){t.push(e),n()},filter:function(e){return t=t.filter(e),i}}}}).options=(0,eI.__assign)({async:!0,ssr:!1},s),o),eL=function(){},eM=D.forwardRef(function(e,t){var r,s,n,i,a=D.useRef(null),o=D.useState({onScrollCapture:eL,onWheelCapture:eL,onTouchMoveCapture:eL}),l=o[0],u=o[1],c=e.forwardProps,h=e.children,d=e.className,f=e.removeScrollBar,p=e.enabled,g=e.shards,m=e.sideCar,y=e.noRelative,w=e.noIsolation,v=e.inert,b=e.allowPinchZoom,_=e.as,S=e.gapMode,k=(0,eI.__rest)(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),E=(r=[a,t],s=function(e){return r.forEach(function(t){return eN(t,e)})},(n=(0,D.useState)(function(){return{value:null,callback:s,facade:{get current(){return n.value},set current(value){var e=n.value;e!==value&&(n.value=value,n.callback(value,e))}}}})[0]).callback=s,i=n.facade,eU(function(){var e=eD.get(i);if(e){var t=new Set(e),s=new Set(r),n=i.current;t.forEach(function(e){s.has(e)||eN(e,null)}),s.forEach(function(e){t.has(e)||eN(e,n)})}eD.set(i,r)},[r]),i),T=(0,eI.__assign)((0,eI.__assign)({},k),l);return D.createElement(D.Fragment,null,p&&D.createElement(m,{sideCar:eB,removeScrollBar:f,shards:g,noRelative:y,noIsolation:w,inert:v,setCallbacks:u,allowPinchZoom:!!b,lockRef:a,gapMode:S}),c?D.cloneElement(D.Children.only(h),(0,eI.__assign)((0,eI.__assign)({},T),{ref:E})):D.createElement(void 0===_?"div":_,(0,eI.__assign)({},T,{className:d,ref:E}),h))});eM.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},eM.classNames={fullWidth:eP,zeroRight:e$};var eq=function(e){var t=e.sideCar,r=(0,eI.__rest)(e,["sideCar"]);if(!t)throw Error("Sidecar: please provide `sideCar` property to import the right car");var s=t.read();if(!s)throw Error("Sidecar medium not found");return D.createElement(s,(0,eI.__assign)({},r))};eq.isSideCarExport=!0;var eV=function(){var e=0,t=null;return{add:function(r){if(0==e&&(t=function(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=k||("undefined"!=typeof __webpack_nonce__?__webpack_nonce__:void 0);return t&&e.setAttribute("nonce",t),e}())){var s,n;(s=t).styleSheet?s.styleSheet.cssText=r:s.appendChild(document.createTextNode(r)),n=t,(document.head||document.getElementsByTagName("head")[0]).appendChild(n)}e++},remove:function(){--e||!t||(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},eF=function(){var e=eV();return function(t,r){D.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&r])}},eW=function(){var e=eF();return function(t){return e(t.styles,t.dynamic),null}},eK={left:0,top:0,right:0,gap:0},ez=function(e){return parseInt(e||"",10)||0},eG=function(e){var t=window.getComputedStyle(document.body),r=t["padding"===e?"paddingLeft":"marginLeft"],s=t["padding"===e?"paddingTop":"marginTop"],n=t["padding"===e?"paddingRight":"marginRight"];return[ez(r),ez(s),ez(n)]},eH=function(e){if(void 0===e&&(e="margin"),"undefined"==typeof window)return eK;var t=eG(e),r=document.documentElement.clientWidth,s=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,s-r+t[2]-t[0])}},eJ=eW(),eY="data-scroll-locked",eX=function(e,t,r,s){var n=e.left,i=e.top,a=e.right,o=e.gap;return void 0===r&&(r="margin"),"\n  .".concat("with-scroll-bars-hidden"," {\n   overflow: hidden ").concat(s,";\n   padding-right: ").concat(o,"px ").concat(s,";\n  }\n  body[").concat(eY,"] {\n    overflow: hidden ").concat(s,";\n    overscroll-behavior: contain;\n    ").concat([t&&"position: relative ".concat(s,";"),"margin"===r&&"\n    padding-left: ".concat(n,"px;\n    padding-top: ").concat(i,"px;\n    padding-right: ").concat(a,"px;\n    margin-left:0;\n    margin-top:0;\n    margin-right: ").concat(o,"px ").concat(s,";\n    "),"padding"===r&&"padding-right: ".concat(o,"px ").concat(s,";")].filter(Boolean).join(""),"\n  }\n  \n  .").concat(e$," {\n    right: ").concat(o,"px ").concat(s,";\n  }\n  \n  .").concat(eP," {\n    margin-right: ").concat(o,"px ").concat(s,";\n  }\n  \n  .").concat(e$," .").concat(e$," {\n    right: 0 ").concat(s,";\n  }\n  \n  .").concat(eP," .").concat(eP," {\n    margin-right: 0 ").concat(s,";\n  }\n  \n  body[").concat(eY,"] {\n    ").concat("--removed-body-scroll-bar-size",": ").concat(o,"px;\n  }\n")},eZ=function(){var e=parseInt(document.body.getAttribute(eY)||"0",10);return isFinite(e)?e:0},eQ=function(){D.useEffect(function(){return document.body.setAttribute(eY,(eZ()+1).toString()),function(){var e=eZ()-1;e<=0?document.body.removeAttribute(eY):document.body.setAttribute(eY,e.toString())}},[])},e0=function(e){var t=e.noRelative,r=e.noImportant,s=e.gapMode,n=void 0===s?"margin":s;eQ();var i=D.useMemo(function(){return eH(n)},[n]);return D.createElement(eJ,{styles:eX(i,!t,n,r?"":"!important")})},e1=!1;if("undefined"!=typeof window)try{var e2=Object.defineProperty({},"passive",{get:function(){return e1=!0,!0}});window.addEventListener("test",e2,e2),window.removeEventListener("test",e2,e2)}catch(e){e1=!1}var e5=!!e1&&{passive:!1},e6=function(e,t){if(!(e instanceof Element))return!1;var r=window.getComputedStyle(e);return"hidden"!==r[t]&&(r.overflowY!==r.overflowX||"TEXTAREA"===e.tagName||"visible"!==r[t])},e4=function(e,t){var r=t.ownerDocument,s=t;do{if("undefined"!=typeof ShadowRoot&&s instanceof ShadowRoot&&(s=s.host),e8(e,s)){var n=e3(e,s);if(n[1]>n[2])return!0}s=s.parentNode}while(s&&s!==r.body)return!1},e8=function(e,t){return"v"===e?e6(t,"overflowY"):e6(t,"overflowX")},e3=function(e,t){return"v"===e?[t.scrollTop,t.scrollHeight,t.clientHeight]:[t.scrollLeft,t.scrollWidth,t.clientWidth]},e9=function(e,t,r,s,n){var i,a=(i=window.getComputedStyle(t).direction,"h"===e&&"rtl"===i?-1:1),o=a*s,l=r.target,u=t.contains(l),c=!1,h=o>0,d=0,f=0;do{if(!l)break;var p=e3(e,l),g=p[0],m=p[1]-p[2]-a*g;(g||m)&&e8(e,l)&&(d+=m,f+=g);var y=l.parentNode;l=y&&y.nodeType===Node.DOCUMENT_FRAGMENT_NODE?y.host:y}while(!u&&l!==document.body||u&&(t.contains(l)||t===l))return h&&(n&&1>Math.abs(d)||!n&&o>d)?c=!0:!h&&(n&&1>Math.abs(f)||!n&&-o>f)&&(c=!0),c},e7=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},te=function(e){return[e.deltaX,e.deltaY]},tt=function(e){return e&&"current"in e?e.current:e},tr=0,ts=[];let tn=(l=function(e){var t=D.useRef([]),r=D.useRef([0,0]),s=D.useRef(),n=D.useState(tr++)[0],i=D.useState(eW)[0],a=D.useRef(e);D.useEffect(function(){a.current=e},[e]),D.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(n));var t=(0,eI.__spreadArray)([e.lockRef.current],(e.shards||[]).map(tt),!0).filter(Boolean);return t.forEach(function(e){return e.classList.add("allow-interactivity-".concat(n))}),function(){document.body.classList.remove("block-interactivity-".concat(n)),t.forEach(function(e){return e.classList.remove("allow-interactivity-".concat(n))})}}},[e.inert,e.lockRef.current,e.shards]);var o=D.useCallback(function(e,t){if("touches"in e&&2===e.touches.length||"wheel"===e.type&&e.ctrlKey)return!a.current.allowPinchZoom;var n,i=e7(e),o=r.current,l="deltaX"in e?e.deltaX:o[0]-i[0],u="deltaY"in e?e.deltaY:o[1]-i[1],c=e.target,h=Math.abs(l)>Math.abs(u)?"h":"v";if("touches"in e&&"h"===h&&"range"===c.type)return!1;var d=window.getSelection(),f=d&&d.anchorNode;if(f&&(f===c||f.contains(c)))return!1;var p=e4(h,c);if(!p)return!0;if(p?n=h:(n="v"===h?"h":"v",p=e4(h,c)),!p)return!1;if(!s.current&&"changedTouches"in e&&(l||u)&&(s.current=n),!n)return!0;var g=s.current||n;return e9(g,t,e,"h"===g?l:u,!0)},[]),l=D.useCallback(function(e){if(ts.length&&ts[ts.length-1]===i){var r="deltaY"in e?te(e):e7(e),s=t.current.filter(function(t){var s;return t.name===e.type&&(t.target===e.target||e.target===t.shadowParent)&&(s=t.delta,s[0]===r[0]&&s[1]===r[1])})[0];if(s&&s.should){e.cancelable&&e.preventDefault();return}if(!s){var n=(a.current.shards||[]).map(tt).filter(Boolean).filter(function(t){return t.contains(e.target)});(n.length>0?o(e,n[0]):!a.current.noIsolation)&&e.cancelable&&e.preventDefault()}}},[]),u=D.useCallback(function(e,r,s,n){var i={name:e,delta:r,target:s,should:n,shadowParent:function(e){for(var t=null;null!==e;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}(s)};t.current.push(i),setTimeout(function(){t.current=t.current.filter(function(e){return e!==i})},1)},[]),c=D.useCallback(function(e){r.current=e7(e),s.current=void 0},[]),h=D.useCallback(function(t){u(t.type,te(t),t.target,o(t,e.lockRef.current))},[]),d=D.useCallback(function(t){u(t.type,e7(t),t.target,o(t,e.lockRef.current))},[]);D.useEffect(function(){return ts.push(i),e.setCallbacks({onScrollCapture:h,onWheelCapture:h,onTouchMoveCapture:d}),document.addEventListener("wheel",l,e5),document.addEventListener("touchmove",l,e5),document.addEventListener("touchstart",c,e5),function(){ts=ts.filter(function(e){return e!==i}),document.removeEventListener("wheel",l,e5),document.removeEventListener("touchmove",l,e5),document.removeEventListener("touchstart",c,e5)}},[]);var f=e.removeScrollBar,p=e.inert;return D.createElement(D.Fragment,null,p?D.createElement(i,{styles:"\n  .block-interactivity-".concat(n," {pointer-events: none;}\n  .allow-interactivity-").concat(n," {pointer-events: all;}\n")}):null,f?D.createElement(e0,{noRelative:e.noRelative,gapMode:e.gapMode}):null)},eB.useMedium(l),eq);var ti=D.forwardRef(function(e,t){return D.createElement(eM,(0,eI.__assign)({},e,{ref:t,sideCar:tn}))});ti.classNames=eM.classNames;var ta=e.i(95556),to=e.i(51937),tl=e.i(45500),tu=e.i(36597);let tc=(0,D.forwardRef)(({keepMounted:e,opened:t,onClose:r,id:s,transitionProps:n,onExitTransitionEnd:i,onEnterTransitionEnd:a,trapFocus:o,closeOnEscape:l,returnFocus:u,closeOnClickOutside:c,withinPortal:h,portalProps:d,lockScroll:f,children:p,zIndex:g,shadow:m,padding:y,__vars:w,unstyled:v,removeScrollProps:b,..._},S)=>{let{_id:k,titleMounted:E,bodyMounted:T,shouldLockScroll:O,setTitleMounted:R,setBodyMounted:j}=function({id:e,transitionProps:t,opened:r,trapFocus:s,closeOnEscape:n,onClose:i,returnFocus:a}){var o,l,u;let c=(0,to.useId)(e),[h,d]=(0,D.useState)(!1),[f,p]=(0,D.useState)(!1),g=function({opened:e,transitionDuration:t}){let[r,s]=(0,D.useState)(e),n=(0,D.useRef)(-1),i=(0,tu.useReducedMotion)()?0:t;return(0,D.useEffect)(()=>(e?(s(!0),window.clearTimeout(n.current)):0===i?s(!1):n.current=window.setTimeout(()=>s(!1),i),()=>window.clearTimeout(n.current)),[e,i]),r}({opened:r,transitionDuration:"number"==typeof t?.duration?t?.duration:200});return o="keydown",l=e=>{"Escape"===e.key&&n&&!e.isComposing&&r&&e.target?.getAttribute("data-mantine-stop-propagation")!=="true"&&i()},u={capture:!0},(0,D.useEffect)(()=>(window.addEventListener(o,l,u),()=>window.removeEventListener(o,l,u)),[o,l]),!function({opened:e,shouldReturnFocus:t=!0}){let r=(0,D.useRef)(null),s=()=>{r.current&&"focus"in r.current&&"function"==typeof r.current.focus&&r.current?.focus({preventScroll:!0})};(0,tl.useDidUpdate)(()=>{let n=-1,i=e=>{"Tab"===e.key&&window.clearTimeout(n)};return document.addEventListener("keydown",i),e?r.current=document.activeElement:t&&(n=window.setTimeout(s,10)),()=>{window.clearTimeout(n),document.removeEventListener("keydown",i)}},[e,t])}({opened:r,shouldReturnFocus:s&&a}),{_id:c,titleMounted:h,bodyMounted:f,shouldLockScroll:g,setTitleMounted:d,setBodyMounted:p}}({id:s,transitionProps:n,opened:t,trapFocus:o,closeOnEscape:l,onClose:r,returnFocus:u}),{key:x,...A}=b||{};return(0,U.jsx)(ta.OptionalPortal,{...d,withinPortal:h,children:(0,U.jsx)(J,{value:{opened:t,onClose:r,closeOnClickOutside:c,onExitTransitionEnd:i,onEnterTransitionEnd:a,transitionProps:{...n,keepMounted:e},getTitleId:()=>`${k}-title`,getBodyId:()=>`${k}-body`,titleMounted:E,bodyMounted:T,setTitleMounted:R,setBodyMounted:j,trapFocus:o,closeOnEscape:l,zIndex:g,unstyled:v},children:(0,U.jsx)(ti,{enabled:O&&f,...A,children:(0,U.jsx)(G.Box,{ref:S,..._,__vars:{...w,"--mb-z-index":(g||(0,F.getDefaultZIndex)("modal")).toString(),"--mb-shadow":(0,eA.getShadow)(m),"--mb-padding":(0,eA.getSpacing)(y)},children:p})},x)})})});tc.displayName="@mantine/core/ModalBase";var th=e.i(47596);let td={__staticSelector:"Modal",closeOnClickOutside:!0,withinPortal:!0,lockScroll:!0,trapFocus:!0,returnFocus:!0,closeOnEscape:!0,keepMounted:!1,zIndex:(0,F.getDefaultZIndex)("modal"),transitionProps:{duration:200,transition:"fade-down"},yOffset:"5dvh"},tf=(0,eC.createVarsResolver)((e,{radius:t,size:r,yOffset:s,xOffset:n})=>({root:{"--modal-radius":void 0===t?void 0:(0,eA.getRadius)(t),"--modal-size":(0,eA.getSize)(r,"modal-size"),"--modal-y-offset":(0,ei.rem)(s),"--modal-x-offset":(0,ei.rem)(n)}})),tp=(0,z.factory)((e,t)=>{let r=(0,K.useProps)("ModalRoot",td,e),{classNames:s,className:n,style:i,styles:a,unstyled:o,vars:l,yOffset:u,scrollAreaComponent:c,radius:h,fullScreen:d,centered:f,xOffset:p,__staticSelector:g,attributes:m,...y}=r,w=(0,ep.useStyles)({name:g,classes:ee,props:r,className:n,style:i,classNames:s,styles:a,unstyled:o,attributes:m,vars:l,varsResolver:tf});return(0,U.jsx)(Z,{value:{yOffset:u,scrollAreaComponent:c,getStyles:w,fullScreen:d},children:(0,U.jsx)(tc,{ref:t,...w("root"),"data-full-screen":d||void 0,"data-centered":f||void 0,"data-offset-scrollbars":c===th.ScrollArea.Autosize||void 0,unstyled:o,...y})})});tp.classes=ee,tp.displayName="@mantine/core/ModalRoot";let[tg,tm]=(0,e.i(92499).createOptionalContext)();function ty({children:e}){let[t,r]=(0,D.useState)([]),[s,n]=(0,D.useState)((0,F.getDefaultZIndex)("modal"));return(0,U.jsx)(tg,{value:{stack:t,addModal:(e,t)=>{r(t=>[...new Set([...t,e])]),n(e=>"number"==typeof t&&"number"==typeof e?Math.max(e,t):e)},removeModal:e=>r(t=>t.filter(t=>t!==e)),getZIndex:e=>`calc(${s} + ${t.indexOf(e)} + 1)`,currentId:t[t.length-1],maxZIndex:s},children:e})}ty.displayName="@mantine/core/ModalStack";let tw=(0,D.forwardRef)(({className:e,...t},r)=>{let s,n=(s=Y(),(0,D.useEffect)(()=>(s.setTitleMounted(!0),()=>s.setTitleMounted(!1)),[]),s.getTitleId()),i=Y();return(0,U.jsx)(G.Box,{component:"h2",ref:r,className:(0,W.default)({m_615af6c9:!i.unstyled},e),...t,id:n})});tw.displayName="@mantine/core/ModalBaseTitle";let tv=(0,z.factory)((e,t)=>{let{classNames:r,className:s,style:n,styles:i,vars:a,...o}=(0,K.useProps)("ModalTitle",null,e),l=Q();return(0,U.jsx)(tw,{ref:t,...l.getStyles("title",{classNames:r,style:n,styles:i,className:s}),...o})});tv.classes=ee,tv.displayName="@mantine/core/ModalTitle";let tb={closeOnClickOutside:!0,withinPortal:!0,lockScroll:!0,trapFocus:!0,returnFocus:!0,closeOnEscape:!0,keepMounted:!1,zIndex:(0,F.getDefaultZIndex)("modal"),transitionProps:{duration:200,transition:"fade-down"},withOverlay:!0,withCloseButton:!0},t_=(0,z.factory)((e,t)=>{let{title:r,withOverlay:s,overlayProps:n,withCloseButton:i,closeButtonProps:a,children:o,radius:l,opened:u,stackId:c,zIndex:h,...d}=(0,K.useProps)("Modal",tb,e),f=tm(),p=!!r||i,g=f&&c?{closeOnEscape:f.currentId===c,trapFocus:f.currentId===c,zIndex:f.getZIndex(c)}:{},m=!1!==s&&(c&&f?f.currentId===c:u);return(0,D.useEffect)(()=>{f&&c&&(u?f.addModal(c,h||(0,F.getDefaultZIndex)("modal")):f.removeModal(c))},[u,c,h]),(0,U.jsxs)(tp,{ref:t,radius:l,opened:u,zIndex:f&&c?f.getZIndex(c):h,...d,...g,children:[s&&(0,U.jsx)(ex,{visible:m,transitionProps:f&&c?{duration:0}:void 0,...n}),(0,U.jsxs)(ek,{radius:l,__hidden:!!f&&!!c&&!!u&&c!==f.currentId,children:[p&&(0,U.jsxs)(eT,{children:[r&&(0,U.jsx)(tv,{children:r}),i&&(0,U.jsx)(en,{...a})]}),(0,U.jsx)(et,{children:o})]})]})});t_.classes=ee,t_.displayName="@mantine/core/Modal",t_.Root=tp,t_.Overlay=ex,t_.Content=ek,t_.Body=et,t_.Header=eT,t_.Title=tv,t_.CloseButton=en,t_.Stack=ty;var tS=e.i(25293);function tk(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&0>t.indexOf(s)&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,s=Object.getOwnPropertySymbols(e);n<s.length;n++)0>t.indexOf(s[n])&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(r[s[n]]=e[s[n]]);return r}function tE(){}function tT(e){return!!(e||"").match(/\d/)}function tO(e){return null==e}function tR(e){return tO(e)||"number"==typeof e&&isNaN(e)||"number"==typeof e&&!isFinite(e)}function tj(e){return e.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")}function tx(e,t){void 0===t&&(t=!0);var r="-"===e[0],s=r&&t,n=(e=e.replace("-","")).split(".");return{beforeDecimal:n[0],afterDecimal:n[1]||"",hasNegation:r,addNegation:s}}function tA(e,t,r){for(var s="",n=r?"0":"",i=0;i<=t-1;i++)s+=e[i]||n;return s}function tC(e,t){return Array(t+1).join(e)}function tI(e){var t=e+"",r="-"===t[0]?"-":"";r&&(t=t.substring(1));var s=t.split(/[eE]/g),n=s[0],i=s[1];if(!(i=Number(i)))return r+n;n=n.replace(".","");var a=1+i,o=n.length;return a<0?n="0."+tC("0",Math.abs(a))+n:a>=o?n+=tC("0",a-o):n=(n.substring(0,a)||"0")+"."+n.substring(a),r+n}function t$(e,t,r){if(-1!==["","-"].indexOf(e))return e;var s=(-1!==e.indexOf(".")||r)&&t,n=tx(e),i=n.beforeDecimal,a=n.afterDecimal,o=n.hasNegation,l=parseFloat("0."+(a||"0")),u=(a.length<=t?"0."+a:l.toFixed(t)).split("."),c=i;return i&&Number(u[0])&&(c=i.split("").reverse().reduce(function(e,t,r){return e.length>r?(Number(e[0])+Number(t)).toString()+e.substring(1,e.length):t+e},u[0])),(o?"-":"")+c+(s?".":"")+tA(u[1]||"",t,r)}function tP(e,t){if(e.value=e.value,null!==e){if(e.createTextRange){var r=e.createTextRange();return r.move("character",t),r.select(),!0}return e.selectionStart||0===e.selectionStart?(e.focus(),e.setSelectionRange(t,t),!0):(e.focus(),!1)}}(u=E||(E={})).event="event",u.props="prop";var tN=(c=function(e,t){for(var r=0,s=0,n=e.length,i=t.length;e[r]===t[r]&&r<n;)r++;for(;e[n-1-s]===t[i-1-s]&&i-s>r&&n-s>r;)s++;return{from:{start:r,end:n-s},to:{start:r,end:i-s}}},d=void 0,function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return h&&e.length===h.length&&e.every(function(e,t){return e===h[t]})?d:(h=e,d=c.apply(void 0,e))}),tU=function(e,t){var r=Math.min(e.selectionStart,t);return{from:{start:r,end:e.selectionEnd},to:{start:r,end:t}}};function tD(e){return Math.max(e.selectionStart,e.selectionEnd)}function tB(e){var t=e.currentValue,r=e.formattedValue,s=e.currentValueIndex,n=e.formattedValueIndex;return t[s]===r[n]}function tL(e,t,r,s){var n=e.length;if(t=Math.min(Math.max(t,0),n),"left"===s){for(;t>=0&&!r[t];)t--;-1===t&&(t=r.indexOf(!0))}else{for(;t<=n&&!r[t];)t++;t>n&&(t=r.lastIndexOf(!0))}return -1===t&&(t=n),t}function tM(e){for(var t=Array.from({length:e.length+1}).map(function(){return!0}),r=0,s=t.length;r<s;r++)t[r]=!!(tT(e[r])||tT(e[r-1]));return t}function tq(e,t,r,s,n,i){void 0===i&&(i=tE);var a,o,l=(a=function(e,t){var r,i;return tR(e)?(i="",r=""):r="number"==typeof e||t?s(i="number"==typeof e?tI(e):e):s(i=n(e,void 0)),{formattedValue:r,numAsString:i}},(o=(0,D.useRef)(a)).current=a,(0,D.useRef)(function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return o.current.apply(o,e)}).current),u=(0,D.useState)(function(){return l(tO(e)?t:e,r)}),c=u[0],h=u[1],d=e,f=r;tO(e)&&(d=c.numAsString,f=!0);var p=l(d,f);return(0,D.useMemo)(function(){h(p)},[p.formattedValue]),[c,function(e,t){e.formattedValue!==c.formattedValue&&h({formattedValue:e.formattedValue,numAsString:e.value}),i(e,t)}]}function tV(e){return e.replace(/[^0-9]/g,"")}function tF(e){return e}function tW(e){var t=e.type;void 0===t&&(t="text");var r=e.displayType;void 0===r&&(r="input");var s=e.customInput,n=e.renderText,i=e.getInputRef,a=e.format;void 0===a&&(a=tF);var o=e.removeFormatting;void 0===o&&(o=tV);var l=e.defaultValue,u=e.valueIsNumericString,c=e.onValueChange,h=e.isAllowed,d=e.onChange;void 0===d&&(d=tE);var f=e.onKeyDown;void 0===f&&(f=tE);var p=e.onMouseUp;void 0===p&&(p=tE);var g=e.onFocus;void 0===g&&(g=tE);var m=e.onBlur;void 0===m&&(m=tE);var y=e.value,w=e.getCaretBoundary;void 0===w&&(w=tM);var v=e.isValidInputCharacter;void 0===v&&(v=tT);var b=e.isCharacterSame,_=tk(e,["type","displayType","customInput","renderText","getInputRef","format","removeFormatting","defaultValue","valueIsNumericString","onValueChange","isAllowed","onChange","onKeyDown","onMouseUp","onFocus","onBlur","value","getCaretBoundary","isValidInputCharacter","isCharacterSame"]),S=tq(y,l,!!u,a,o,c),k=S[0],T=k.formattedValue,O=k.numAsString,R=S[1],j=(0,D.useRef)(),x=(0,D.useRef)({formattedValue:T,numAsString:O}),A=function(e,t){x.current={formattedValue:e.formattedValue,numAsString:e.value},R(e,t)},C=(0,D.useState)(!1),I=C[0],$=C[1],P=(0,D.useRef)(null),N=(0,D.useRef)({setCaretTimeout:null,focusTimeout:null});(0,D.useEffect)(function(){return $(!0),function(){clearTimeout(N.current.setCaretTimeout),clearTimeout(N.current.focusTimeout)}},[]);var U=a,B=function(e,t){var r=parseFloat(t);return{formattedValue:e,value:t,floatValue:isNaN(r)?void 0:r}},L=function(e,t,r){(0!==e.selectionStart||e.selectionEnd!==e.value.length)&&(tP(e,t),N.current.setCaretTimeout=setTimeout(function(){e.value===r&&e.selectionStart!==t&&tP(e,t)},0))},M=function(e,t,r){return tL(e,t,w(e),r)},q=function(e,t,r){var s=w(t),n=function(e,t,r,s,n,i,a){void 0===a&&(a=tB);var o=n.findIndex(function(e){return e}),l=e.slice(0,o);t||r.startsWith(l)||(t=l,r=l+r,s+=l.length);for(var u=r.length,c=e.length,h={},d=Array(u),f=0;f<u;f++){d[f]=-1;for(var p=0;p<c;p++)if(a({currentValue:r,lastValue:t,formattedValue:e,currentValueIndex:f,formattedValueIndex:p})&&!0!==h[p]){d[f]=p,h[p]=!0;break}}for(var g=s;g<u&&(-1===d[g]||!i(r[g]));)g++;var m=g===u||-1===d[g]?c:d[g];for(g=s-1;g>0&&-1===d[g];)g--;var y=-1===g||-1===d[g]?0:d[g]+1;return y>m?m:s-y<m-s?y:m}(t,T,e,r,s,v,b);return tL(t,n,s)},V=function(e){var t,r=e.formattedValue;void 0===r&&(r="");var s=e.input,n=e.source,i=e.event,a=e.numAsString;if(s){var o=e.inputValue||s.value,l=tD(s);s.value=r,void 0!==(t=q(o,r,l))&&L(s,t,r)}r!==T&&A(B(r,a),{event:i,source:n})};(0,D.useEffect)(function(){var e=x.current,t=e.formattedValue,r=e.numAsString;(T!==t||O!==r)&&A(B(T,O),{event:void 0,source:E.props})},[T,O]);var F=P.current?tD(P.current):void 0;("undefined"!=typeof window?D.useLayoutEffect:D.useEffect)(function(){var e=P.current;if(T!==x.current.formattedValue&&e){var t=q(x.current.formattedValue,T,F);e.value=T,L(e,t,T)}},[T]);var W=function(e,t,r){var s=t.target,n=Object.assign(Object.assign({},j.current?tU(j.current,s.selectionEnd):tN(T,e)),{lastValue:T}),i=o(e,n),a=U(i);if(i=o(a,void 0),h&&!h(B(a,i))){var l=t.target,u=q(e,T,tD(l));return l.value=T,L(l,u,T),!1}return V({formattedValue:a,numAsString:i,inputValue:e,event:t,source:r,input:t.target}),!0},K=function(e,t){void 0===t&&(t=0),j.current={selectionStart:e.selectionStart,selectionEnd:e.selectionEnd+t}},z=Object.assign({inputMode:I&&"undefined"!=typeof navigator&&!(navigator.platform&&/iPhone|iPod/.test(navigator.platform))?"numeric":void 0},_,{type:t,value:T,onChange:function(e){W(e.target.value,e,E.event)&&d(e),j.current=void 0},onKeyDown:function(e){var t,r=e.target,s=e.key,n=r.selectionStart,i=r.selectionEnd,a=r.value;void 0===a&&(a=""),"ArrowLeft"===s||"Backspace"===s?t=Math.max(n-1,0):"ArrowRight"===s?t=Math.min(n+1,a.length):"Delete"===s&&(t=n);var o=0;"Delete"===s&&n===i&&(o=1);var l="ArrowLeft"===s||"ArrowRight"===s;if(void 0===t||n!==i&&!l){f(e),K(r,o);return}var u=t;l?(u=M(a,t,"ArrowLeft"===s?"left":"right"))!==t&&e.preventDefault():"Delete"!==s||v(a[t])?"Backspace"!==s||v(a[t])||(u=M(a,t,"left")):u=M(a,t,"right"),u!==t&&L(r,u,a),f(e),K(r,o)},onMouseUp:function(e){var t=e.target,r=function(){var e=t.selectionStart,r=t.selectionEnd,s=t.value;if(void 0===s&&(s=""),e===r){var n=M(s,e);n!==e&&L(t,n,s)}};r(),requestAnimationFrame(function(){r()}),p(e),K(t)},onFocus:function(e){e.persist&&e.persist();var t=e.target,r=e.currentTarget;P.current=t,N.current.focusTimeout=setTimeout(function(){var s=t.selectionStart,n=t.selectionEnd,i=t.value;void 0===i&&(i="");var a=M(i,s);a!==s&&(0!==s||n!==i.length)&&L(t,a,i),g(Object.assign(Object.assign({},e),{currentTarget:r}))},0)},onBlur:function(e){P.current=null,clearTimeout(N.current.focusTimeout),clearTimeout(N.current.setCaretTimeout),m(e)}});return"text"===r?n?D.default.createElement(D.default.Fragment,null,n(T,_)||null):D.default.createElement("span",Object.assign({},_,{ref:i}),T):s?D.default.createElement(s,Object.assign({},z,{ref:i})):D.default.createElement("input",Object.assign({},z,{ref:i}))}function tK(e,t){var r,s,n,i=t.decimalScale,a=t.fixedDecimalScale,o=t.prefix;void 0===o&&(o="");var l=t.suffix;void 0===l&&(l="");var u=t.allowNegative,c=t.thousandsGroupStyle;if(void 0===c&&(c="thousand"),""===e||"-"===e)return e;var h=tz(t),d=h.thousandSeparator,f=h.decimalSeparator,p=0!==i&&-1!==e.indexOf(".")||i&&a,g=tx(e,u),m=g.beforeDecimal,y=g.afterDecimal,w=g.addNegation;return void 0!==i&&(y=tA(y,i,!!a)),d&&(r=m,s=function(e){switch(e){case"lakh":return/(\d+?)(?=(\d\d)+(\d)(?!\d))(\.\d+)?/g;case"wan":return/(\d)(?=(\d{4})+(?!\d))/g;default:return/(\d)(?=(\d{3})+(?!\d))/g}}(c),n=-1===(n=r.search(/[1-9]/))?r.length:n,m=r.substring(0,n)+r.substring(n,r.length).replace(s,"$1"+d)),o&&(m=o+m),l&&(y+=l),w&&(m="-"+m),e=m+(p&&f||"")+y}function tz(e){var t=e.decimalSeparator;void 0===t&&(t=".");var r=e.thousandSeparator,s=e.allowedDecimalSeparators;return!0===r&&(r=","),s||(s=[t,"."]),{decimalSeparator:t,thousandSeparator:r,allowedDecimalSeparators:s}}function tG(e){var t,r,s,n,i,a,o,l,u,c,h,d,f,p,g,m,y,w,v,b,_,S,k,T,O,R,j,x,A,C=((t=function(e){var t=tz(e),r=t.thousandSeparator,s=t.decimalSeparator,n=e.prefix;void 0===n&&(n="");var i=e.allowNegative;if(void 0===i&&(i=!0),r===s)throw Error("\n        Decimal separator can't be same as thousand separator.\n        thousandSeparator: "+r+' (thousandSeparator = {true} is same as thousandSeparator = ",")\n        decimalSeparator: '+s+" (default value for decimalSeparator is .)\n     ");return n.startsWith("-")&&i&&(console.error("\n      Prefix can't start with '-' when allowNegative is true.\n      prefix: "+n+"\n      allowNegative: "+i+"\n    "),i=!1),Object.assign(Object.assign({},e),{allowNegative:i})}(t=e)).decimalSeparator,t.allowedDecimalSeparators,t.thousandsGroupStyle,r=t.suffix,s=t.allowNegative,n=t.allowLeadingZeros,void 0===(i=t.onKeyDown)&&(i=tE),void 0===(a=t.onBlur)&&(a=tE),o=t.thousandSeparator,l=t.decimalScale,u=t.fixedDecimalScale,void 0===(c=t.prefix)&&(c=""),h=t.defaultValue,d=t.value,f=t.valueIsNumericString,p=t.onValueChange,g=tk(t,["decimalSeparator","allowedDecimalSeparators","thousandsGroupStyle","suffix","allowNegative","allowLeadingZeros","onKeyDown","onBlur","thousandSeparator","decimalScale","fixedDecimalScale","prefix","defaultValue","value","valueIsNumericString","onValueChange"]),y=(m=tz(t)).decimalSeparator,w=m.allowedDecimalSeparators,v=function(e){return tK(e,t)},b=function(e,r){return function(e,t,r){void 0===t&&(t={from:{start:0,end:0},to:{start:0,end:e.length},lastValue:""});var s,n,i,a,o=r.allowNegative,l=r.prefix;void 0===l&&(l="");var u=r.suffix;void 0===u&&(u="");var c=r.decimalScale,h=t.from,d=t.to,f=d.start,p=d.end,g=tz(r),m=g.allowedDecimalSeparators,y=g.decimalSeparator,w=e[p]===y;if(tT(e)&&(e===l||e===u)&&""===t.lastValue)return e;if(p-f==1&&-1!==m.indexOf(e[f])){var v=0===c?"":y;e=e.substring(0,f)+v+e.substring(f+1,e.length)}var b=function(e,t,r){var s=!1,n=!1;l.startsWith("-")?s=!1:e.startsWith("--")?(s=!1,n=!0):u.startsWith("-")&&e.length===u.length?s=!1:"-"===e[0]&&(s=!0);var i=+!!s;return n&&(i=2),i&&(e=e.substring(i),t-=i,r-=i),{value:e,start:t,end:r,hasNegation:s}},_=b(e,f,p),S=_.hasNegation;e=_.value,f=_.start,p=_.end;var k=b(t.lastValue,h.start,h.end),E=k.start,T=k.end,O=k.value,R=e.substring(f,p);e.length&&O.length&&(E>O.length-u.length||T<l.length)&&!(R&&u.startsWith(R))&&(e=O);var j=0;e.startsWith(l)?j+=l.length:f<l.length&&(j=f),e=e.substring(j),p-=j;var x=e.length,A=e.length-u.length;e.endsWith(u)?x=A:p>A?x=p:p>e.length-u.length&&(x=p),e=e.substring(0,x),void 0===(s=S?"-"+e:e)&&(s=""),n=RegExp("(-)(.)*(-)"),i=/(-)/.test(s),a=n.test(s),s=s.replace(/-/g,""),i&&!a&&o&&(s="-"+s);var C=(e=((e=s).match(RegExp("(^-)|[0-9]|"+tj(y),"g"))||[]).join("")).indexOf(y),I=tx(e=e.replace(RegExp(tj(y),"g"),function(e,t){return t===C?".":""}),o),$=I.beforeDecimal,P=I.afterDecimal,N=I.addNegation;return d.end-d.start<h.end-h.start&&""===$&&w&&!parseFloat(P)&&(e=N?"-":""),e}(e,r,t)},_=tO(d)?h:d,k=null!=f?f:(S=c,""===_||!(null==S?void 0:S.match(/\d/))&&!(null==r?void 0:r.match(/\d/))&&"string"==typeof _&&!isNaN(Number(_))),tO(d)?tO(h)||(k=k||"number"==typeof h):k=k||"number"==typeof d,j=(R=(O=tq((T=function(e){return tR(e)?e:("number"==typeof e&&(e=tI(e)),k&&"number"==typeof l)?t$(e,l,!!u):e})(d),T(h),!!k,v,b,p))[0]).numAsString,x=R.formattedValue,A=O[1],Object.assign(Object.assign({},g),{value:x,valueIsNumericString:!1,isValidInputCharacter:function(e){return e===y||tT(e)},isCharacterSame:function(e){var t=e.currentValue,r=e.lastValue,s=e.formattedValue,n=e.currentValueIndex,i=e.formattedValueIndex,a=t[n],o=s[i],h=tN(r,t).to,f=function(e){return b(e).indexOf(".")+c.length};return!(0===d&&u&&l&&t[h.start]===y&&f(t)<n&&f(s)>i)&&(!!(n>=h.start&&n<h.end&&w&&w.includes(a))&&o===y||a===o)},onValueChange:A,format:v,removeFormatting:b,getCaretBoundary:function(e){var r,s,n,i,a,o;return void 0===(s=(r=t).prefix)&&(s=""),void 0===(n=r.suffix)&&(n=""),i=Array.from({length:e.length+1}).map(function(){return!0}),a="-"===e[0],i.fill(!1,0,s.length+ +!!a),o=e.length,i.fill(!1,o-n.length+1,o+1),i},onKeyDown:function(e){var t=e.target,r=e.key,n=t.selectionStart,a=t.selectionEnd,h=t.value;if(void 0===h&&(h=""),("Backspace"===r||"Delete"===r)&&a<c.length)return void e.preventDefault();if(n!==a)return void i(e);"Backspace"===r&&"-"===h[0]&&n===c.length+1&&s&&tP(t,1),l&&u&&("Backspace"===r&&h[n-1]===y?(tP(t,n-1),e.preventDefault()):"Delete"===r&&h[n]===y&&e.preventDefault()),(null==w?void 0:w.includes(r))&&h[n]===y&&tP(t,n+1);var d=!0===o?",":o;"Backspace"===r&&h[n-1]===d&&tP(t,n-1),"Delete"===r&&h[n]===d&&tP(t,n+1),i(e)},onBlur:function(e){var r=j;r.match(/\d/g)||(r=""),n||(r=function(e){if(!e)return e;var t="-"===e[0];t&&(e=e.substring(1,e.length));var r=e.split("."),s=r[0].replace(/^0+/,"")||"0",n=r[1]||"";return(t?"-":"")+s+(n?"."+n:"")}(r)),u&&l&&(r=t$(r,l,u)),r!==j&&A({formattedValue:tK(r,t),value:r,floatValue:parseFloat(r)},{event:e,source:E.event}),a(e)}}));return D.default.createElement(tW,Object.assign({},C))}var tH=e.i(46614);function tJ(e,t,r){return void 0===t&&void 0===r?e:void 0!==t&&void 0===r?Math.max(e,t):void 0===t&&void 0!==r?Math.min(e,r):Math.min(Math.max(e,t),r)}var tY=e.i(44762),tX=e.i(8954),tZ=e.i(78565),tQ=e.i(25436);function t0({direction:e,style:t,...r}){return(0,U.jsx)("svg",{style:{width:"var(--ni-chevron-size)",height:"var(--ni-chevron-size)",transform:"up"===e?"rotate(180deg)":void 0,...t},viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r,children:(0,U.jsx)("path",{d:"M3.13523 6.15803C3.3241 5.95657 3.64052 5.94637 3.84197 6.13523L7.5 9.56464L11.158 6.13523C11.3595 5.94637 11.6759 5.95657 11.8648 6.15803C12.0536 6.35949 12.0434 6.67591 11.842 6.86477L7.84197 10.6148C7.64964 10.7951 7.35036 10.7951 7.15803 10.6148L3.15803 6.86477C2.95657 6.67591 2.94637 6.35949 3.13523 6.15803Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"})})}var t1={root:"m_e2f5cd4e",controls:"m_95e17d22",control:"m_80b4b171"};let t2=/^(0\.0*|-0(\.0*)?)$/,t5=/^-?0\d+(\.\d+)?\.?$/,t6=/\.\d*0$/;function t4(e){return"string"==typeof e&&""!==e&&!Number.isNaN(Number(e))}function t8(e){return"number"==typeof e?e<Number.MAX_SAFE_INTEGER:""===e||t4(e)&&Number(e)<Number.MAX_SAFE_INTEGER}function t3(e,t,r){return void 0===e||(void 0===t||e>=t)&&(void 0===r||e<=r)}let t9={step:1,clampBehavior:"blur",allowDecimal:!0,allowNegative:!0,withKeyboardEvents:!0,allowLeadingZeros:!0,trimLeadingZeroesOnBlur:!0,startValue:0,allowedDecimalSeparators:[".",","]},t7=(0,eC.createVarsResolver)((e,{size:t})=>({controls:{"--ni-chevron-size":(0,eA.getSize)(t,"ni-chevron-size")}})),re=(0,z.factory)((e,t)=>{let r=(0,K.useProps)("NumberInput",t9,e),{className:s,classNames:n,styles:i,unstyled:a,vars:o,onChange:l,onValueChange:u,value:c,defaultValue:h,max:d,min:f,step:p,hideControls:g,rightSection:m,isAllowed:y,clampBehavior:w,onBlur:v,allowDecimal:b,decimalScale:_,onKeyDown:S,onKeyDownCapture:k,handlersRef:E,startValue:T,disabled:O,rightSectionPointerEvents:R,allowNegative:j,readOnly:x,size:A,rightSectionWidth:C,stepHoldInterval:I,stepHoldDelay:$,allowLeadingZeros:P,withKeyboardEvents:N,trimLeadingZeroesOnBlur:B,allowedDecimalSeparators:L,attributes:M,...q}=r,V=(0,ep.useStyles)({name:"NumberInput",classes:t1,props:r,classNames:n,styles:i,unstyled:a,attributes:M,vars:o,varsResolver:t7}),{resolvedClassNames:F,resolvedStyles:z}=(0,tX.useResolvedStylesApi)({classNames:n,styles:i,props:r}),[G,H]=(0,tH.useUncontrolled)({value:c,defaultValue:h,finalValue:"",onChange:l}),J=void 0!==$&&void 0!==I,Y=(0,D.useRef)(null),X=(0,D.useRef)(null),Z=(0,D.useRef)(0),Q=e=>{let t=String(e).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return t?Math.max(0,(t[1]?t[1].length:0)-(t[2]?+t[2]:0)):0},ee=e=>{Y.current&&void 0!==e&&Y.current.setSelectionRange(e,e)},et=(0,D.useRef)(tY.noop);et.current=()=>{let e;if(!t8(G))return;let t=Math.max(Q(G),Q(p)),r=10**t;if(!t4(G)&&("number"!=typeof G||Number.isNaN(G)))e=tJ(T,f,d);else if(void 0!==d){let t=(Math.round(Number(G)*r)+Math.round(p*r))/r;e=t<=d?t:d}else e=(Math.round(Number(G)*r)+Math.round(p*r))/r;let s=e.toFixed(t);H(parseFloat(s)),u?.({floatValue:parseFloat(s),formattedValue:s,value:s},{source:"increment"}),setTimeout(()=>ee(Y.current?.value.length),0)};let er=(0,D.useRef)(tY.noop);er.current=()=>{let e;if(!t8(G))return;let t=void 0!==f?f:j?Number.MIN_SAFE_INTEGER:0,r=Math.max(Q(G),Q(p)),s=10**r;if(!t4(G)&&"number"!=typeof G||Number.isNaN(G))e=tJ(T,t,d);else{let r=(Math.round(Number(G)*s)-Math.round(p*s))/s;e=void 0!==t&&r<t?t:r}let n=e.toFixed(r);H(parseFloat(n)),u?.({floatValue:parseFloat(n),formattedValue:n,value:n},{source:"decrement"}),setTimeout(()=>ee(Y.current?.value.length),0)},(0,ed.assignRef)(E,{increment:et.current,decrement:er.current});let es=e=>{e?et.current?.():er.current?.(),Z.current+=1},en=e=>{if(es(e),J){let t="number"==typeof I?I:I(Z.current);X.current=window.setTimeout(()=>en(e),t)}},ei=(e,t)=>{e.preventDefault(),Y.current?.focus(),es(t),J&&(X.current=window.setTimeout(()=>en(t),$))},ea=()=>{X.current&&window.clearTimeout(X.current),X.current=null,Z.current=0},eo=(0,U.jsxs)("div",{...V("controls"),children:[(0,U.jsx)(tQ.UnstyledButton,{...V("control"),tabIndex:-1,"aria-hidden":!0,disabled:O||"number"==typeof G&&void 0!==d&&G>=d,mod:{direction:"up"},onMouseDown:e=>e.preventDefault(),onPointerDown:e=>{ei(e,!0)},onPointerUp:ea,onPointerLeave:ea,children:(0,U.jsx)(t0,{direction:"up"})}),(0,U.jsx)(tQ.UnstyledButton,{...V("control"),tabIndex:-1,"aria-hidden":!0,disabled:O||"number"==typeof G&&void 0!==f&&G<=f,mod:{direction:"down"},onMouseDown:e=>e.preventDefault(),onPointerDown:e=>{ei(e,!1)},onPointerUp:ea,onPointerLeave:ea,children:(0,U.jsx)(t0,{direction:"down"})})]});return(0,U.jsx)(tZ.InputBase,{component:tG,allowNegative:j,className:(0,W.default)(t1.root,s),size:A,inputMode:"decimal",...q,readOnly:x,disabled:O,value:G,getInputRef:(0,ed.useMergedRef)(t,Y),onValueChange:(e,t)=>{var r,s;"event"===t.source&&H((r=e.floatValue,s=e.value,("number"==typeof r?!(r<Number.MAX_SAFE_INTEGER):!!Number.isNaN(Number(r)))||Number.isNaN(r)||!(14>s.toString().replace(".","").length)||""===s||t2.test(e.value)||P&&t5.test(e.value)||t6.test(e.value))?e.value:e.floatValue),u?.(e,t)},rightSection:g||x||!t8(G)?m:m||eo,classNames:F,styles:z,unstyled:a,__staticSelector:"NumberInput",decimalScale:b?_:0,onKeyDown:e=>{S?.(e),!x&&N&&("ArrowUp"===e.key&&(e.preventDefault(),et.current?.()),"ArrowDown"===e.key&&(e.preventDefault(),er.current?.()))},onKeyDownCapture:e=>{if(k?.(e),"Backspace"===e.key){let t=Y.current;t&&0===t.selectionStart&&t.selectionStart===t.selectionEnd&&(e.preventDefault(),window.setTimeout(()=>ee(0),0))}},rightSectionPointerEvents:R??(O?"none":void 0),rightSectionWidth:C??`var(--ni-right-section-width-${A||"sm"})`,allowLeadingZeros:P,allowedDecimalSeparators:L,onBlur:e=>{let t,r,s=G;"blur"===w&&"number"==typeof s&&(s=tJ(s,f,d)),B&&"string"==typeof s&&15>Q(s)&&(s=Number.isNaN(r=parseFloat(t=s.toString().replace(/^0+(?=\d)/,"")))?t:r>Number.MAX_SAFE_INTEGER?void 0!==d?d:t:tJ(r,f,d)),G!==s&&H(s),v?.(e)},attributes:M,isAllowed:e=>"strict"===w?y?y(e)&&t3(e.floatValue,f,d):t3(e.floatValue,f,d):!y||y(e)})});re.classes={...tZ.InputBase.classes,...t1},re.displayName="@mantine/core/NumberInput";var rt=e.i(15259),rr=e.i(57942),rs={root:"m_347db0ec","root--dot":"m_fbd81e3d",label:"m_5add502a",section:"m_91fdda9b"};let rn=(0,eC.createVarsResolver)((e,{radius:t,color:r,gradient:s,variant:n,size:i,autoContrast:a,circle:o})=>{let l=e.variantColorResolver({color:r||e.primaryColor,theme:e,gradient:s,variant:n||"filled",autoContrast:a});return{root:{"--badge-height":(0,eA.getSize)(i,"badge-height"),"--badge-padding-x":(0,eA.getSize)(i,"badge-padding-x"),"--badge-fz":(0,eA.getSize)(i,"badge-fz"),"--badge-radius":o||void 0===t?void 0:(0,eA.getRadius)(t),"--badge-bg":r||n?l.background:void 0,"--badge-color":r||n?l.color:void 0,"--badge-bd":r||n?l.border:void 0,"--badge-dot-color":"dot"===n?(0,rt.getThemeColor)(r,e):void 0}}}),ri=(0,rr.polymorphicFactory)((e,t)=>{let r=(0,K.useProps)("Badge",null,e),{classNames:s,className:n,style:i,styles:a,unstyled:o,vars:l,radius:u,color:c,gradient:h,leftSection:d,rightSection:f,children:p,variant:g,fullWidth:m,autoContrast:y,circle:w,mod:v,attributes:b,..._}=r,S=(0,ep.useStyles)({name:"Badge",props:r,classes:rs,className:n,style:i,classNames:s,styles:a,unstyled:o,attributes:b,vars:l,varsResolver:rn});return(0,U.jsxs)(G.Box,{variant:g,mod:[{block:m,circle:w,"with-right-section":!!f,"with-left-section":!!d},v],...S("root",{variant:g}),ref:t,..._,children:[d&&(0,U.jsx)("span",{...S("section"),"data-position":"left",children:d}),(0,U.jsx)("span",{...S("label"),children:p}),f&&(0,U.jsx)("span",{...S("section"),"data-position":"right",children:f})]})});ri.classes=rs,ri.displayName="@mantine/core/Badge";var ra=e.i(73404);let[ro,rl]=(0,H.createSafeContext)("Card component was not found in tree");var ru={root:"m_e615b15f",section:"m_599a2148"};let rc=(0,rr.polymorphicFactory)((e,t)=>{let{classNames:r,className:s,style:n,styles:i,vars:a,withBorder:o,inheritPadding:l,mod:u,...c}=(0,K.useProps)("CardSection",null,e),h=rl();return(0,U.jsx)(G.Box,{ref:t,mod:[{"with-border":o,"inherit-padding":l},u],...h.getStyles("section",{className:s,style:n,styles:i,classNames:r}),...c})});rc.classes=ru,rc.displayName="@mantine/core/CardSection";let rh=(0,eC.createVarsResolver)((e,{padding:t})=>({root:{"--card-padding":(0,eA.getSpacing)(t)}})),rd=(0,rr.polymorphicFactory)((e,t)=>{let r=(0,K.useProps)("Card",null,e),{classNames:s,className:n,style:i,styles:a,unstyled:o,vars:l,children:u,padding:c,attributes:h,...d}=r,f=(0,ep.useStyles)({name:"Card",props:r,classes:ru,className:n,style:i,classNames:s,styles:a,unstyled:o,attributes:h,vars:l,varsResolver:rh}),p=D.Children.toArray(u),g=p.map((e,t)=>"object"==typeof e&&e&&"type"in e&&e.type===rc?(0,D.cloneElement)(e,{"data-first-section":0===t||void 0,"data-last-section":t===p.length-1||void 0}):e);return(0,U.jsx)(ro,{value:{getStyles:f},children:(0,U.jsx)(ev.Paper,{ref:t,unstyled:o,...f("root"),...d,children:g})})});rd.classes=ru,rd.displayName="@mantine/core/Card",rd.Section=rc;var rf=e.i(94229),rp=e.i(5142);class rg extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class rm extends rg{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class ry extends rg{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class rw extends rg{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}(f=T||(T={})).Any="any",f.ApNortheast1="ap-northeast-1",f.ApNortheast2="ap-northeast-2",f.ApSouth1="ap-south-1",f.ApSoutheast1="ap-southeast-1",f.ApSoutheast2="ap-southeast-2",f.CaCentral1="ca-central-1",f.EuCentral1="eu-central-1",f.EuWest1="eu-west-1",f.EuWest2="eu-west-2",f.EuWest3="eu-west-3",f.SaEast1="sa-east-1",f.UsEast1="us-east-1",f.UsWest1="us-west-1",f.UsWest2="us-west-2";class rv{constructor(e,{headers:t={},customFetch:r,region:s=T.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=(e=>e?(...t)=>e(...t):(...e)=>fetch(...e))(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return(0,eI.__awaiter)(this,arguments,void 0,function*(e,t={}){var r;let s,n;try{let i,{headers:a,method:o,body:l,signal:u,timeout:c}=t,h={},{region:d}=t;d||(d=this.region);let f=new URL(`${this.url}/${e}`);d&&"any"!==d&&(h["x-region"]=d,f.searchParams.set("forceFunctionRegion",d)),l&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)?"undefined"!=typeof Blob&&l instanceof Blob||l instanceof ArrayBuffer?(h["Content-Type"]="application/octet-stream",i=l):"string"==typeof l?(h["Content-Type"]="text/plain",i=l):"undefined"!=typeof FormData&&l instanceof FormData?i=l:(h["Content-Type"]="application/json",i=JSON.stringify(l)):i=l;let p=u;c&&(n=new AbortController,s=setTimeout(()=>n.abort(),c),u?(p=n.signal,u.addEventListener("abort",()=>n.abort())):p=n.signal);let g=yield this.fetch(f.toString(),{method:o||"POST",headers:Object.assign(Object.assign(Object.assign({},h),this.headers),a),body:i,signal:p}).catch(e=>{throw new rm(e)}),m=g.headers.get("x-relay-error");if(m&&"true"===m)throw new ry(g);if(!g.ok)throw new rw(g);let y=(null!=(r=g.headers.get("Content-Type"))?r:"text/plain").split(";")[0].trim();return{data:"application/json"===y?yield g.json():"application/octet-stream"===y||"application/pdf"===y?yield g.blob():"text/event-stream"===y?g:"multipart/form-data"===y?yield g.formData():yield g.text(),error:null,response:g}}catch(e){return{data:null,error:e,response:e instanceof rw||e instanceof ry?e.context:void 0}}finally{s&&clearTimeout(s)}})}}var rb=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}},r_=class{constructor(e){var t,r;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=null!=(t=e.shouldThrowOnError)&&t,this.signal=e.signal,this.isMaybeSingle=null!=(r=e.isMaybeSingle)&&r,e.fetch?this.fetch=e.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){var r=this;void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let s=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{var t,s,n,i;let a=null,o=null,l=null,u=e.status,c=e.statusText;if(e.ok){if("HEAD"!==r.method){let t=await e.text();""===t||(o="text/csv"===r.headers.get("Accept")||r.headers.get("Accept")&&(null==(n=r.headers.get("Accept"))?void 0:n.includes("application/vnd.pgrst.plan+text"))?t:JSON.parse(t))}let i=null==(t=r.headers.get("Prefer"))?void 0:t.match(/count=(exact|planned|estimated)/),h=null==(s=e.headers.get("content-range"))?void 0:s.split("/");i&&h&&h.length>1&&(l=parseInt(h[1])),r.isMaybeSingle&&"GET"===r.method&&Array.isArray(o)&&(o.length>1?(a={code:"PGRST116",details:`Results contain ${o.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},o=null,l=null,u=406,c="Not Acceptable"):o=1===o.length?o[0]:null)}else{let t=await e.text();try{a=JSON.parse(t),Array.isArray(a)&&404===e.status&&(o=[],a=null,u=200,c="OK")}catch(r){404===e.status&&""===t?(u=204,c="No Content"):a={message:t}}if(a&&r.isMaybeSingle&&(null==a||null==(i=a.details)?void 0:i.includes("0 rows"))&&(a=null,u=200,c="OK"),a&&r.shouldThrowOnError)throw new rb(a)}return{error:a,data:o,count:l,status:u,statusText:c}});return this.shouldThrowOnError||(s=s.catch(e=>{var t,r,s,n,i,a;let o="",l=null==e?void 0:e.cause;if(l){let t=null!=(r=null==l?void 0:l.message)?r:"",a=null!=(s=null==l?void 0:l.code)?s:"";o=`${null!=(n=null==e?void 0:e.name)?n:"FetchError"}: ${null==e?void 0:e.message}

Caused by: ${null!=(i=null==l?void 0:l.name)?i:"Error"}: ${t}`,a&&(o+=` (${a})`),(null==l?void 0:l.stack)&&(o+=`
${l.stack}`)}else o=null!=(a=null==e?void 0:e.stack)?a:"";return{error:{message:`${null!=(t=null==e?void 0:e.name)?t:"FetchError"}: ${null==e?void 0:e.message}`,details:o,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}returns(){return this}overrideTypes(){return this}},rS=class extends r_{select(e){let t=!1,r=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s,referencedTable:n=s}={}){let i=n?`${n}.order`:"order",a=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${void 0===r?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){let s=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:s=r}={}){let n=void 0===s?"offset":`${s}.offset`,i=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(i,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:n=!1,format:i="text"}={}){var a;let o=[e?"analyze":null,t?"verbose":null,r?"settings":null,s?"buffers":null,n?"wal":null].filter(Boolean).join("|"),l=null!=(a=this.headers.get("Accept"))?a:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${l}"; options=${o};`),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};let rk=RegExp("[,()]");var rE=class extends rS{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}regexMatch(e,t){return this.url.searchParams.append(e,`match.${t}`),this}regexIMatch(e,t){return this.url.searchParams.append(e,`imatch.${t}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}isDistinct(e,t){return this.url.searchParams.append(e,`isdistinct.${t}`),this}in(e,t){let r=Array.from(new Set(t)).map(e=>"string"==typeof e&&rk.test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}notIn(e,t){let r=Array.from(new Set(t)).map(e=>"string"==typeof e&&rk.test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`not.in.(${r})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s}={}){let n="";"plain"===s?n="pl":"phrase"===s?n="ph":"websearch"===s&&(n="w");let i=void 0===r?"":`(${r})`;return this.url.searchParams.append(e,`${n}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){let s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}},rT=class{constructor(e,{headers:t={},schema:r,fetch:s}){this.url=e,this.headers=new Headers(t),this.schema=r,this.fetch=s}select(e,t){let{head:r=!1,count:s}=null!=t?t:{},n=!1,i=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!n?"":('"'===e&&(n=!n),e)).join("");return this.url.searchParams.set("select",i),s&&this.headers.append("Prefer",`count=${s}`),new rE({method:r?"HEAD":"GET",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:r=!0}={}){var s;if(t&&this.headers.append("Prefer",`count=${t}`),r||this.headers.append("Prefer","missing=default"),Array.isArray(e)){let t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){let e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new rE({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!=(s=this.fetch)?s:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:s,defaultToNull:n=!0}={}){var i;if(this.headers.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),void 0!==t&&this.url.searchParams.set("on_conflict",t),s&&this.headers.append("Prefer",`count=${s}`),n||this.headers.append("Prefer","missing=default"),Array.isArray(e)){let t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){let e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new rE({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!=(i=this.fetch)?i:fetch})}update(e,{count:t}={}){var r;return t&&this.headers.append("Prefer",`count=${t}`),new rE({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!=(r=this.fetch)?r:fetch})}delete({count:e}={}){var t;return e&&this.headers.append("Prefer",`count=${e}`),new rE({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:null!=(t=this.fetch)?t:fetch})}},rO=class e{constructor(e,{headers:t={},schema:r,fetch:s}={}){this.url=e,this.headers=new Headers(t),this.schemaName=r,this.fetch=s}from(e){if(!e||"string"!=typeof e||""===e.trim())throw Error("Invalid relation name: relation must be a non-empty string.");return new rT(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new e(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:s=!1,count:n}={}){var i;let a,o,l=new URL(`${this.url}/rpc/${e}`);r||s?(a=r?"HEAD":"GET",Object.entries(t).filter(([e,t])=>void 0!==t).map(([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`]).forEach(([e,t])=>{l.searchParams.append(e,t)})):(a="POST",o=t);let u=new Headers(this.headers);return n&&u.set("Prefer",`count=${n}`),new rE({method:a,url:l,headers:u,schema:this.schemaName,body:o,fetch:null!=(i=this.fetch)?i:fetch})}};let rR=class{static detectEnvironment(){var t;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if(void 0!==e.g.WebSocket)return{type:"native",constructor:e.g.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null==(t=navigator.userAgent)?void 0:t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(void 0!==ea.default){let e=ea.default.versions;if(e&&e.node){let t=parseInt(e.node.replace(/^v/,"").split(".")[0]);return t>=22?void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${t} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${t} detected without native WebSocket support.`,workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){let e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{let e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch(e){return!1}}},rj="1.0.0";(p=O||(O={}))[p.connecting=0]="connecting",p[p.open=1]="open",p[p.closing=2]="closing",p[p.closed=3]="closed",(g=R||(R={})).closed="closed",g.errored="errored",g.joined="joined",g.joining="joining",g.leaving="leaving",(m=j||(j={})).close="phx_close",m.error="phx_error",m.join="phx_join",m.reply="phx_reply",m.leave="phx_leave",m.access_token="access_token",(x||(x={})).websocket="websocket",(y=A||(A={})).Connecting="connecting",y.Open="open",y.Closing="closing",y.Closed="closed";class rx{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=null!=e?e:[]}encode(e,t){return e.event!==this.BROADCAST_EVENT||e.payload instanceof ArrayBuffer||"string"!=typeof e.payload.event?t(JSON.stringify([e.join_ref,e.ref,e.topic,e.event,e.payload])):t(this._binaryEncodeUserBroadcastPush(e))}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer(null==(t=e.payload)?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,r;let s=null!=(r=null==(t=e.payload)?void 0:t.payload)?r:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,s)}_encodeJsonUserBroadcastPush(e){var t,r;let s=null!=(r=null==(t=e.payload)?void 0:t.payload)?r:{},n=new TextEncoder().encode(JSON.stringify(s)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,n)}_encodeUserBroadcastPush(e,t,r){let s=e.topic,n=null!=(f=e.ref)?f:"",i=null!=(p=e.join_ref)?p:"",a=e.payload.event,o=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},l=0===Object.keys(o).length?"":JSON.stringify(o);if(i.length>255)throw Error(`joinRef length ${i.length} exceeds maximum of 255`);if(n.length>255)throw Error(`ref length ${n.length} exceeds maximum of 255`);if(s.length>255)throw Error(`topic length ${s.length} exceeds maximum of 255`);if(a.length>255)throw Error(`userEvent length ${a.length} exceeds maximum of 255`);if(l.length>255)throw Error(`metadata length ${l.length} exceeds maximum of 255`);let u=this.USER_BROADCAST_PUSH_META_LENGTH+i.length+n.length+s.length+a.length+l.length,c=new ArrayBuffer(this.HEADER_LENGTH+u),h=new DataView(c),d=0;h.setUint8(d++,this.KINDS.userBroadcastPush),h.setUint8(d++,i.length),h.setUint8(d++,n.length),h.setUint8(d++,s.length),h.setUint8(d++,a.length),h.setUint8(d++,l.length),h.setUint8(d++,t),Array.from(i,e=>h.setUint8(d++,e.charCodeAt(0))),Array.from(n,e=>h.setUint8(d++,e.charCodeAt(0))),Array.from(s,e=>h.setUint8(d++,e.charCodeAt(0))),Array.from(a,e=>h.setUint8(d++,e.charCodeAt(0))),Array.from(l,e=>h.setUint8(d++,e.charCodeAt(0)));var f,p,g=new Uint8Array(c.byteLength+r.byteLength);return g.set(new Uint8Array(c),0),g.set(new Uint8Array(r),c.byteLength),g.buffer}decode(e,t){if(this._isArrayBuffer(e))return t(this._binaryDecode(e));if("string"==typeof e){let[r,s,n,i,a]=JSON.parse(e);return t({join_ref:r,ref:s,topic:n,event:i,payload:a})}return t({})}_binaryDecode(e){let t=new DataView(e),r=t.getUint8(0),s=new TextDecoder;if(r===this.KINDS.userBroadcast)return this._decodeUserBroadcast(e,t,s)}_decodeUserBroadcast(e,t,r){let s=t.getUint8(1),n=t.getUint8(2),i=t.getUint8(3),a=t.getUint8(4),o=this.HEADER_LENGTH+4,l=r.decode(e.slice(o,o+s));o+=s;let u=r.decode(e.slice(o,o+n));o+=n;let c=r.decode(e.slice(o,o+i));o+=i;let h=e.slice(o,e.byteLength),d=a===this.JSON_ENCODING?JSON.parse(r.decode(h)):h,f={type:this.BROADCAST_EVENT,event:u,payload:d};return i>0&&(f.meta=JSON.parse(c)),{join_ref:null,ref:null,topic:l,event:this.BROADCAST_EVENT,payload:f}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||(null==(t=null==e?void 0:e.constructor)?void 0:t.name)==="ArrayBuffer"}_pick(e,t){return e&&"object"==typeof e?Object.fromEntries(Object.entries(e).filter(([e])=>t.includes(e))):{}}}class rA{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(w=C||(C={})).abstime="abstime",w.bool="bool",w.date="date",w.daterange="daterange",w.float4="float4",w.float8="float8",w.int2="int2",w.int4="int4",w.int4range="int4range",w.int8="int8",w.int8range="int8range",w.json="json",w.jsonb="jsonb",w.money="money",w.numeric="numeric",w.oid="oid",w.reltime="reltime",w.text="text",w.time="time",w.timestamp="timestamp",w.timestamptz="timestamptz",w.timetz="timetz",w.tsrange="tsrange",w.tstzrange="tstzrange";let rC=(e,t,r={})=>{var s;let n=null!=(s=r.skipTypes)?s:[];return t?Object.keys(t).reduce((r,s)=>(r[s]=rI(s,e,t,n),r),{}):{}},rI=(e,t,r,s)=>{let n=t.find(t=>t.name===e),i=null==n?void 0:n.type,a=r[e];return i&&!s.includes(i)?r$(i,a):rP(a)},r$=(e,t)=>{if("_"===e.charAt(0))return rB(t,e.slice(1,e.length));switch(e){case C.bool:return rN(t);case C.float4:case C.float8:case C.int2:case C.int4:case C.int8:case C.numeric:case C.oid:return rU(t);case C.json:case C.jsonb:return rD(t);case C.timestamp:return rL(t);case C.abstime:case C.date:case C.daterange:case C.int4range:case C.int8range:case C.money:case C.reltime:case C.text:case C.time:case C.timestamptz:case C.timetz:case C.tsrange:case C.tstzrange:default:return rP(t)}},rP=e=>e,rN=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},rU=e=>{if("string"==typeof e){let t=parseFloat(e);if(!Number.isNaN(t))return t}return e},rD=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(e){}return e},rB=(e,t)=>{if("string"!=typeof e)return e;let r=e.length-1,s=e[r];if("{"===e[0]&&"}"===s){let s,n=e.slice(1,r);try{s=JSON.parse("["+n+"]")}catch(e){s=n?n.split(","):[]}return s.map(e=>r$(t,e))}return e},rL=e=>"string"==typeof e?e.replace(" ","T"):e,rM=e=>{let t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),""===t.pathname||"/"===t.pathname?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class rq{constructor(e,t,r={},s=1e4){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t(null==(r=this.receivedResp)?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);let e=e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}(v=I||(I={})).SYNC="sync",v.JOIN="join",v.LEAVE="leave";class rV{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},e=>{let{onJoin:t,onLeave:r,onSync:s}=this.caller;this.joinRef=this.channel._joinRef(),this.state=rV.syncState(this.state,e,t,r),this.pendingDiffs.forEach(e=>{this.state=rV.syncDiff(this.state,e,t,r)}),this.pendingDiffs=[],s()}),this.channel._on(r.diff,{},e=>{let{onJoin:t,onLeave:r,onSync:s}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=rV.syncDiff(this.state,e,t,r),s())}),this.onJoin((e,t,r)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:r})}),this.onLeave((e,t,r)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:r})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){let n=this.cloneDeep(e),i=this.transformState(t),a={},o={};return this.map(n,(e,t)=>{i[e]||(o[e]=t)}),this.map(i,(e,t)=>{let r=n[e];if(r){let s=t.map(e=>e.presence_ref),n=r.map(e=>e.presence_ref),i=t.filter(e=>0>n.indexOf(e.presence_ref)),l=r.filter(e=>0>s.indexOf(e.presence_ref));i.length>0&&(a[e]=i),l.length>0&&(o[e]=l)}else a[e]=t}),this.syncDiff(n,{joins:a,leaves:o},r,s)}static syncDiff(e,t,r,s){let{joins:n,leaves:i}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(n,(t,s)=>{var n;let i=null!=(n=e[t])?n:[];if(e[t]=this.cloneDeep(s),i.length>0){let r=e[t].map(e=>e.presence_ref),s=i.filter(e=>0>r.indexOf(e.presence_ref));e[t].unshift(...s)}r(t,i,s)}),this.map(i,(t,r)=>{let n=e[t];if(!n)return;let i=r.map(e=>e.presence_ref);n=n.filter(e=>0>i.indexOf(e.presence_ref)),e[t]=n,s(t,n,r),0===n.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return Object.getOwnPropertyNames(e=this.cloneDeep(e)).reduce((t,r)=>{let s=e[r];return"metas"in s?t[r]=s.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(b=$||($={})).ALL="*",b.INSERT="INSERT",b.UPDATE="UPDATE",b.DELETE="DELETE",(_=P||(P={})).BROADCAST="broadcast",_.PRESENCE="presence",_.POSTGRES_CHANGES="postgres_changes",_.SYSTEM="system",(S=N||(N={})).SUBSCRIBED="SUBSCRIBED",S.TIMED_OUT="TIMED_OUT",S.CLOSED="CLOSED",S.CHANNEL_ERROR="CHANNEL_ERROR";class rF{constructor(e,t={config:{}},r){var s,n;if(this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=R.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new rq(this,j.join,this.params,this.timeout),this.rejoinTimer=new rA(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=R.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=R.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=R.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=R.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=R.errored,this.rejoinTimer.scheduleTimeout())}),this._on(j.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new rV(this),this.broadcastEndpointURL=rM(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(null==(n=null==(s=this.params.config)?void 0:s.broadcast)?void 0:n.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var r,s,n;if(this.socket.isConnected()||this.socket.connect(),this.state==R.closed){let{config:{broadcast:i,presence:a,private:o}}=this.params,l=null!=(s=null==(r=this.bindings.postgres_changes)?void 0:r.map(e=>e.filter))?s:[],u=!!this.bindings[P.PRESENCE]&&this.bindings[P.PRESENCE].length>0||(null==(n=this.params.config.presence)?void 0:n.enabled)===!0,c={},h={broadcast:i,presence:Object.assign(Object.assign({},a),{enabled:u}),postgres_changes:l,private:o};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this._onError(t=>null==e?void 0:e(N.CHANNEL_ERROR,t)),this._onClose(()=>null==e?void 0:e(N.CLOSED)),this.updateJoinPayload(Object.assign({config:h},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:t})=>{var r;if(this.socket._isManualToken()||this.socket.setAuth(),void 0===t){null==e||e(N.SUBSCRIBED);return}{let s=this.bindings.postgres_changes,n=null!=(r=null==s?void 0:s.length)?r:0,i=[];for(let r=0;r<n;r++){let n=s[r],{filter:{event:a,schema:o,table:l,filter:u}}=n,c=t&&t[r];if(c&&c.event===a&&rF.isFilterValueEqual(c.schema,o)&&rF.isFilterValueEqual(c.table,l)&&rF.isFilterValueEqual(c.filter,u))i.push(Object.assign(Object.assign({},n),{id:c.id}));else{this.unsubscribe(),this.state=R.errored,null==e||e(N.CHANNEL_ERROR,Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=i,e&&e(N.SUBSCRIBED);return}}).receive("error",t=>{this.state=R.errored,null==e||e(N.CHANNEL_ERROR,Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null==e||e(N.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this.state===R.joined&&e===P.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,t,r)}async httpSend(e,t,r={}){var s;if(null==t)return Promise.reject("Payload is required for httpSend()");let n={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(n.Authorization=`Bearer ${this.socket.accessTokenValue}`);let i={method:"POST",headers:n,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,i,null!=(s=r.timeout)?s:this.timeout);if(202===a.status)return{success:!0};let o=a.statusText;try{let e=await a.json();o=e.error||e.message||o}catch(e){}return Promise.reject(Error(o))}async send(e,t={}){var r,s;if(this._canPush()||"broadcast"!==e.type)return new Promise(r=>{var s,n,i;let a=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null==(i=null==(n=null==(s=this.params)?void 0:s.config)?void 0:n.broadcast)?void 0:i.ack)||r("ok"),a.receive("ok",()=>r("ok")),a.receive("error",()=>r("error")),a.receive("timeout",()=>r("timed out"))});{console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");let{event:n,payload:i}=e,a={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(a.Authorization=`Bearer ${this.socket.accessTokenValue}`);let o={method:"POST",headers:a,body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:i,private:this.private}]})};try{let e=await this._fetchWithTimeout(this.broadcastEndpointURL,o,null!=(r=t.timeout)?r:this.timeout);return await (null==(s=e.body)?void 0:s.cancel()),e.ok?"ok":"error"}catch(e){if("AbortError"===e.name)return"timed out";return"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=R.leaving;let t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(j.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{(r=new rq(this,j.leave,{},e)).receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{null==r||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=R.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){let s=new AbortController,n=setTimeout(()=>s.abort(),r),i=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(n),i}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new rq(this,e,t,r);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){let e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,n;let i=e.toLocaleLowerCase(),{close:a,error:o,leave:l,join:u}=j;if(r&&[a,o,l,u].indexOf(i)>=0&&r!==this._joinRef())return;let c=this._onMessage(i,t,r);if(t&&!c)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?null==(s=this.bindings.postgres_changes)||s.filter(e=>{var t,r,s;return(null==(t=e.filter)?void 0:t.event)==="*"||(null==(s=null==(r=e.filter)?void 0:r.event)?void 0:s.toLocaleLowerCase())===i}).map(e=>e.callback(c,r)):null==(n=this.bindings[i])||n.filter(e=>{var r,s,n,a,o,l;if(!["broadcast","presence","postgres_changes"].includes(i))return e.type.toLocaleLowerCase()===i;if("id"in e){let i=e.id,a=null==(r=e.filter)?void 0:r.event;return i&&(null==(s=t.ids)?void 0:s.includes(i))&&("*"===a||(null==a?void 0:a.toLocaleLowerCase())===(null==(n=t.data)?void 0:n.type.toLocaleLowerCase()))}{let r=null==(o=null==(a=null==e?void 0:e.filter)?void 0:a.event)?void 0:o.toLocaleLowerCase();return"*"===r||r===(null==(l=null==t?void 0:t.event)?void 0:l.toLocaleLowerCase())}}).map(e=>{if("object"==typeof c&&"ids"in c){let e=c.data,{schema:t,table:r,commit_timestamp:s,type:n,errors:i}=e;c=Object.assign(Object.assign({},{schema:t,table:r,commit_timestamp:s,eventType:n,new:{},old:{},errors:i}),this._getPayloadRecords(e))}e.callback(c,r)})}_isClosed(){return this.state===R.closed}_isJoined(){return this.state===R.joined}_isJoining(){return this.state===R.joining}_isLeaving(){return this.state===R.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){let s=e.toLocaleLowerCase(),n={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(n):this.bindings[s]=[n],this}_off(e,t){let r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(e=>{var s;return!((null==(s=e.type)?void 0:s.toLocaleLowerCase())===r&&rF.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let r in e)if(e[r]!==t[r])return!1;return!0}static isFilterValueEqual(e,t){return(null!=e?e:void 0)===(null!=t?t:void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(j.close,{},e)}_onError(e){this._on(j.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=R.joining,this.joinPush.resend(e))}_getPayloadRecords(e){let t={new:{},old:{}};return("INSERT"===e.type||"UPDATE"===e.type)&&(t.new=rC(e.columns,e.record)),("UPDATE"===e.type||"DELETE"===e.type)&&(t.old=rC(e.columns,e.old_record)),t}}let rW=()=>{},rK=[1e3,2e3,5e3,1e4],rz=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class rG{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=1e4,this.transport=null,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=rW,this.ref=0,this.reconnectTimer=null,this.vsn=rj,this.logger=rW,this.conn=null,this.sendBuffer=[],this.serializer=new rx,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),!(null==(r=null==t?void 0:t.params)?void 0:r.apikey))throw Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${x.websocket}`,this.httpEndpoint=rM(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null==t?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=rR.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");let e=t.message;if(e.includes("Node.js"))throw Error(`${e}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`);throw Error(`WebSocket not available: ${e}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){let r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},"function"==typeof this.conn.close&&(e?this.conn.close(e,null!=t?t:""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){let t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){let e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case O.connecting:return A.Connecting;case O.open:return A.Open;case O.closing:return A.Closing;default:return A.Closed}}isConnected(){return this.connectionState()===A.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(e,t={config:{}}){let r=`realtime:${e}`,s=this.getChannels().find(e=>e.topic===r);if(s)return s;{let r=new rF(`realtime:${e}`,t,this);return this.channels.push(r),r}}push(e){let{topic:t,event:r,payload:s,ref:n}=e,i=()=>{this.encode(e,e=>{var t;null==(t=this.conn)||t.send(e)})};this.log("push",`${t} ${r} (${n})`,s),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(e){this.log("error","error in heartbeat callback",e)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(e){this.log("error","error in heartbeat callback",e)}this._wasManualDisconnect=!1,null==(e=this.conn)||e.close(1e3,"heartbeat timeout"),setTimeout(()=>{var e;this.isConnected()||null==(e=this.reconnectTimer)||e.scheduleTimeout()},100);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(e){this.log("error","error in heartbeat callback",e)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{if("phoenix"===e.topic&&"phx_reply"===e.event)try{this.heartbeatCallback("ok"===e.payload.status?"ok":"error")}catch(e){this.log("error","error in heartbeat callback",e)}e.ref&&e.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);let{topic:t,event:r,payload:s,ref:n}=e,i=n?`(${n})`:"",a=s.status||"";this.log("receive",`${a} ${t} ${r} ${i}`.trim(),s),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(r,s,n)),this._triggerStateCallbacks("message",e)})}_clearTimer(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null==(t=this.reconnectTimer)||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===O.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===O.open||this.conn.readyState===O.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(e=>{this.log("error","error waiting for auth on connect",e),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");let e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this._terminateWorker()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null==(t=this.reconnectTimer)||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(j.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;let r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{let e=new Blob([rz],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}_setConnectionState(e,t=!1){this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t,r=!1;if(e)t=e,r=!0;else if(this.accessToken)try{t=await this.accessToken()}catch(e){this.log("error","Error fetching access token from callback",e),t=this.accessTokenValue}else t=this.accessTokenValue;r?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(e=>{let r={access_token:t,version:"realtime-js/2.89.0"};t&&e.updateJoinPayload(r),e.joinedOnce&&e._isJoined()&&e._push(j.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(t=>{this.log("error",`Error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(t){this.log("error",`error in ${e} callback`,t)}})}catch(t){this.log("error",`error triggering ${e} callbacks`,t)}}_setupReconnectionTimer(){this.reconnectTimer=new rA(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},10)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,s,n,i,a,o,l,u,c,h,d;switch(this.transport=null!=(t=null==e?void 0:e.transport)?t:null,this.timeout=null!=(r=null==e?void 0:e.timeout)?r:1e4,this.heartbeatIntervalMs=null!=(s=null==e?void 0:e.heartbeatIntervalMs)?s:25e3,this.worker=null!=(n=null==e?void 0:e.worker)&&n,this.accessToken=null!=(i=null==e?void 0:e.accessToken)?i:null,this.heartbeatCallback=null!=(a=null==e?void 0:e.heartbeatCallback)?a:rW,this.vsn=null!=(o=null==e?void 0:e.vsn)?o:rj,(null==e?void 0:e.params)&&(this.params=e.params),(null==e?void 0:e.logger)&&(this.logger=e.logger),((null==e?void 0:e.logLevel)||(null==e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!=(l=null==e?void 0:e.reconnectAfterMs)?l:e=>rK[e-1]||1e4,this.vsn){case rj:this.encode=null!=(u=null==e?void 0:e.encode)?u:(e,t)=>t(JSON.stringify(e)),this.decode=null!=(c=null==e?void 0:e.decode)?c:(e,t)=>t(JSON.parse(e));break;case"2.0.0":this.encode=null!=(h=null==e?void 0:e.encode)?h:this.serializer.encode.bind(this.serializer),this.decode=null!=(d=null==e?void 0:e.decode)?d:this.serializer.decode.bind(this.serializer);break;default:throw Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if("undefined"!=typeof window&&!window.Worker)throw Error("Web Worker is not supported");this.workerUrl=null==e?void 0:e.workerUrl}}}var rH=e.i(67034),rJ=class extends Error{constructor(e,t){super(e),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown="CommitStateUnknownException"===t.icebergType||[500,502,504].includes(t.status)&&t.icebergType?.includes("CommitState")===!0}isNotFound(){return 404===this.status}isConflict(){return 409===this.status}isAuthenticationTimeout(){return 419===this.status}};async function rY(e){return e&&"none"!==e.type?"bearer"===e.type?{Authorization:`Bearer ${e.token}`}:"header"===e.type?{[e.name]:e.value}:"custom"===e.type?await e.getHeaders():{}:{}}function rX(e){return e.join("\x1f")}var rZ=class{constructor(e,t=""){this.client=e,this.prefix=t}async listNamespaces(e){let t=e?{parent:rX(e.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(e=>({namespace:e}))}async createNamespace(e,t){let r={namespace:e.namespace,properties:t?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:r})).data}async dropNamespace(e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${rX(e.namespace)}`})}async loadNamespaceMetadata(e){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${rX(e.namespace)}`})).data.properties}}async namespaceExists(e){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${rX(e.namespace)}`}),!0}catch(e){if(e instanceof rJ&&404===e.status)return!1;throw e}}async createNamespaceIfNotExists(e,t){try{return await this.createNamespace(e,t)}catch(e){if(e instanceof rJ&&409===e.status)return;throw e}}};function rQ(e){return e.join("\x1f")}var r0=class{constructor(e,t="",r){this.client=e,this.prefix=t,this.accessDelegation=r}async listTables(e){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${rQ(e.namespace)}/tables`})).data.identifiers}async createTable(e,t){let r={};return this.accessDelegation&&(r["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${rQ(e.namespace)}/tables`,body:t,headers:r})).data.metadata}async updateTable(e,t){let r=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${rQ(e.namespace)}/tables/${e.name}`,body:t});return{"metadata-location":r.data["metadata-location"],metadata:r.data.metadata}}async dropTable(e,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${rQ(e.namespace)}/tables/${e.name}`,query:{purgeRequested:String(t?.purge??!1)}})}async loadTable(e){let t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${rQ(e.namespace)}/tables/${e.name}`,headers:t})).data.metadata}async tableExists(e){let t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${rQ(e.namespace)}/tables/${e.name}`,headers:t}),!0}catch(e){if(e instanceof rJ&&404===e.status)return!1;throw e}}async createTableIfNotExists(e,t){try{return await this.createTable(e,t)}catch(r){if(r instanceof rJ&&409===r.status)return await this.loadTable({namespace:e.namespace,name:t.name});throw r}}},r1=class{constructor(e){let t="v1";e.catalogName&&(t+=`/${e.catalogName}`);const r=e.baseUrl.endsWith("/")?e.baseUrl:`${e.baseUrl}/`;this.client=function(e){let t=e.fetchImpl??globalThis.fetch;return{async request({method:r,path:s,query:n,body:i,headers:a}){let o=function(e,t,r){let s=new URL(t,e);if(r)for(let[e,t]of Object.entries(r))void 0!==t&&s.searchParams.set(e,t);return s.toString()}(e.baseUrl,s,n),l=await rY(e.auth),u=await t(o,{method:r,headers:{...i?{"Content-Type":"application/json"}:{},...l,...a},body:i?JSON.stringify(i):void 0}),c=await u.text(),h=(u.headers.get("content-type")||"").includes("application/json"),d=h&&c?JSON.parse(c):c;if(!u.ok){let e=h?d:void 0,t=e?.error;throw new rJ(t?.message??`Request failed with status ${u.status}`,{status:u.status,icebergType:t?.type,icebergCode:t?.code,details:e})}return{status:u.status,headers:u.headers,data:d}}}}({baseUrl:r,auth:e.auth,fetchImpl:e.fetch}),this.accessDelegation=e.accessDelegation?.join(","),this.namespaceOps=new rZ(this.client,t),this.tableOps=new r0(this.client,t,this.accessDelegation)}async listNamespaces(e){return this.namespaceOps.listNamespaces(e)}async createNamespace(e,t){return this.namespaceOps.createNamespace(e,t)}async dropNamespace(e){await this.namespaceOps.dropNamespace(e)}async loadNamespaceMetadata(e){return this.namespaceOps.loadNamespaceMetadata(e)}async listTables(e){return this.tableOps.listTables(e)}async createTable(e,t){return this.tableOps.createTable(e,t)}async updateTable(e,t){return this.tableOps.updateTable(e,t)}async dropTable(e,t){await this.tableOps.dropTable(e,t)}async loadTable(e){return this.tableOps.loadTable(e)}async namespaceExists(e){return this.namespaceOps.namespaceExists(e)}async tableExists(e){return this.tableOps.tableExists(e)}async createNamespaceIfNotExists(e,t){return this.namespaceOps.createNamespaceIfNotExists(e,t)}async createTableIfNotExists(e,t){return this.tableOps.createTableIfNotExists(e,t)}},r2=class extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}};function r5(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}var r6=class extends r2{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},r4=class extends r2{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}};let r8=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),r3=e=>{if(Array.isArray(e))return e.map(e=>r3(e));if("function"==typeof e||e!==Object(e))return e;let t={};return Object.entries(e).forEach(([e,r])=>{t[e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""))]=r3(r)}),t};function r9(e){return(r9="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function se(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?r7(Object(r),!0).forEach(function(t){!function(e,t,r){var s;(s=function(e,t){if("object"!=r9(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!=r9(s))return s;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"),(t="symbol"==r9(s)?s:s+"")in e)?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):r7(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let st=e=>{var t;return e.msg||e.message||e.error_description||("string"==typeof e.error?e.error:null==(t=e.error)?void 0:t.message)||JSON.stringify(e)},sr=async(e,t,r)=>{e instanceof await Response&&!(null==r?void 0:r.noResolveJson)?e.json().then(r=>{let s=e.status||500,n=(null==r?void 0:r.statusCode)||s+"";t(new r6(st(r),s,n))}).catch(e=>{t(new r4(st(e),e))}):t(new r4(st(e),e))};async function ss(e,t,r,s,n,i){return new Promise((a,o)=>{let l;e(r,(l={method:t,headers:(null==s?void 0:s.headers)||{}},"GET"===t||!i?l:((e=>{if("object"!=typeof e||null===e)return!1;let t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)})(i)?(l.headers=se({"Content-Type":"application/json"},null==s?void 0:s.headers),l.body=JSON.stringify(i)):l.body=i,(null==s?void 0:s.duplex)&&(l.duplex=s.duplex),se(se({},l),n)))).then(e=>{if(!e.ok)throw e;return(null==s?void 0:s.noResolveJson)?e:e.json()}).then(e=>a(e)).catch(e=>sr(e,o,s))})}async function sn(e,t,r,s){return ss(e,"GET",t,r,s)}async function si(e,t,r,s,n){return ss(e,"POST",t,s,n,r)}async function sa(e,t,r,s,n){return ss(e,"PUT",t,s,n,r)}async function so(e,t,r,s){return ss(e,"HEAD",t,se(se({},r),{},{noResolveJson:!0}),s)}async function sl(e,t,r,s,n){return ss(e,"DELETE",t,s,n,r)}var su=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}async execute(){try{return{data:(await this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(r5(e))return{data:null,error:e};throw e}}};t=Symbol.toStringTag;var sc=class{constructor(e,r){this.downloadFn=e,this.shouldThrowOnError=r,this[t]="BlobDownloadBuilder",this.promise=null}asStream(){return new su(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){try{return{data:await (await this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(r5(e))return{data:null,error:e};throw e}}};let sh={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},sd={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var sf=class{constructor(e,t={},r,s){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=r,this.fetch=r8(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(e,t,r,s){try{let n,i=se(se({},sd),s),a=se(se({},this.headers),"POST"===e&&{"x-upsert":String(i.upsert)}),o=i.metadata;"undefined"!=typeof Blob&&r instanceof Blob?((n=new FormData).append("cacheControl",i.cacheControl),o&&n.append("metadata",this.encodeMetadata(o)),n.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?((n=r).has("cacheControl")||n.append("cacheControl",i.cacheControl),o&&!n.has("metadata")&&n.append("metadata",this.encodeMetadata(o))):(n=r,a["cache-control"]=`max-age=${i.cacheControl}`,a["content-type"]=i.contentType,o&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(o))),("undefined"!=typeof ReadableStream&&n instanceof ReadableStream||n&&"object"==typeof n&&"pipe"in n&&"function"==typeof n.pipe)&&!i.duplex&&(i.duplex="half")),(null==s?void 0:s.headers)&&(a=se(se({},a),s.headers));let l=this._removeEmptyFolders(t),u=this._getFinalPath(l),c=await ("PUT"==e?sa:si)(this.fetch,`${this.url}/object/${u}`,n,se({headers:a},(null==i?void 0:i.duplex)?{duplex:i.duplex}:{}));return{data:{path:l,id:c.Id,fullPath:c.Key},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(r5(e))return{data:null,error:e};throw e}}async upload(e,t,r){return this.uploadOrUpdate("POST",e,t,r)}async uploadToSignedUrl(e,t,r,s){let n=this._removeEmptyFolders(e),i=this._getFinalPath(n),a=new URL(this.url+`/object/upload/sign/${i}`);a.searchParams.set("token",t);try{let e,t=se({upsert:sd.upsert},s),i=se(se({},this.headers),{"x-upsert":String(t.upsert)});return"undefined"!=typeof Blob&&r instanceof Blob?((e=new FormData).append("cacheControl",t.cacheControl),e.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(e=r).append("cacheControl",t.cacheControl):(e=r,i["cache-control"]=`max-age=${t.cacheControl}`,i["content-type"]=t.contentType),{data:{path:n,fullPath:(await sa(this.fetch,a.toString(),e,{headers:i})).Key},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(r5(e))return{data:null,error:e};throw e}}async createSignedUploadUrl(e,t){try{let r=this._getFinalPath(e),s=se({},this.headers);(null==t?void 0:t.upsert)&&(s["x-upsert"]="true");let n=await si(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),i=new URL(this.url+n.url),a=i.searchParams.get("token");if(!a)throw new r2("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:a},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(r5(e))return{data:null,error:e};throw e}}async update(e,t,r){return this.uploadOrUpdate("PUT",e,t,r)}async move(e,t,r){try{return{data:await si(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(r5(e))return{data:null,error:e};throw e}}async copy(e,t,r){try{return{data:{path:(await si(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(r5(e))return{data:null,error:e};throw e}}async createSignedUrl(e,t,r){try{let s=this._getFinalPath(e),n=await si(this.fetch,`${this.url}/object/sign/${s}`,se({expiresIn:t},(null==r?void 0:r.transform)?{transform:r.transform}:{}),{headers:this.headers}),i=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return{data:n={signedUrl:encodeURI(`${this.url}${n.signedURL}${i}`)},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(r5(e))return{data:null,error:e};throw e}}async createSignedUrls(e,t,r){var s=this;try{let n=await si(s.fetch,`${s.url}/object/sign/${s.bucketId}`,{expiresIn:t,paths:e},{headers:s.headers}),i=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return{data:n.map(e=>se(se({},e),{},{signedUrl:e.signedURL?encodeURI(`${s.url}${e.signedURL}${i}`):null})),error:null}}catch(e){if(s.shouldThrowOnError)throw e;if(r5(e))return{data:null,error:e};throw e}}download(e,t){let r=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",s=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),n=s?`?${s}`:"",i=this._getFinalPath(e);return new sc(()=>sn(this.fetch,`${this.url}/${r}/${i}${n}`,{headers:this.headers,noResolveJson:!0}),this.shouldThrowOnError)}async info(e){let t=this._getFinalPath(e);try{return{data:r3(await sn(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers})),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(r5(e))return{data:null,error:e};throw e}}async exists(e){let t=this._getFinalPath(e);try{return await so(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(r5(e)&&e instanceof r4){let t=e.originalError;if([400,404].includes(null==t?void 0:t.status))return{data:!1,error:e}}throw e}}getPublicUrl(e,t){let r=this._getFinalPath(e),s=[],n=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==n&&s.push(n);let i=void 0!==(null==t?void 0:t.transform)?"render/image":"object",a=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==a&&s.push(a);let o=s.join("&");return""!==o&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${r}${o}`)}}}async remove(e){try{return{data:await sl(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(r5(e))return{data:null,error:e};throw e}}async list(e,t,r){try{let s=se(se(se({},sh),t),{},{prefix:e||""});return{data:await si(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(r5(e))return{data:null,error:e};throw e}}async listV2(e,t){try{let r=se({},e);return{data:await si(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},t),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(r5(e))return{data:null,error:e};throw e}}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return void 0!==rH.Buffer?rH.Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){let t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}};let sp="2.89.0",sg={"X-Client-Info":`storage-js/${sp}`};var sm=class{constructor(e,t={},r,s){this.shouldThrowOnError=!1;const n=new URL(e);(null==s?void 0:s.useNewHostname)&&/supabase\.(co|in|red)$/.test(n.hostname)&&!n.hostname.includes("storage.supabase.")&&(n.hostname=n.hostname.replace("supabase.","storage.supabase.")),this.url=n.href.replace(/\/$/,""),this.headers=se(se({},sg),t),this.fetch=r8(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(e){try{let t=this.listBucketOptionsToQueryString(e);return{data:await sn(this.fetch,`${this.url}/bucket${t}`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(r5(e))return{data:null,error:e};throw e}}async getBucket(e){try{return{data:await sn(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(r5(e))return{data:null,error:e};throw e}}async createBucket(e,t={public:!1}){try{return{data:await si(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(r5(e))return{data:null,error:e};throw e}}async updateBucket(e,t){try{return{data:await sa(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(r5(e))return{data:null,error:e};throw e}}async emptyBucket(e){try{return{data:await si(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(r5(e))return{data:null,error:e};throw e}}async deleteBucket(e){try{return{data:await sl(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(r5(e))return{data:null,error:e};throw e}}listBucketOptionsToQueryString(e){let t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},sy=class{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=se(se({},sg),t),this.fetch=r8(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(e){try{return{data:await si(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(r5(e))return{data:null,error:e};throw e}}async listBuckets(e){try{let t=new URLSearchParams;(null==e?void 0:e.limit)!==void 0&&t.set("limit",e.limit.toString()),(null==e?void 0:e.offset)!==void 0&&t.set("offset",e.offset.toString()),(null==e?void 0:e.sortColumn)&&t.set("sortColumn",e.sortColumn),(null==e?void 0:e.sortOrder)&&t.set("sortOrder",e.sortOrder),(null==e?void 0:e.search)&&t.set("search",e.search);let r=t.toString(),s=r?`${this.url}/bucket?${r}`:`${this.url}/bucket`;return{data:await sn(this.fetch,s,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(r5(e))return{data:null,error:e};throw e}}async deleteBucket(e){try{return{data:await sl(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(r5(e))return{data:null,error:e};throw e}}from(e){var t=this;if(!(!(!e||"string"!=typeof e||0===e.length||e.length>100||e.trim()!==e||e.includes("/")||e.includes("\\"))&&/^[\w!.\*'() &$@=;:+,?-]+$/.test(e)))throw new r2("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");let r=new r1({baseUrl:this.url,catalogName:e,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),s=this.shouldThrowOnError;return new Proxy(r,{get(e,t){let r=e[t];return"function"!=typeof r?r:async(...t)=>{try{return{data:await r.apply(e,t),error:null}}catch(e){if(s)throw e;return{data:null,error:e}}}}})}};let sw={"X-Client-Info":`storage-js/${sp}`,"Content-Type":"application/json"};var sv=class extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function sb(e){return"object"==typeof e&&null!==e&&"__isStorageVectorsError"in e}var s_=class extends sv{constructor(e,t,r){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},sS=class extends sv{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}};let sk=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),sE=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),sT=async(e,t,r)=>{if(e&&"object"==typeof e&&"status"in e&&"ok"in e&&"number"==typeof e.status&&!(null==r?void 0:r.noResolveJson)){let r=e.status||500;"function"==typeof e.json?e.json().then(e=>{let s=(null==e?void 0:e.statusCode)||(null==e?void 0:e.code)||r+"";t(new s_(sE(e),r,s))}).catch(()=>{t(new s_(e.statusText||`HTTP ${r} error`,r,r+""))}):t(new s_(e.statusText||`HTTP ${r} error`,r,r+""))}else t(new sS(sE(e),e))};async function sO(e,t,r,s,n,i){return new Promise((a,o)=>{let l;e(r,(l={method:t,headers:(null==s?void 0:s.headers)||{}},"GET"===t||!i?l:((e=>{if("object"!=typeof e||null===e)return!1;let t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)})(i)?(l.headers=se({"Content-Type":"application/json"},null==s?void 0:s.headers),l.body=JSON.stringify(i)):l.body=i,se(se({},l),n)))).then(e=>{if(!e.ok)throw e;if(null==s?void 0:s.noResolveJson)return e;let t=e.headers.get("content-type");return t&&t.includes("application/json")?e.json():{}}).then(e=>a(e)).catch(e=>sT(e,o,s))})}async function sR(e,t,r,s,n){return sO(e,"POST",t,s,n,r)}var sj=class{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=se(se({},sw),t),this.fetch=sk(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(e){try{return{data:await sR(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers})||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(sb(e))return{data:null,error:e};throw e}}async getIndex(e,t){try{return{data:await sR(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(sb(e))return{data:null,error:e};throw e}}async listIndexes(e){try{return{data:await sR(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(sb(e))return{data:null,error:e};throw e}}async deleteIndex(e,t){try{return{data:await sR(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers})||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(sb(e))return{data:null,error:e};throw e}}},sx=class{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=se(se({},sw),t),this.fetch=sk(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(e){try{if(e.vectors.length<1||e.vectors.length>500)throw Error("Vector batch size must be between 1 and 500 items");return{data:await sR(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers})||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(sb(e))return{data:null,error:e};throw e}}async getVectors(e){try{return{data:await sR(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(sb(e))return{data:null,error:e};throw e}}async listVectors(e){try{if(void 0!==e.segmentCount){if(e.segmentCount<1||e.segmentCount>16)throw Error("segmentCount must be between 1 and 16");if(void 0!==e.segmentIndex&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:await sR(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(sb(e))return{data:null,error:e};throw e}}async queryVectors(e){try{return{data:await sR(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(sb(e))return{data:null,error:e};throw e}}async deleteVectors(e){try{if(e.keys.length<1||e.keys.length>500)throw Error("Keys batch size must be between 1 and 500 items");return{data:await sR(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers})||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(sb(e))return{data:null,error:e};throw e}}},sA=class{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=se(se({},sw),t),this.fetch=sk(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(e){try{return{data:await sR(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers})||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(sb(e))return{data:null,error:e};throw e}}async getBucket(e){try{return{data:await sR(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(sb(e))return{data:null,error:e};throw e}}async listBuckets(e={}){try{return{data:await sR(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(sb(e))return{data:null,error:e};throw e}}async deleteBucket(e){try{return{data:await sR(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers})||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(sb(e))return{data:null,error:e};throw e}}},sC=class extends sA{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new sI(this.url,this.headers,e,this.fetch)}async createBucket(e){return super.createBucket.call(this,e)}async getBucket(e){return super.getBucket.call(this,e)}async listBuckets(e={}){return super.listBuckets.call(this,e)}async deleteBucket(e){return super.deleteBucket.call(this,e)}},sI=class extends sj{constructor(e,t,r,s){super(e,t,s),this.vectorBucketName=r}async createIndex(e){return super.createIndex.call(this,se(se({},e),{},{vectorBucketName:this.vectorBucketName}))}async listIndexes(e={}){return super.listIndexes.call(this,se(se({},e),{},{vectorBucketName:this.vectorBucketName}))}async getIndex(e){return super.getIndex.call(this,this.vectorBucketName,e)}async deleteIndex(e){return super.deleteIndex.call(this,this.vectorBucketName,e)}index(e){return new s$(this.url,this.headers,this.vectorBucketName,e,this.fetch)}},s$=class extends sx{constructor(e,t,r,s,n){super(e,t,n),this.vectorBucketName=r,this.indexName=s}async putVectors(e){return super.putVectors.call(this,se(se({},e),{},{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))}async getVectors(e){return super.getVectors.call(this,se(se({},e),{},{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))}async listVectors(e={}){return super.listVectors.call(this,se(se({},e),{},{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))}async queryVectors(e){return super.queryVectors.call(this,se(se({},e),{},{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))}async deleteVectors(e){return super.deleteVectors.call(this,se(se({},e),{},{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))}},sP=class extends sm{constructor(e,t={},r,s){super(e,t,r,s)}from(e){return new sf(this.url,this.headers,e,this.fetch)}get vectors(){return new sC(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new sy(this.url+"/iceberg",this.headers,this.fetch)}};let sN="2.89.0",sU={"X-Client-Info":`gotrue-js/${sN}`},sD="X-Supabase-Api-Version",sB={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},sL=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class sM extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function sq(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class sV extends sM{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}class sF extends sM{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class sW extends sM{constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}}class sK extends sW{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class sz extends sW{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class sG extends sW{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class sH extends sW{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class sJ extends sW{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class sY extends sW{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class sX extends sW{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function sZ(e){return sq(e)&&"AuthRetryableFetchError"===e.name}class sQ extends sW{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class s0 extends sW{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}let s1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),s2=" 	\n\r=".split(""),s5=(()=>{let e=Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<s2.length;t+=1)e[s2[t].charCodeAt(0)]=-2;for(let t=0;t<s1.length;t+=1)e[s1[t].charCodeAt(0)]=t;return e})();function s6(e,t,r){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;)r(s1[t.queue>>t.queuedBits-6&63]),t.queuedBits-=6;else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;)r(s1[t.queue>>t.queuedBits-6&63]),t.queuedBits-=6}function s4(e,t,r){let s=s5[e];if(s>-1)for(t.queue=t.queue<<6|s,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else if(-2===s)return;else throw Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}function s8(e){let t=[],r=e=>{t.push(String.fromCodePoint(e))},s={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=e=>{!function(e,t,r){if(0===t.utf8seq){if(e<=127)return r(e);for(let r=1;r<6;r+=1)if((e>>7-r&1)==0){t.utf8seq=r;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else if(4===t.utf8seq)t.codepoint=7&e;else throw Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&r(t.codepoint)}}(e,s,r)};for(let t=0;t<e.length;t+=1)s4(e.charCodeAt(t),n,i);return t.join("")}function s3(e){let t=[],r={queue:0,queuedBits:0},s=e=>{t.push(e)};for(let t=0;t<e.length;t+=1)s4(e.charCodeAt(t),r,s);return new Uint8Array(t)}function s9(e){let t=[],r={queue:0,queuedBits:0},s=e=>{t.push(e)};return e.forEach(e=>s6(e,r,s)),s6(null,r,s),t.join("")}let s7=()=>"undefined"!=typeof window&&"undefined"!=typeof document,ne={tested:!1,writable:!1},nt=()=>{if(!s7())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(e){return!1}if(ne.tested)return ne.writable;let e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),ne.tested=!0,ne.writable=!0}catch(e){ne.tested=!0,ne.writable=!1}return ne.writable},nr=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),ns=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},nn=async(e,t)=>{let r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch(e){return r}},ni=async(e,t)=>{await e.removeItem(t)};class na{constructor(){this.promise=new na.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function no(e){let t=e.split(".");if(3!==t.length)throw new s0("Invalid JWT structure");for(let e=0;e<t.length;e++)if(!sL.test(t[e]))throw new s0("JWT not in base64url format");return{header:JSON.parse(s8(t[0])),payload:JSON.parse(s8(t[1])),signature:s3(t[2]),raw:{header:t[0],payload:t[1]}}}async function nl(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function nu(e){return("0"+e.toString(16)).substr(-2)}async function nc(e){let t=new TextEncoder().encode(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>String.fromCharCode(e)).join("")}async function nh(e){return"undefined"==typeof crypto||void 0===crypto.subtle||"undefined"==typeof TextEncoder?(console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e):btoa(await nc(e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function nd(e,t,r=!1){let s=function(){let e=new Uint32Array(56);if("undefined"==typeof crypto){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length,r="";for(let s=0;s<56;s++)r+=e.charAt(Math.floor(Math.random()*t));return r}return crypto.getRandomValues(e),Array.from(e,nu).join("")}(),n=s;r&&(n+="/PASSWORD_RECOVERY"),await ns(e,`${t}-code-verifier`,n);let i=await nh(s),a=s===i?"plain":"s256";return[i,a]}na.promiseConstructor=Promise;let nf=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i,np=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ng(e){if(!np.test(e))throw Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function nm(){return new Proxy({},{get:(e,t)=>{if("__isUserNotAvailableProxy"===t)return!0;if("symbol"==typeof t){let e=t.toString();if("Symbol(Symbol.toPrimitive)"===e||"Symbol(Symbol.toStringTag)"===e||"Symbol(util.inspect.custom)"===e)return}throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function ny(e){return JSON.parse(JSON.stringify(e))}let nw=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),nv=[502,503,504];async function nb(e){var t;let r,s;if(!("object"==typeof e&&null!==e&&"status"in e&&"ok"in e&&"json"in e&&"function"==typeof e.json))throw new sX(nw(e),0);if(nv.includes(e.status))throw new sX(nw(e),e.status);try{r=await e.json()}catch(e){throw new sF(nw(e),e)}let n=function(e){let t=e.headers.get(sD);if(!t||!t.match(nf))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(e){return null}}(e);if(n&&n.getTime()>=sB["2024-01-01"].timestamp&&"object"==typeof r&&r&&"string"==typeof r.code?s=r.code:"object"==typeof r&&r&&"string"==typeof r.error_code&&(s=r.error_code),s){if("weak_password"===s)throw new sQ(nw(r),e.status,(null==(t=r.weak_password)?void 0:t.reasons)||[]);else if("session_not_found"===s)throw new sK}else if("object"==typeof r&&r&&"object"==typeof r.weak_password&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0))throw new sQ(nw(r),e.status,r.weak_password.reasons);throw new sV(nw(r),e.status||500,s)}async function n_(e,t,r,s){var n;let i=Object.assign({},null==s?void 0:s.headers);i[sD]||(i[sD]=sB["2024-01-01"].name),(null==s?void 0:s.jwt)&&(i.Authorization=`Bearer ${s.jwt}`);let a=null!=(n=null==s?void 0:s.query)?n:{};(null==s?void 0:s.redirectTo)&&(a.redirect_to=s.redirectTo);let o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await nS(e,t,r+o,{headers:i,noResolveJson:null==s?void 0:s.noResolveJson},{},null==s?void 0:s.body);return(null==s?void 0:s.xform)?null==s?void 0:s.xform(l):{data:Object.assign({},l),error:null}}async function nS(e,t,r,s,n,i){let a,o,l=(o={method:t,headers:(null==s?void 0:s.headers)||{}},"GET"===t?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==s?void 0:s.headers),o.body=JSON.stringify(i),Object.assign(Object.assign({},o),n)));try{a=await e(r,Object.assign({},l))}catch(e){throw console.error(e),new sX(nw(e),0)}if(a.ok||await nb(a),null==s?void 0:s.noResolveJson)return a;try{return await a.json()}catch(e){await nb(e)}}function nk(e){var t,r,s;let n=null;(s=e).access_token&&s.refresh_token&&s.expires_in&&(n=Object.assign({},e),e.expires_at||(n.expires_at=(r=e.expires_in,Math.round(Date.now()/1e3)+r)));return{data:{session:n,user:null!=(t=e.user)?t:e},error:null}}function nE(e){let t=nk(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function nT(e){var t;return{data:{user:null!=(t=e.user)?t:e},error:null}}function nO(e){return{data:e,error:null}}function nR(e){let{action_link:t,email_otp:r,hashed_token:s,redirect_to:n,verification_type:i}=e;return{data:{properties:{action_link:t,email_otp:r,hashed_token:s,redirect_to:n,verification_type:i},user:Object.assign({},(0,eI.__rest)(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]))},error:null}}function nj(e){return e}let nx=["global","local","others"];class nA{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=nr(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=nx[0]){if(0>nx.indexOf(t))throw Error(`@supabase/auth-js: Parameter scope must be one of ${nx.join(", ")}`);try{return await n_(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(e){if(sq(e))return{data:null,error:e};throw e}}async inviteUserByEmail(e,t={}){try{return await n_(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:nT})}catch(e){if(sq(e))return{data:{user:null},error:e};throw e}}async generateLink(e){try{let{options:t}=e,r=(0,eI.__rest)(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=null==r?void 0:r.newEmail,delete s.newEmail),await n_(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:nR,redirectTo:null==t?void 0:t.redirectTo})}catch(e){if(sq(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(e){try{return await n_(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:nT})}catch(e){if(sq(e))return{data:{user:null},error:e};throw e}}async listUsers(e){var t,r,s,n,i,a,o;try{let l={nextPage:null,lastPage:0,total:0},u=await n_(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!=(r=null==(t=null==e?void 0:e.page)?void 0:t.toString())?r:"",per_page:null!=(n=null==(s=null==e?void 0:e.perPage)?void 0:s.toString())?n:""},xform:nj});if(u.error)throw u.error;let c=await u.json(),h=null!=(i=u.headers.get("x-total-count"))?i:0,d=null!=(o=null==(a=u.headers.get("link"))?void 0:a.split(","))?o:[];return d.length>0&&(d.forEach(e=>{let t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(e.split(";")[1].split("=")[1]);l[`${r}Page`]=t}),l.total=parseInt(h)),{data:Object.assign(Object.assign({},c),l),error:null}}catch(e){if(sq(e))return{data:{users:[]},error:e};throw e}}async getUserById(e){ng(e);try{return await n_(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:nT})}catch(e){if(sq(e))return{data:{user:null},error:e};throw e}}async updateUserById(e,t){ng(e);try{return await n_(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:nT})}catch(e){if(sq(e))return{data:{user:null},error:e};throw e}}async deleteUser(e,t=!1){ng(e);try{return await n_(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:nT})}catch(e){if(sq(e))return{data:{user:null},error:e};throw e}}async _listFactors(e){ng(e.userId);try{let{data:t,error:r}=await n_(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:r}}catch(e){if(sq(e))return{data:null,error:e};throw e}}async _deleteFactor(e){ng(e.userId),ng(e.id);try{return{data:await n_(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(e){if(sq(e))return{data:null,error:e};throw e}}async _listOAuthClients(e){var t,r,s,n,i,a,o;try{let l={nextPage:null,lastPage:0,total:0},u=await n_(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:null!=(r=null==(t=null==e?void 0:e.page)?void 0:t.toString())?r:"",per_page:null!=(n=null==(s=null==e?void 0:e.perPage)?void 0:s.toString())?n:""},xform:nj});if(u.error)throw u.error;let c=await u.json(),h=null!=(i=u.headers.get("x-total-count"))?i:0,d=null!=(o=null==(a=u.headers.get("link"))?void 0:a.split(","))?o:[];return d.length>0&&(d.forEach(e=>{let t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(e.split(";")[1].split("=")[1]);l[`${r}Page`]=t}),l.total=parseInt(h)),{data:Object.assign(Object.assign({},c),l),error:null}}catch(e){if(sq(e))return{data:{clients:[]},error:e};throw e}}async _createOAuthClient(e){try{return await n_(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(sq(e))return{data:null,error:e};throw e}}async _getOAuthClient(e){try{return await n_(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(sq(e))return{data:null,error:e};throw e}}async _updateOAuthClient(e,t){try{return await n_(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(sq(e))return{data:null,error:e};throw e}}async _deleteOAuthClient(e){try{return await n_(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(e){if(sq(e))return{data:null,error:e};throw e}}async _regenerateOAuthClientSecret(e){try{return await n_(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(sq(e))return{data:null,error:e};throw e}}}function nC(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}let nI={debug:!!(globalThis&&nt()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"))};class n$ extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class nP extends n${}async function nN(e,t,r){nI.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);let s=new globalThis.AbortController;return t>0&&setTimeout(()=>{s.abort(),nI.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async s=>{if(s){nI.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,s.name);try{return await r()}finally{nI.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,s.name)}}if(0===t)throw nI.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new nP(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(nI.debug)try{let e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(e){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",e)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}))}function nU(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}class nD extends Error{constructor({message:e,code:t,cause:r,name:s}){var n;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=null!=(n=null!=s?s:r instanceof Error?r.name:void 0)?n:"Unknown Error",this.code=t}}class nB extends nD{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}let nL=new class{createNewAbortSignal(){if(this.controller){let e=Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}let e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){let e=Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}};function nM(e){return"localhost"===e||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function nq(){var e,t;return!!(s7()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&"function"==typeof(null==(e=null==navigator?void 0:navigator.credentials)?void 0:e.create)&&"function"==typeof(null==(t=null==navigator?void 0:navigator.credentials)?void 0:t.get))}async function nV(e){try{let t=await navigator.credentials.create(e);if(!t)return{data:null,error:new nB("Empty credential response",t)};if(!(t instanceof PublicKeyCredential))return{data:null,error:new nB("Browser returned unexpected credential type",t)};return{data:t,error:null}}catch(t){return{data:null,error:function({error:e,options:t}){var r,s,n;let{publicKey:i}=t;if(!i)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new nD({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if("ConstraintError"===e.name){if((null==(r=i.authenticatorSelection)?void 0:r.requireResidentKey)===!0)return new nD({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});else if("conditional"===t.mediation&&(null==(s=i.authenticatorSelection)?void 0:s.userVerification)==="required")return new nD({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});else if((null==(n=i.authenticatorSelection)?void 0:n.userVerification)==="required")return new nD({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else if("InvalidStateError"===e.name)return new nD({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});else if("NotAllowedError"===e.name)return new nD({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});else if("NotSupportedError"===e.name)return new nD(0===i.pubKeyCredParams.filter(e=>"public-key"===e.type).length?{message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}:{message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});else if("SecurityError"===e.name){let t=window.location.hostname;if(!nM(t))return new nD({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(i.rp.id!==t)return new nD({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("TypeError"===e.name){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new nD({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if("UnknownError"===e.name)return new nD({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e});return new nD({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}({error:t,options:e})}}}async function nF(e){try{let t=await navigator.credentials.get(e);if(!t)return{data:null,error:new nB("Empty credential response",t)};if(!(t instanceof PublicKeyCredential))return{data:null,error:new nB("Browser returned unexpected credential type",t)};return{data:t,error:null}}catch(t){return{data:null,error:function({error:e,options:t}){let{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new nD({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if("NotAllowedError"===e.name)return new nD({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});else if("SecurityError"===e.name){let t=window.location.hostname;if(!nM(t))return new nD({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(r.rpId!==t)return new nD({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("UnknownError"===e.name)return new nD({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e});return new nD({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}({error:t,options:e})}}}let nW={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},nK={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function nz(...e){let t=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),r=e=>e instanceof ArrayBuffer||ArrayBuffer.isView(e),s={};for(let n of e)if(n)for(let e in n){let i=n[e];if(void 0!==i)if(Array.isArray(i))s[e]=i;else if(r(i))s[e]=i;else if(t(i)){let r=s[e];t(r)?s[e]=nz(r,i):s[e]=nz(i)}else s[e]=i}return s}class nG{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:r,signal:s},n){try{var i,a,o,l;let{data:u,error:c}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!u)return{data:null,error:c};let h=null!=s?s:nL.createNewAbortSignal();if("create"===u.webauthn.type){let{user:e}=u.webauthn.credential_options.publicKey;e.name||(e.name=`${e.id}:${r}`),e.displayName||(e.displayName=e.name)}switch(u.webauthn.type){case"create":{let t=(i=u.webauthn.credential_options.publicKey,a=null==n?void 0:n.create,nz(nW,i,a||{})),{data:r,error:s}=await nV({publicKey:t,signal:h});if(r)return{data:{factorId:e,challengeId:u.id,webauthn:{type:u.webauthn.type,credential_response:r}},error:null};return{data:null,error:s}}case"request":{let t=(o=u.webauthn.credential_options.publicKey,l=null==n?void 0:n.request,nz(nK,o,l||{})),{data:r,error:s}=await nF(Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:t,signal:h}));if(r)return{data:{factorId:e,challengeId:u.id,webauthn:{type:u.webauthn.type,credential_response:r}},error:null};return{data:null,error:s}}}}catch(e){if(sq(e))return{data:null,error:e};return{data:null,error:new sF("Unexpected error in challenge",e)}}}async _verify({challengeId:e,factorId:t,webauthn:r}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:t="undefined"!=typeof window?window.location.hostname:void 0,rpOrigins:r="undefined"!=typeof window?[window.location.origin]:void 0,signal:s}={}},n){if(!t)return{data:null,error:new sM("rpId is required for WebAuthn authentication")};try{if(!nq())return{data:null,error:new sF("Browser does not support WebAuthn",null)};let{data:i,error:a}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:r},signal:s},{request:n});if(!i)return{data:null,error:a};let{webauthn:o}=i;return this._verify({factorId:e,challengeId:i.challengeId,webauthn:{type:o.type,rpId:t,rpOrigins:r,credential_response:o.credential_response}})}catch(e){if(sq(e))return{data:null,error:e};return{data:null,error:new sF("Unexpected error in authenticate",e)}}}async _register({friendlyName:e,webauthn:{rpId:t="undefined"!=typeof window?window.location.hostname:void 0,rpOrigins:r="undefined"!=typeof window?[window.location.origin]:void 0,signal:s}={}},n){if(!t)return{data:null,error:new sM("rpId is required for WebAuthn registration")};try{if(!nq())return{data:null,error:new sF("Browser does not support WebAuthn",null)};let{data:i,error:a}=await this._enroll({friendlyName:e});if(!i)return await this.client.mfa.listFactors().then(t=>{var r;return null==(r=t.data)?void 0:r.all.find(t=>"webauthn"===t.factor_type&&t.friendly_name===e&&"unverified"!==t.status)}).then(e=>e?this.client.mfa.unenroll({factorId:null==e?void 0:e.id}):void 0),{data:null,error:a};let{data:o,error:l}=await this._challenge({factorId:i.id,friendlyName:i.friendly_name,webauthn:{rpId:t,rpOrigins:r},signal:s},{create:n});if(!o)return{data:null,error:l};return this._verify({factorId:i.id,challengeId:o.challengeId,webauthn:{rpId:t,rpOrigins:r,type:o.webauthn.type,credential_response:o.webauthn.credential_response}})}catch(e){if(sq(e))return{data:null,error:e};return{data:null,error:new sF("Unexpected error in register",e)}}}}if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}let nH={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:sU,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function nJ(e,t,r){return await r()}let nY={};class nX{get jwks(){var e,t;return null!=(t=null==(e=nY[this.storageKey])?void 0:e.jwks)?t:{keys:[]}}set jwks(e){nY[this.storageKey]=Object.assign(Object.assign({},nY[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return null!=(t=null==(e=nY[this.storageKey])?void 0:e.cachedAt)?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){nY[this.storageKey]=Object.assign(Object.assign({},nY[this.storageKey]),{cachedAt:e})}constructor(e){var t,r,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const n=Object.assign(Object.assign({},nH),e);if(this.storageKey=n.storageKey,this.instanceID=null!=(t=nX.nextInstanceID[this.storageKey])?t:0,nX.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!n.debug,"function"==typeof n.debug&&(this.logger=n.debug),this.instanceID>0&&s7()){const e=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(e),this.logDebugMessages&&console.trace(e)}if(this.persistSession=n.persistSession,this.autoRefreshToken=n.autoRefreshToken,this.admin=new nA({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=nr(n.fetch),this.lock=n.lock||nJ,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,this.throwOnError=n.throwOnError,n.lock?this.lock=n.lock:this.persistSession&&s7()&&(null==(r=null==globalThis?void 0:globalThis.navigator)?void 0:r.locks)?this.lock=nN:this.lock=nJ,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new nG(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(n.storage?this.storage=n.storage:nt()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=nC(this.memoryStorage)),n.userStorage&&(this.userStorage=n.userStorage)):(this.memoryStorage={},this.storage=nC(this.memoryStorage)),s7()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(e){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",e)}null==(s=this.broadcastChannel)||s.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${sN}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{let t={},r="none";if(s7()&&(t=function(e){let t={},r=new URL(e);if(r.hash&&"#"===r.hash[0])try{new URLSearchParams(r.hash.substring(1)).forEach((e,r)=>{t[r]=e})}catch(e){}return r.searchParams.forEach((e,r)=>{t[r]=e}),t}(window.location.href),this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce")),s7()&&this.detectSessionInUrl&&"none"!==r){let{data:s,error:n}=await this._getSessionFromURL(t,r);if(n){if(this._debug("#_initialize()","error detecting session from URL",n),sq(n)&&"AuthImplicitGrantRedirectError"===n.name){let t=null==(e=n.details)?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:n}}return await this._removeSession(),{error:n}}let{session:i,redirectType:a}=s;return this._debug("#_initialize()","detected session in URL",i,"redirect type",a),await this._saveSession(i),setTimeout(async()=>{"recovery"===a?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){if(sq(e))return this._returnResult({error:e});return this._returnResult({error:new sF("Unexpected error during initialization",e)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,s;try{let{data:n,error:i}=await n_(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!=(r=null==(t=null==e?void 0:e.options)?void 0:t.data)?r:{},gotrue_meta_security:{captcha_token:null==(s=null==e?void 0:e.options)?void 0:s.captchaToken}},xform:nk});if(i||!n)return this._returnResult({data:{user:null,session:null},error:i});let a=n.session,o=n.user;return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",a)),this._returnResult({data:{user:o,session:a},error:null})}catch(e){if(sq(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signUp(e){var t,r,s;try{let n;if("email"in e){let{email:r,password:s,options:i}=e,a=null,o=null;"pkce"===this.flowType&&([a,o]=await nd(this.storage,this.storageKey)),n=await n_(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==i?void 0:i.emailRedirectTo,body:{email:r,password:s,data:null!=(t=null==i?void 0:i.data)?t:{},gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:a,code_challenge_method:o},xform:nk})}else if("phone"in e){let{phone:t,password:i,options:a}=e;n=await n_(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:i,data:null!=(r=null==a?void 0:a.data)?r:{},channel:null!=(s=null==a?void 0:a.channel)?s:"sms",gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},xform:nk})}else throw new sG("You must provide either an email or phone number and a password");let{data:i,error:a}=n;if(a||!i)return await ni(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:a});let o=i.session,l=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",o)),this._returnResult({data:{user:l,session:o},error:null})}catch(e){if(await ni(this.storage,`${this.storageKey}-code-verifier`),sq(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithPassword(e){try{let t;if("email"in e){let{email:r,password:s,options:n}=e;t=await n_(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:nE})}else if("phone"in e){let{phone:r,password:s,options:n}=e;t=await n_(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:nE})}else throw new sG("You must provide either an email or phone number and a password");let{data:r,error:s}=t;if(s)return this._returnResult({data:{user:null,session:null},error:s});if(!r||!r.session||!r.user){let e=new sz;return this._returnResult({data:{user:null,session:null},error:e})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(e){if(sq(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithOAuth(e){var t,r,s,n;return await this._handleProviderSignIn(e.provider,{redirectTo:null==(t=e.options)?void 0:t.redirectTo,scopes:null==(r=e.options)?void 0:r.scopes,queryParams:null==(s=e.options)?void 0:s.queryParams,skipBrowserRedirect:null==(n=e.options)?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){let{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,r,s,n,i,a,o,l,u,c,h,d;let f,p;if("message"in e)f=e.message,p=e.signature;else{let c,{chain:h,wallet:g,statement:m,options:y}=e;if(s7())if("object"==typeof g)c=g;else{let e=window;if("ethereum"in e&&"object"==typeof e.ethereum&&"request"in e.ethereum&&"function"==typeof e.ethereum.request)c=e.ethereum;else throw Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if("object"!=typeof g||!(null==y?void 0:y.url))throw Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");c=g}let w=new URL(null!=(t=null==y?void 0:y.url)?t:window.location.href),v=await c.request({method:"eth_requestAccounts"}).then(e=>e).catch(()=>{throw Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!v||0===v.length)throw Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");let b=nU(v[0]),_=null==(r=null==y?void 0:y.signInWithEthereum)?void 0:r.chainId;_||(_=parseInt(await c.request({method:"eth_chainId"}),16)),f=function(e){var t;let{chainId:r,domain:s,expirationTime:n,issuedAt:i=new Date,nonce:a,notBefore:o,requestId:l,resources:u,scheme:c,uri:h,version:d}=e;if(!Number.isInteger(r))throw Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!s)throw Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(a&&a.length<8)throw Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${a}`);if(!h)throw Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if("1"!==d)throw Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${d}`);if(null==(t=e.statement)?void 0:t.includes("\n"))throw Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`);let f=nU(e.address),p=c?`${c}://${s}`:s,g=e.statement?`${e.statement}
`:"",m=`${p} wants you to sign in with your Ethereum account:
${f}

${g}`,y=`URI: ${h}
Version: ${d}
Chain ID: ${r}${a?`
Nonce: ${a}`:""}
Issued At: ${i.toISOString()}`;if(n&&(y+=`
Expiration Time: ${n.toISOString()}`),o&&(y+=`
Not Before: ${o.toISOString()}`),l&&(y+=`
Request ID: ${l}`),u){let e="\nResources:";for(let t of u){if(!t||"string"!=typeof t)throw Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${t}`);e+=`
- ${t}`}y+=e}return`${m}
${y}`}({domain:w.host,address:b,statement:m,uri:w.href,version:"1",chainId:_,nonce:null==(s=null==y?void 0:y.signInWithEthereum)?void 0:s.nonce,issuedAt:null!=(i=null==(n=null==y?void 0:y.signInWithEthereum)?void 0:n.issuedAt)?i:new Date,expirationTime:null==(a=null==y?void 0:y.signInWithEthereum)?void 0:a.expirationTime,notBefore:null==(o=null==y?void 0:y.signInWithEthereum)?void 0:o.notBefore,requestId:null==(l=null==y?void 0:y.signInWithEthereum)?void 0:l.requestId,resources:null==(u=null==y?void 0:y.signInWithEthereum)?void 0:u.resources}),p=await c.request({method:"personal_sign",params:[(d=f,"0x"+Array.from(new TextEncoder().encode(d),e=>e.toString(16).padStart(2,"0")).join("")),b]})}try{let{data:t,error:r}=await n_(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:f,signature:p},(null==(c=e.options)?void 0:c.captchaToken)?{gotrue_meta_security:{captcha_token:null==(h=e.options)?void 0:h.captchaToken}}:null),xform:nk});if(r)throw r;if(!t||!t.session||!t.user){let e=new sz;return this._returnResult({data:{user:null,session:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign({},t),error:r})}catch(e){if(sq(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithSolana(e){var t,r,s,n,i,a,o,l,u,c,h,d;let f,p;if("message"in e)f=e.message,p=e.signature;else{let h,{chain:d,wallet:g,statement:m,options:y}=e;if(s7())if("object"==typeof g)h=g;else{let e=window;if("solana"in e&&"object"==typeof e.solana&&("signIn"in e.solana&&"function"==typeof e.solana.signIn||"signMessage"in e.solana&&"function"==typeof e.solana.signMessage))h=e.solana;else throw Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if("object"!=typeof g||!(null==y?void 0:y.url))throw Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");h=g}let w=new URL(null!=(t=null==y?void 0:y.url)?t:window.location.href);if("signIn"in h&&h.signIn){let e,t=await h.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},null==y?void 0:y.signInWithSolana),{version:"1",domain:w.host,uri:w.href}),m?{statement:m}:null));if(Array.isArray(t)&&t[0]&&"object"==typeof t[0])e=t[0];else if(t&&"object"==typeof t&&"signedMessage"in t&&"signature"in t)e=t;else throw Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in e&&"signature"in e&&("string"==typeof e.signedMessage||e.signedMessage instanceof Uint8Array)&&e.signature instanceof Uint8Array)f="string"==typeof e.signedMessage?e.signedMessage:new TextDecoder().decode(e.signedMessage),p=e.signature;else throw Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in h)||"function"!=typeof h.signMessage||!("publicKey"in h)||"object"!=typeof h||!h.publicKey||!("toBase58"in h.publicKey)||"function"!=typeof h.publicKey.toBase58)throw Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");f=[`${w.host} wants you to sign in with your Solana account:`,h.publicKey.toBase58(),...m?["",m,""]:[""],"Version: 1",`URI: ${w.href}`,`Issued At: ${null!=(s=null==(r=null==y?void 0:y.signInWithSolana)?void 0:r.issuedAt)?s:new Date().toISOString()}`,...(null==(n=null==y?void 0:y.signInWithSolana)?void 0:n.notBefore)?[`Not Before: ${y.signInWithSolana.notBefore}`]:[],...(null==(i=null==y?void 0:y.signInWithSolana)?void 0:i.expirationTime)?[`Expiration Time: ${y.signInWithSolana.expirationTime}`]:[],...(null==(a=null==y?void 0:y.signInWithSolana)?void 0:a.chainId)?[`Chain ID: ${y.signInWithSolana.chainId}`]:[],...(null==(o=null==y?void 0:y.signInWithSolana)?void 0:o.nonce)?[`Nonce: ${y.signInWithSolana.nonce}`]:[],...(null==(l=null==y?void 0:y.signInWithSolana)?void 0:l.requestId)?[`Request ID: ${y.signInWithSolana.requestId}`]:[],...(null==(c=null==(u=null==y?void 0:y.signInWithSolana)?void 0:u.resources)?void 0:c.length)?["Resources",...y.signInWithSolana.resources.map(e=>`- ${e}`)]:[]].join("\n");let e=await h.signMessage(new TextEncoder().encode(f),"utf8");if(!e||!(e instanceof Uint8Array))throw Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=e}}try{let{data:t,error:r}=await n_(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:f,signature:s9(p)},(null==(h=e.options)?void 0:h.captchaToken)?{gotrue_meta_security:{captcha_token:null==(d=e.options)?void 0:d.captchaToken}}:null),xform:nk});if(r)throw r;if(!t||!t.session||!t.user){let e=new sz;return this._returnResult({data:{user:null,session:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign({},t),error:r})}catch(e){if(sq(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async _exchangeCodeForSession(e){let t=await nn(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(null!=t?t:"").split("/");try{if(!r&&"pkce"===this.flowType)throw new sY;let{data:t,error:n}=await n_(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:nk});if(await ni(this.storage,`${this.storageKey}-code-verifier`),n)throw n;if(!t||!t.session||!t.user){let e=new sz;return this._returnResult({data:{user:null,session:null,redirectType:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign(Object.assign({},t),{redirectType:null!=s?s:null}),error:n})}catch(e){if(await ni(this.storage,`${this.storageKey}-code-verifier`),sq(e))return this._returnResult({data:{user:null,session:null,redirectType:null},error:e});throw e}}async signInWithIdToken(e){try{let{options:t,provider:r,token:s,access_token:n,nonce:i}=e,{data:a,error:o}=await n_(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:n,nonce:i,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:nk});if(o)return this._returnResult({data:{user:null,session:null},error:o});if(!a||!a.session||!a.user){let e=new sz;return this._returnResult({data:{user:null,session:null},error:e})}return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),this._returnResult({data:a,error:o})}catch(e){if(sq(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithOtp(e){var t,r,s,n,i;try{if("email"in e){let{email:s,options:n}=e,i=null,a=null;"pkce"===this.flowType&&([i,a]=await nd(this.storage,this.storageKey));let{error:o}=await n_(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:s,data:null!=(t=null==n?void 0:n.data)?t:{},create_user:null==(r=null==n?void 0:n.shouldCreateUser)||r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:i,code_challenge_method:a},redirectTo:null==n?void 0:n.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}if("phone"in e){let{phone:t,options:r}=e,{data:a,error:o}=await n_(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!=(s=null==r?void 0:r.data)?s:{},create_user:null==(n=null==r?void 0:r.shouldCreateUser)||n,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},channel:null!=(i=null==r?void 0:r.channel)?i:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:null==a?void 0:a.message_id},error:o})}throw new sG("You must provide either an email or phone number.")}catch(e){if(await ni(this.storage,`${this.storageKey}-code-verifier`),sq(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async verifyOtp(e){var t,r;try{let s,n;"options"in e&&(s=null==(t=e.options)?void 0:t.redirectTo,n=null==(r=e.options)?void 0:r.captchaToken);let{data:i,error:a}=await n_(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:s,xform:nk});if(a)throw a;if(!i)throw Error("An error occurred on token verification.");let o=i.session,l=i.user;return(null==o?void 0:o.access_token)&&(await this._saveSession(o),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",o)),this._returnResult({data:{user:l,session:o},error:null})}catch(e){if(sq(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithSSO(e){var t,r,s,n,i;try{let a=null,o=null;"pkce"===this.flowType&&([a,o]=await nd(this.storage,this.storageKey));let l=await n_(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!=(r=null==(t=e.options)?void 0:t.redirectTo)?r:void 0}),(null==(s=null==e?void 0:e.options)?void 0:s.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:o}),headers:this.headers,xform:nO});return(null==(n=l.data)?void 0:n.url)&&s7()&&!(null==(i=e.options)?void 0:i.skipBrowserRedirect)&&window.location.assign(l.data.url),this._returnResult(l)}catch(e){if(await ni(this.storage,`${this.storageKey}-code-verifier`),sq(e))return this._returnResult({data:null,error:e});throw e}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{let{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new sK;let{error:s}=await n_(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:s})})}catch(e){if(sq(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{let t=`${this.url}/resend`;if("email"in e){let{email:r,type:s,options:n}=e,{error:i}=await n_(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},redirectTo:null==n?void 0:n.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:i})}if("phone"in e){let{phone:r,type:s,options:n}=e,{data:i,error:a}=await n_(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:null==i?void 0:i.message_id},error:a})}throw new sG("You must provide either an email or phone number and a type")}catch(e){if(sq(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){let e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await r}catch(e){}})()),r}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(e){}})()),await e;this.pendingInLock.length;){let e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{let t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",Error().stack);try{let t=null,r=await nn(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),null!==r&&(this._isValidSession(r)?t=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};let s=!!t.expires_at&&1e3*t.expires_at-Date.now()<9e4;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",t.expires_at),!s){if(this.userStorage){let e=await nn(this.userStorage,this.storageKey+"-user");(null==e?void 0:e.user)?t.user=e.user:t.user=nm()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){var e;let r={value:this.suppressGetSessionWarning};t.user=(e=t.user,new Proxy(e,{get:(e,t,s)=>{if("__isInsecureUserWarningProxy"===t)return!0;if("symbol"==typeof t){let r=t.toString();if("Symbol(Symbol.toPrimitive)"===r||"Symbol(Symbol.toStringTag)"===r||"Symbol(util.inspect.custom)"===r||"Symbol(nodejs.util.inspect.custom)"===r)return Reflect.get(e,t,s)}return r.value||"string"!=typeof t||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),r.value=!0),Reflect.get(e,t,s)}})),r.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}let{data:n,error:i}=await this._callRefreshToken(t.refresh_token);if(i)return this._returnResult({data:{session:null},error:i});return this._returnResult({data:{session:n},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;let t=await this._acquireLock(-1,async()=>await this._getUser());return t.data.user&&(this.suppressGetSessionWarning=!0),t}async _getUser(e){try{if(e)return await n_(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:nT});return await this._useSession(async e=>{var t,r,s;let{data:n,error:i}=e;if(i)throw i;return(null==(t=n.session)?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await n_(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!=(s=null==(r=n.session)?void 0:r.access_token)?s:void 0,xform:nT}):{data:{user:null},error:new sK}})}catch(e){if(sq(e))return sq(e)&&"AuthSessionMissingError"===e.name&&(await this._removeSession(),await ni(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:e});throw e}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{let{data:s,error:n}=r;if(n)throw n;if(!s.session)throw new sK;let i=s.session,a=null,o=null;"pkce"===this.flowType&&null!=e.email&&([a,o]=await nd(this.storage,this.storageKey));let{data:l,error:u}=await n_(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:o}),jwt:i.access_token,xform:nT});if(u)throw u;return i.user=l.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),this._returnResult({data:{user:i.user},error:null})})}catch(e){if(await ni(this.storage,`${this.storageKey}-code-verifier`),sq(e))return this._returnResult({data:{user:null},error:e});throw e}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new sK;let t=Date.now()/1e3,r=t,s=!0,n=null,{payload:i}=no(e.access_token);if(i.exp&&(s=(r=i.exp)<=t),s){let{data:t,error:r}=await this._callRefreshToken(e.refresh_token);if(r)return this._returnResult({data:{user:null,session:null},error:r});if(!t)return{data:{user:null,session:null},error:null};n=t}else{let{data:s,error:i}=await this._getUser(e.access_token);if(i)throw i;n={access_token:e.access_token,refresh_token:e.refresh_token,user:s.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return this._returnResult({data:{user:n.user,session:n},error:null})}catch(e){if(sq(e))return this._returnResult({data:{session:null,user:null},error:e});throw e}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){let{data:s,error:n}=t;if(n)throw n;e=null!=(r=s.session)?r:void 0}if(!(null==e?void 0:e.refresh_token))throw new sK;let{data:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?this._returnResult({data:{user:null,session:null},error:n}):s?this._returnResult({data:{user:s.user,session:s},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(e){if(sq(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async _getSessionFromURL(e,t){try{if(!s7())throw new sH("No browser detected.");if(e.error||e.error_description||e.error_code)throw new sH(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new sJ("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new sH("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new sJ("No code detected.");let{data:t,error:r}=await this._exchangeCodeForSession(e.code);if(r)throw r;let s=new URL(window.location.href);return s.searchParams.delete("code"),window.history.replaceState(window.history.state,"",s.toString()),{data:{session:t.session,redirectType:null},error:null}}let{provider_token:r,provider_refresh_token:s,access_token:n,refresh_token:i,expires_in:a,expires_at:o,token_type:l}=e;if(!n||!a||!i||!l)throw new sH("No session defined in URL");let u=Math.round(Date.now()/1e3),c=parseInt(a),h=u+c;o&&(h=parseInt(o));let d=h-u;1e3*d<=3e4&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${d}s, should have been closer to ${c}s`);let f=h-c;u-f>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",f,h,u):u-f<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",f,h,u);let{data:p,error:g}=await this._getUser(n);if(g)throw g;let m={provider_token:r,provider_refresh_token:s,access_token:n,expires_in:c,expires_at:h,refresh_token:i,token_type:l,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:m,redirectType:e.type},error:null})}catch(e){if(sq(e))return this._returnResult({data:{session:null,redirectType:null},error:e});throw e}}_isImplicitGrantCallback(e){return"function"==typeof this.detectSessionInUrl?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){let t=await nn(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;let{data:s,error:n}=t;if(n)return this._returnResult({error:n});let i=null==(r=s.session)?void 0:r.access_token;if(i){let{error:t}=await this.admin.signOut(i,e);if(t&&!(sq(t)&&"AuthApiError"===t.name&&(404===t.status||401===t.status||403===t.status)))return this._returnResult({error:t})}return"others"!==e&&(await this._removeSession(),await ni(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){let t=Symbol("auth-callback"),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>{await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{let{data:{session:s},error:n}=t;if(n)throw n;await (null==(r=this.stateChangeEmitters.get(e))?void 0:r.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(t){await (null==(s=this.stateChangeEmitters.get(e))?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",t),console.error(t)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;"pkce"===this.flowType&&([r,s]=await nd(this.storage,this.storageKey,!0));try{return await n_(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(e){if(await ni(this.storage,`${this.storageKey}-code-verifier`),sq(e))return this._returnResult({data:null,error:e});throw e}}async getUserIdentities(){var e;try{let{data:t,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:null!=(e=t.user.identities)?e:[]},error:null})}catch(e){if(sq(e))return this._returnResult({data:null,error:e});throw e}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{let{data:r,error:s}=await this._useSession(async t=>{var r,s,n,i,a;let{data:o,error:l}=t;if(l)throw l;let u=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null==(r=e.options)?void 0:r.redirectTo,scopes:null==(s=e.options)?void 0:s.scopes,queryParams:null==(n=e.options)?void 0:n.queryParams,skipBrowserRedirect:!0});return await n_(this.fetch,"GET",u,{headers:this.headers,jwt:null!=(a=null==(i=o.session)?void 0:i.access_token)?a:void 0})});if(s)throw s;return!s7()||(null==(t=e.options)?void 0:t.skipBrowserRedirect)||window.location.assign(null==r?void 0:r.url),this._returnResult({data:{provider:e.provider,url:null==r?void 0:r.url},error:null})}catch(t){if(sq(t))return this._returnResult({data:{provider:e.provider,url:null},error:t});throw t}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var r;try{let{error:s,data:{session:n}}=t;if(s)throw s;let{options:i,provider:a,token:o,access_token:l,nonce:u}=e,{data:c,error:h}=await n_(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:null!=(r=null==n?void 0:n.access_token)?r:void 0,body:{provider:a,id_token:o,access_token:l,nonce:u,link_identity:!0,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:nk});if(h)return this._returnResult({data:{user:null,session:null},error:h});if(!c||!c.session||!c.user)return this._returnResult({data:{user:null,session:null},error:new sz});return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("USER_UPDATED",c.session)),this._returnResult({data:c,error:h})}catch(e){if(await ni(this.storage,`${this.storageKey}-code-verifier`),sq(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,s;let{data:n,error:i}=t;if(i)throw i;return await n_(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!=(s=null==(r=n.session)?void 0:r.access_token)?s:void 0})})}catch(e){if(sq(e))return this._returnResult({data:null,error:e});throw e}}async _refreshAccessToken(e){let t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{var r,s;let n=Date.now();return await (r=async r=>(r>0&&await nl(200*Math.pow(2,r-1)),this._debug(t,"refreshing attempt",r),await n_(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:nk})),s=(e,t)=>{let r=200*Math.pow(2,e);return t&&sZ(t)&&Date.now()+r-n<3e4},new Promise((e,t)=>{(async()=>{for(let n=0;n<1/0;n++)try{let t=await r(n);if(!s(n,null,t))return void e(t)}catch(e){if(!s(n,e))return void t(e)}})()}))}catch(e){if(this._debug(t,"error",e),sq(e))return this._returnResult({data:{session:null,user:null},error:e});throw e}finally{this._debug(t,"end")}}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){let r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),s7()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;let r="#_recoverAndRefresh()";this._debug(r,"begin");try{let s=await nn(this.storage,this.storageKey);if(s&&this.userStorage){let t=await nn(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!t&&(t={user:s.user},await ns(this.userStorage,this.storageKey+"-user",t)),s.user=null!=(e=null==t?void 0:t.user)?e:nm()}else if(s&&!s.user&&!s.user){let e=await nn(this.storage,this.storageKey+"-user");e&&(null==e?void 0:e.user)?(s.user=e.user,await ni(this.storage,this.storageKey+"-user"),await ns(this.storage,this.storageKey,s)):s.user=nm()}if(this._debug(r,"session from storage",s),!this._isValidSession(s)){this._debug(r,"session is not valid"),null!==s&&await this._removeSession();return}let n=(null!=(t=s.expires_at)?t:1/0)*1e3-Date.now()<9e4;if(this._debug(r,`session has${n?"":" not"} expired with margin of 90000s`),n){if(this.autoRefreshToken&&s.refresh_token){let{error:e}=await this._callRefreshToken(s.refresh_token);e&&(console.error(e),sZ(e)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else if(s.user&&!0===s.user.__isUserNotAvailableProxy)try{let{data:e,error:t}=await this._getUser(s.access_token);!t&&(null==e?void 0:e.user)?(s.user=e.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(e){console.error("Error getting user data:",e),this._debug(r,"error getting user data, skipping SIGNED_IN notification",e)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(e){this._debug(r,"error",e),console.error(e);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new sK;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new na;let{data:t,error:r}=await this._refreshAccessToken(e);if(r)throw r;if(!t.session)throw new sK;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);let s={data:t.session,error:null};return this.refreshingDeferred.resolve(s),s}catch(e){if(this._debug(s,"error",e),sq(e)){let r={data:null,error:e};return sZ(e)||await this._removeSession(),null==(t=this.refreshingDeferred)||t.resolve(r),r}throw null==(r=this.refreshingDeferred)||r.reject(e),e}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){let s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});let s=[],n=Array.from(this.stateChangeEmitters.values()).map(async r=>{try{await r.callback(e,t)}catch(e){s.push(e)}});if(await Promise.all(n),s.length>0){for(let e=0;e<s.length;e+=1)console.error(s[e]);throw s[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await ni(this.storage,`${this.storageKey}-code-verifier`);let t=Object.assign({},e),r=t.user&&!0===t.user.__isUserNotAvailableProxy;if(this.userStorage){!r&&t.user&&await ns(this.userStorage,this.storageKey+"-user",{user:t.user});let e=Object.assign({},t);delete e.user;let s=ny(e);await ns(this.storage,this.storageKey,s)}else{let e=ny(t);await ns(this.storage,this.storageKey,e)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await ni(this.storage,this.storageKey),await ni(this.storage,this.storageKey+"-code-verifier"),await ni(this.storage,this.storageKey+"-user"),this.userStorage&&await ni(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");let e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&s7()&&(null==window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(e){console.error("removing visibilitychange callback failed",e)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let e=setInterval(()=>this._autoRefreshTokenTick(),3e4);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");let e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{let e=Date.now();try{return await this._useSession(async t=>{let{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");let s=Math.floor((1e3*r.expires_at-e)/3e4);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),s<=3&&await this._callRefreshToken(r.refresh_token)})}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof n$)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!s7()||!(null==window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null==window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){let t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{"visible"!==document.visibilityState?this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting"):await this._recoverAndRefresh()}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){let s=[`provider=${encodeURIComponent(t)}`];if((null==r?void 0:r.redirectTo)&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),(null==r?void 0:r.scopes)&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),"pkce"===this.flowType){let[e,t]=await nd(this.storage,this.storageKey),r=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});s.push(r.toString())}if(null==r?void 0:r.queryParams){let e=new URLSearchParams(r.queryParams);s.push(e.toString())}return(null==r?void 0:r.skipBrowserRedirect)&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;let{data:s,error:n}=t;return n?this._returnResult({data:null,error:n}):await n_(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null==(r=null==s?void 0:s.session)?void 0:r.access_token})})}catch(e){if(sq(e))return this._returnResult({data:null,error:e});throw e}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;let{data:n,error:i}=t;if(i)return this._returnResult({data:null,error:i});let a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:"totp"===e.factorType?{issuer:e.issuer}:{}),{data:o,error:l}=await n_(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:null==(r=null==n?void 0:n.session)?void 0:r.access_token});return l?this._returnResult({data:null,error:l}):("totp"===e.factorType&&"totp"===o.type&&(null==(s=null==o?void 0:o.totp)?void 0:s.qr_code)&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),this._returnResult({data:o,error:null}))})}catch(e){if(sq(e))return this._returnResult({data:null,error:e});throw e}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r,s,n;let{data:i,error:a}=t;if(a)return this._returnResult({data:null,error:a});let o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:"create"===e.webauthn.type?(s=e.webauthn.credential_response,"toJSON"in s&&"function"==typeof s.toJSON?s.toJSON():{id:s.id,rawId:s.id,response:{attestationObject:s9(new Uint8Array(s.response.attestationObject)),clientDataJSON:s9(new Uint8Array(s.response.clientDataJSON))},type:"public-key",clientExtensionResults:s.getClientExtensionResults(),authenticatorAttachment:null!=(n=s.authenticatorAttachment)?n:void 0}):function(e){var t;if("toJSON"in e&&"function"==typeof e.toJSON)return e.toJSON();let r=e.getClientExtensionResults(),s=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:s9(new Uint8Array(s.authenticatorData)),clientDataJSON:s9(new Uint8Array(s.clientDataJSON)),signature:s9(new Uint8Array(s.signature)),userHandle:s.userHandle?s9(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:null!=(t=e.authenticatorAttachment)?t:void 0}}(e.webauthn.credential_response)})}:{code:e.code}),{data:l,error:u}=await n_(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:null==(r=null==i?void 0:i.session)?void 0:r.access_token});return u?this._returnResult({data:null,error:u}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+l.expires_in},l)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",l),this._returnResult({data:l,error:u}))})}catch(e){if(sq(e))return this._returnResult({data:null,error:e});throw e}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;let{data:s,error:n}=t;if(n)return this._returnResult({data:null,error:n});let i=await n_(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:null==(r=null==s?void 0:s.session)?void 0:r.access_token});if(i.error)return i;let{data:a}=i;if("webauthn"!==a.type)return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:function(e){if(!e)throw Error("Credential creation options are required");if("undefined"!=typeof PublicKeyCredential&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseCreationOptionsFromJSON)return PublicKeyCredential.parseCreationOptionsFromJSON(e);let{challenge:t,user:r,excludeCredentials:s}=e,n=(0,eI.__rest)(e,["challenge","user","excludeCredentials"]),i=s3(t).buffer,a=Object.assign(Object.assign({},r),{id:s3(r.id).buffer}),o=Object.assign(Object.assign({},n),{challenge:i,user:a});if(s&&s.length>0){o.excludeCredentials=Array(s.length);for(let e=0;e<s.length;e++){let t=s[e];o.excludeCredentials[e]=Object.assign(Object.assign({},t),{id:s3(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return o}(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:function(e){if(!e)throw Error("Credential request options are required");if("undefined"!=typeof PublicKeyCredential&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseRequestOptionsFromJSON)return PublicKeyCredential.parseRequestOptionsFromJSON(e);let{challenge:t,allowCredentials:r}=e,s=(0,eI.__rest)(e,["challenge","allowCredentials"]),n=s3(t).buffer,i=Object.assign(Object.assign({},s),{challenge:n});if(r&&r.length>0){i.allowCredentials=Array(r.length);for(let e=0;e<r.length;e++){let t=r[e];i.allowCredentials[e]=Object.assign(Object.assign({},t),{id:s3(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return i}(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(e){if(sq(e))return this._returnResult({data:null,error:e});throw e}})}async _challengeAndVerify(e){let{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;let{data:{user:t},error:r}=await this.getUser();if(r)return{data:null,error:r};let s={all:[],phone:[],totp:[],webauthn:[]};for(let r of null!=(e=null==t?void 0:t.factors)?e:[])s.all.push(r),"verified"===r.status&&s[r.factor_type].push(r);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;let{data:{session:r},error:s}=await this.getSession();if(s)return this._returnResult({data:null,error:s});if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let{payload:n}=no(r.access_token),i=null;n.aal&&(i=n.aal);let a=i;return(null!=(t=null==(e=r.user.factors)?void 0:e.filter(e=>"verified"===e.status))?t:[]).length>0&&(a="aal2"),{data:{currentLevel:i,nextLevel:a,currentAuthenticationMethods:n.amr||[]},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{let{data:{session:r},error:s}=t;return s?this._returnResult({data:null,error:s}):r?await n_(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:r.access_token,xform:e=>({data:e,error:null})}):this._returnResult({data:null,error:new sK})})}catch(e){if(sq(e))return this._returnResult({data:null,error:e});throw e}}async _approveAuthorization(e,t){try{return await this._useSession(async r=>{let{data:{session:s},error:n}=r;if(n)return this._returnResult({data:null,error:n});if(!s)return this._returnResult({data:null,error:new sK});let i=await n_(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"approve"},xform:e=>({data:e,error:null})});return i.data&&i.data.redirect_url&&s7()&&!(null==t?void 0:t.skipBrowserRedirect)&&window.location.assign(i.data.redirect_url),i})}catch(e){if(sq(e))return this._returnResult({data:null,error:e});throw e}}async _denyAuthorization(e,t){try{return await this._useSession(async r=>{let{data:{session:s},error:n}=r;if(n)return this._returnResult({data:null,error:n});if(!s)return this._returnResult({data:null,error:new sK});let i=await n_(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"deny"},xform:e=>({data:e,error:null})});return i.data&&i.data.redirect_url&&s7()&&!(null==t?void 0:t.skipBrowserRedirect)&&window.location.assign(i.data.redirect_url),i})}catch(e){if(sq(e))return this._returnResult({data:null,error:e});throw e}}async _listOAuthGrants(){try{return await this._useSession(async e=>{let{data:{session:t},error:r}=e;return r?this._returnResult({data:null,error:r}):t?await n_(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:t.access_token,xform:e=>({data:e,error:null})}):this._returnResult({data:null,error:new sK})})}catch(e){if(sq(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async t=>{let{data:{session:r},error:s}=t;return s?this._returnResult({data:null,error:s}):r?(await n_(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new sK})})}catch(e){if(sq(e))return this._returnResult({data:null,error:e});throw e}}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(t=>t.kid===e);if(r)return r;let s=Date.now();if((r=this.jwks.keys.find(t=>t.kid===e))&&this.jwks_cached_at+6e5>s)return r;let{data:n,error:i}=await n_(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return n.keys&&0!==n.keys.length&&(this.jwks=n,this.jwks_cached_at=s,r=n.keys.find(t=>t.kid===e))?r:null}async getClaims(e,t={}){try{var r;let s,n=e;if(!n){let{data:e,error:t}=await this.getSession();if(t||!e.session)return this._returnResult({data:null,error:t});n=e.session.access_token}let{header:i,payload:a,signature:o,raw:{header:l,payload:u}}=no(n);(null==t?void 0:t.allowExpired)||function(e){if(!e)throw Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw Error("JWT has expired")}(a.exp);let c=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,(null==t?void 0:t.keys)?{keys:t.keys}:null==t?void 0:t.jwks);if(!c){let{error:e}=await this.getUser(n);if(e)throw e;return{data:{claims:a,header:i,signature:o},error:null}}let h=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw Error("Invalid alg claim")}}(i.alg),d=await crypto.subtle.importKey("jwk",c,h,!0,["verify"]);if(!await crypto.subtle.verify(h,d,o,(r=`${l}.${u}`,s=[],!function(e,t){for(let r=0;r<e.length;r+=1){let s=e.charCodeAt(r);if(s>55295&&s<=56319){let t=(s-55296)*1024&65535;s=(e.charCodeAt(r+1)-56320&65535|t)+65536,r+=1}!function(e,t){if(e<=127)return t(e);if(e<=2047){t(192|e>>6),t(128|63&e);return}if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|63&e);return}if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|63&e);return}throw Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}(s,t)}}(r,e=>s.push(e)),new Uint8Array(s))))throw new s0("Invalid JWT signature");return{data:{claims:a,header:i,signature:o},error:null}}catch(e){if(sq(e))return this._returnResult({data:null,error:e});throw e}}}nX.nextInstanceID={};let nZ=nX,nQ="";nQ="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";let n0={headers:{"X-Client-Info":`supabase-js-${nQ}/2.89.0`}},n1={schema:"public"},n2={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},n5={};function n6(e){return(n6="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function n8(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n4(Object(r),!0).forEach(function(t){!function(e,t,r){var s;(s=function(e,t){if("object"!=n6(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!=n6(s))return s;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"),(t="symbol"==n6(s)?s:s+"")in e)?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n4(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var n3=class extends nZ{constructor(e){super(e)}},n9=class{constructor(e,t,r){var s,n,i;this.supabaseUrl=e,this.supabaseKey=t;const a=function(e){let t=null==e?void 0:e.trim();if(!t)throw Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(t.endsWith("/")?t:t+"/")}catch(e){throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}(e);if(!t)throw Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",a),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",a),this.storageUrl=new URL("storage/v1",a),this.functionsUrl=new URL("functions/v1",a);const o=`sb-${a.hostname.split(".")[0]}-auth-token`,l=function(e,t){var r,s;let{db:n,auth:i,realtime:a,global:o}=e,{db:l,auth:u,realtime:c,global:h}=t,d={db:n8(n8({},l),n),auth:n8(n8({},u),i),realtime:n8(n8({},c),a),storage:{},global:n8(n8(n8({},h),o),{},{headers:n8(n8({},null!=(r=null==h?void 0:h.headers)?r:{}),null!=(s=null==o?void 0:o.headers)?s:{})}),accessToken:async()=>""};return e.accessToken?d.accessToken=e.accessToken:delete d.accessToken,d}(null!=r?r:{},{db:n1,realtime:n5,auth:n8(n8({},n2),{},{storageKey:o}),global:n0});this.storageKey=null!=(s=l.auth.storageKey)?s:"",this.headers=null!=(n=l.global.headers)?n:{},l.accessToken?(this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!=(i=l.auth)?i:{},this.headers,l.global.fetch),this.fetch=((e,t,r)=>{let s=r?(...e)=>r(...e):(...e)=>fetch(...e),n=Headers;return async(r,i)=>{var a;let o=null!=(a=await t())?a:e,l=new n(null==i?void 0:i.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${o}`),s(r,n8(n8({},i),{},{headers:l}))}})(t,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(n8({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&this.accessToken().then(e=>this.realtime.setAuth(e)).catch(e=>console.warn("Failed to set initial Realtime auth token:",e)),this.rest=new rO(new URL("rest/v1",a).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),this.storage=new sP(this.storageUrl.href,this.headers,this.fetch,null==r?void 0:r.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new rv(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,t;if(this.accessToken)return await this.accessToken();let{data:r}=await this.auth.getSession();return null!=(e=null==(t=r.session)?void 0:t.access_token)?e:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,userStorage:n,storageKey:i,flowType:a,lock:o,debug:l,throwOnError:u},c,h){let d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new n3({url:this.authUrl.href,headers:n8(n8({},d),c),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,userStorage:n,flowType:a,lock:o,debug:l,throwOnError:u,fetch:h,hasCustomAuthorizationHeader:Object.keys(this.headers).some(e=>"authorization"===e.toLowerCase())})}_initRealtimeClient(e){return new rG(this.realtimeUrl.href,n8(n8({},e),{},{params:n8(n8({},{apikey:this.supabaseKey}),null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,r){("TOKEN_REFRESHED"===e||"SIGNED_IN"===e)&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0)}};(function(){if("undefined"!=typeof window||void 0===ea.default)return!1;let e=ea.default.version;if(null==e)return!1;let t=e.match(/^v(\d+)\./);return!!t&&18>=parseInt(t[1],10)})()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");var n7=e.i(9156);function ie(){return"undefined"!=typeof window&&void 0!==window.document}n7.parse,n7.serialize;let it={path:"/",sameSite:"lax",httpOnly:!1,maxAge:3456e4},ir=/^(.*)[.](0|[1-9][0-9]*)$/;function is(e,t){if(e===t)return!0;let r=e.match(ir);return!!r&&r[1]===t}function ii(e,t,r){let s=r??3180,n=encodeURIComponent(t);if(n.length<=s)return[{name:e,value:t}];let i=[];for(;n.length>0;){let e=n.slice(0,s),t=e.lastIndexOf("%");t>s-3&&(e=e.slice(0,t));let r="";for(;e.length>0;)try{r=decodeURIComponent(e);break}catch(t){if(t instanceof URIError&&"%"===e.at(-3)&&e.length>3)e=e.slice(0,e.length-3);else throw t}i.push(r),n=n.slice(e.length)}return i.map((t,r)=>({name:`${e}.${r}`,value:t}))}async function ia(e,t){let r=await t(e);if(r)return r;let s=[];for(let r=0;;r++){let n=`${e}.${r}`,i=await t(n);if(!i)break;s.push(i)}return s.length>0?s.join(""):null}let io="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),il=" 	\n\r=".split(""),iu=(()=>{let e=Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<il.length;t+=1)e[il[t].charCodeAt(0)]=-2;for(let t=0;t<io.length;t+=1)e[io[t].charCodeAt(0)]=t;return e})();function ic(e){let t=[],r=0,s=0;if(function(e,t){for(let r=0;r<e.length;r+=1){let s=e.charCodeAt(r);if(s>55295&&s<=56319){let t=(s-55296)*1024&65535;s=(e.charCodeAt(r+1)-56320&65535|t)+65536,r+=1}!function(e,t){if(e<=127)return t(e);if(e<=2047){t(192|e>>6),t(128|63&e);return}if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|63&e);return}if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|63&e);return}throw Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}(s,t)}}(e,e=>{for(r=r<<8|e,s+=8;s>=6;){let e=r>>s-6&63;t.push(io[e]),s-=6}}),s>0)for(r<<=6-s,s=6;s>=6;){let e=r>>s-6&63;t.push(io[e]),s-=6}return t.join("")}function ih(e){let t=[],r=e=>{t.push(String.fromCodePoint(e))},s={utf8seq:0,codepoint:0},n=0,i=0;for(let t=0;t<e.length;t+=1){let a=iu[e.charCodeAt(t)];if(a>-1)for(n=n<<6|a,i+=6;i>=8;)(function(e,t,r){if(0===t.utf8seq){if(e<=127)return r(e);for(let r=1;r<6;r+=1)if((e>>7-r&1)==0){t.utf8seq=r;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else if(4===t.utf8seq)t.codepoint=7&e;else throw Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&r(t.codepoint)}})(n>>i-8&255,s,r),i-=8;else if(-2===a)continue;else throw Error(`Invalid Base64-URL character "${e.at(t)}" at position ${t}`)}return t.join("")}let id="base64-";async function ip({getAll:e,setAll:t,setItems:r,removedItems:s},n){let i=n.cookieEncoding,a=n.cookieOptions??null,o=await e([...r?Object.keys(r):[],...s?Object.keys(s):[]]),l=o?.map(({name:e})=>e)||[],u=Object.keys(s).flatMap(e=>l.filter(t=>is(t,e))),c=Object.keys(r).flatMap(e=>{let t=new Set(l.filter(t=>is(t,e))),s=r[e];"base64url"===i&&(s=id+ic(s));let n=ii(e,s);return n.forEach(e=>{t.delete(e.name)}),u.push(...t),n}),h={...it,...a,maxAge:0},d={...it,...a,maxAge:it.maxAge};delete h.name,delete d.name,await t([...u.map(e=>({name:e,value:"",options:h})),...c.map(({name:e,value:t})=>({name:e,value:t,options:d}))])}if(e.i(52683),void 0!==ea.default&&ea.default.env?.npm_package_name){let e=ea.default.env.npm_package_name;["@supabase/auth-helpers-nextjs","@supabase/auth-helpers-react","@supabase/auth-helpers-remix","@supabase/auth-helpers-sveltekit"].includes(e)&&console.warn(`

   IMPORTANT: Package Consolidation Notice                                
                                                                            
 The ${e.padEnd(35)} package name is deprecated.  
                                                                            
 You are now using @supabase/ssr - a unified solution for all frameworks.  
                                                                            
 The auth-helpers packages have been consolidated into @supabase/ssr       
 to provide better maintenance and consistent APIs across frameworks.      
                                                                            
 Please update your package.json to use @supabase/ssr directly:            
   npm uninstall ${e.padEnd(42)} 
   npm install @supabase/ssr                                               
                                                                            
 For more information, visit:                                              
 https://supabase.com/docs/guides/auth/server-side                         

    `)}var ig=e.i(33550);let im=(0,ig.default)("outline","plus","Plus",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M5 12l14 0",key:"svg-1"}]]),iy=(0,ig.default)("outline","chevron-down","ChevronDown",[["path",{d:"M6 9l6 6l6 -6",key:"svg-0"}]]),iw=(0,ig.default)("outline","chevron-right","ChevronRight",[["path",{d:"M9 6l6 6l-6 6",key:"svg-0"}]]);function iv(){let e=function(e,t,s){let n=ie();if(n&&r)return r;if(!e||!t)throw Error(`@supabase/ssr: Your project's URL and API key are required to create a Supabase client!

Check your Supabase project's API settings to find these values

https://supabase.com/dashboard/project/_/settings/api`);let{storage:i}=function(e,t){let r,s,n=e.cookies??null,i=e.cookieEncoding,a={},o={};if(n)if("get"in n){let e=async e=>{let t=e.flatMap(e=>[e,...Array.from({length:5}).map((t,r)=>`${e}.${r}`)]),r=[];for(let e=0;e<t.length;e+=1){let s=await n.get(t[e]);(s||"string"==typeof s)&&r.push({name:t[e],value:s})}return r};if(r=async t=>await e(t),"set"in n&&"remove"in n)s=async e=>{for(let t=0;t<e.length;t+=1){let{name:r,value:s,options:i}=e[t];s?await n.set(r,s,i):await n.remove(r,i)}};else if(t)s=async()=>{console.warn("@supabase/ssr: createServerClient was configured without set and remove cookie methods, but the client needs to set cookies. This can lead to issues such as random logouts, early session termination or increased token refresh requests. If in NextJS, check your middleware.ts file, route handlers and server actions for correctness. Consider switching to the getAll and setAll cookie methods instead of get, set and remove which are deprecated and can be difficult to use correctly.")};else throw Error("@supabase/ssr: createBrowserClient requires configuring a getAll and setAll cookie method (deprecated: alternatively both get, set and remove can be used)")}else if("getAll"in n)if(r=async()=>await n.getAll(),"setAll"in n)s=n.setAll;else if(t)s=async()=>{console.warn("@supabase/ssr: createServerClient was configured without the setAll cookie method, but the client needs to set cookies. This can lead to issues such as random logouts, early session termination or increased token refresh requests. If in NextJS, check your middleware.ts file, route handlers and server actions for correctness.")};else throw Error("@supabase/ssr: createBrowserClient requires configuring both getAll and setAll cookie methods (deprecated: alternatively both get, set and remove can be used)");else throw Error(`@supabase/ssr: ${t?"createServerClient":"createBrowserClient"} requires configuring getAll and setAll cookie methods (deprecated: alternatively use get, set and remove).${ie()?" As this is called in a browser runtime, consider removing the cookies option object to use the document.cookie API automatically.":""}`);else if(!t&&ie())r=()=>{let e;return Object.keys(e=(0,n7.parse)(document.cookie)).map(t=>({name:t,value:e[t]??""}))},s=e=>{e.forEach(({name:e,value:t,options:r})=>{document.cookie=(0,n7.serialize)(e,t,r)})};else if(t)throw Error("@supabase/ssr: createServerClient must be initialized with cookie options that specify getAll and setAll functions (deprecated, not recommended: alternatively use get, set and remove)");else r=()=>[],s=()=>{throw Error("@supabase/ssr: createBrowserClient in non-browser runtimes (including Next.js pre-rendering mode) was not initialized cookie options that specify getAll and setAll functions (deprecated: alternatively use get, set and remove), but they were needed")};return t?{getAll:r,setAll:s,setItems:a,removedItems:o,storage:{isServer:!0,getItem:async e=>{if("string"==typeof a[e])return a[e];if(o[e])return null;let t=await r([e]),s=await ia(e,async e=>{let r=t?.find(({name:t})=>t===e)||null;return r?r.value:null});if(!s)return null;let n=s;return"string"==typeof s&&s.startsWith(id)&&(n=ih(s.substring(id.length))),n},setItem:async(t,n)=>{t.endsWith("-code-verifier")&&await ip({getAll:r,setAll:s,setItems:{[t]:n},removedItems:{}},{cookieOptions:e?.cookieOptions??null,cookieEncoding:i}),a[t]=n,delete o[t]},removeItem:async e=>{delete a[e],o[e]=!0}}}:{getAll:r,setAll:s,setItems:a,removedItems:o,storage:{isServer:!1,getItem:async e=>{let t=await r([e]),s=await ia(e,async e=>{let r=t?.find(({name:t})=>t===e)||null;return r?r.value:null});if(!s)return null;let n=s;return s.startsWith(id)&&(n=ih(s.substring(id.length))),n},setItem:async(t,n)=>{let a=await r([t]),o=new Set((a?.map(({name:e})=>e)||[]).filter(e=>is(e,t))),l=n;"base64url"===i&&(l=id+ic(n));let u=ii(t,l);u.forEach(({name:e})=>{o.delete(e)});let c={...it,...e?.cookieOptions,maxAge:0},h={...it,...e?.cookieOptions,maxAge:it.maxAge};delete c.name,delete h.name;let d=[...[...o].map(e=>({name:e,value:"",options:c})),...u.map(({name:e,value:t})=>({name:e,value:t,options:h}))];d.length>0&&await s(d)},removeItem:async t=>{let n=await r([t]),i=(n?.map(({name:e})=>e)||[]).filter(e=>is(e,t)),a={...it,...e?.cookieOptions,maxAge:0};delete a.name,i.length>0&&await s(i.map(e=>({name:e,value:"",options:a})))}}}}({...void 0,cookieEncoding:(void 0)??"base64url"},!1),a=new n9(e,t,{...void 0,global:{...void 0,headers:{...void 0,"X-Client-Info":"supabase-ssr/0.8.0 createBrowserClient"}},auth:{...void 0,...null,flowType:"pkce",autoRefreshToken:ie(),detectSessionInUrl:ie(),persistSession:!0,storage:i,...null}});return n&&(r=a),a}("https://asdegiubqpjnxebtznot.supabase.co","sb_publishable_WrhLcsN8S2iSPRAyOo-u5Q_qNmSta9m"),[t,s]=(0,D.useState)([]),[n,i]=(0,D.useState)([]),[a,o]=(0,D.useState)(!1),[l,{open:u,close:c}]=(0,rp.useDisclosure)(!1),[h,{open:d,close:f}]=(0,rp.useDisclosure)(!1),[p,g]=(0,D.useState)({name:"",color:"",price:0}),[m,y]=(0,D.useState)({productId:"",label:"",quantity:0}),[w,v]=(0,D.useState)(null),b=(0,D.useCallback)(async()=>{let{data:t}=await e.from("products").select("*").order("created_at",{ascending:!1}),{data:r}=await e.from("inventory_rolls").select("*").order("created_at",{ascending:!0});t&&s(t),r&&i(r)},[e]);(0,D.useEffect)(()=>{b()},[b]);let _=async()=>{o(!0);let{error:t}=await e.from("products").insert({name:p.name,color:p.color,price_per_yard:p.price});t?alert(t.message):(await b(),c(),g({name:"",color:"",price:0})),o(!1)},S=async()=>{if(!m.productId)return;o(!0);let{error:t}=await e.from("inventory_rolls").insert({product_id:m.productId,roll_label:m.label,quantity_yards:m.quantity,status:"active"});t?alert(t.message):(await b(),f(),y(e=>({...e,label:"",quantity:0}))),o(!1)};return(0,U.jsxs)(B.Container,{size:"xl",py:"xl",children:[(0,U.jsxs)(V.Group,{justify:"space-between",mb:"lg",children:[(0,U.jsx)(L.Title,{order:2,children:"Inventory & Rolls"}),(0,U.jsx)(M.Button,{onClick:u,leftSection:(0,U.jsx)(im,{size:16}),children:"New Product"})]}),(0,U.jsx)(rd,{withBorder:!0,radius:"md",p:"md",children:(0,U.jsxs)(q.Table,{stickyHeader:!0,children:[(0,U.jsx)(q.Table.Thead,{children:(0,U.jsxs)(q.Table.Tr,{children:[(0,U.jsx)(q.Table.Th,{w:50}),(0,U.jsx)(q.Table.Th,{children:"Product Name"}),(0,U.jsx)(q.Table.Th,{children:"Color"}),(0,U.jsx)(q.Table.Th,{children:"Price / Yd"}),(0,U.jsx)(q.Table.Th,{children:"Total Stock"}),(0,U.jsx)(q.Table.Th,{style:{textAlign:"right"},children:"Action"})]})}),(0,U.jsx)(q.Table.Tbody,{children:t.map(e=>{let t=n.filter(t=>t.product_id===e.id),r=t.reduce((e,t)=>e+Number(t.quantity_yards),0),s=w===e.id;return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsxs)(q.Table.Tr,{bg:s?"var(--mantine-color-gray-0)":void 0,children:[(0,U.jsx)(q.Table.Td,{children:(0,U.jsx)(ra.ActionIcon,{variant:"subtle",size:"sm",onClick:()=>v(s?null:e.id),children:s?(0,U.jsx)(iy,{size:16}):(0,U.jsx)(iw,{size:16})})}),(0,U.jsx)(q.Table.Td,{fw:500,children:e.name}),(0,U.jsx)(q.Table.Td,{children:e.color}),(0,U.jsxs)(q.Table.Td,{children:[e.price_per_yard.toLocaleString()," "]}),(0,U.jsxs)(q.Table.Td,{children:[(0,U.jsxs)(ri,{color:r>0?"blue":"gray",children:[r," yds"]}),(0,U.jsxs)(rf.Text,{span:!0,size:"xs",c:"dimmed",ml:"xs",children:["(",t.length," rolls)"]})]}),(0,U.jsx)(q.Table.Td,{style:{textAlign:"right"},children:(0,U.jsx)(M.Button,{size:"xs",variant:"light",onClick:()=>{y({productId:e.id,label:"",quantity:0}),d()},children:"+ Add Roll"})})]},e.id),s&&(0,U.jsx)(q.Table.Tr,{children:(0,U.jsx)(q.Table.Td,{colSpan:6,p:0,children:(0,U.jsxs)("div",{style:{padding:"10px 20px",backgroundColor:"var(--mantine-color-gray-0)"},children:[(0,U.jsx)(L.Title,{order:6,mb:"xs",children:"Rolls Inventory"}),0===t.length?(0,U.jsx)(rf.Text,{c:"dimmed",size:"sm",children:"No rolls registered. Add one to start selling."}):(0,U.jsx)(V.Group,{gap:"sm",children:t.map(e=>(0,U.jsxs)(rd,{shadow:"sm",padding:"xs",radius:"md",withBorder:!0,w:120,children:[(0,U.jsx)(rf.Text,{fw:700,size:"sm",children:e.roll_label}),(0,U.jsxs)(rf.Text,{size:"xs",c:"dimmed",children:[Number(e.quantity_yards)," yds"]}),(0,U.jsx)(ri,{size:"xs",color:"active"===e.status?"teal":"gray",mt:5,children:e.status})]},e.id))})]})})})]})})})]})}),(0,U.jsxs)(t_,{opened:l,onClose:c,title:"Register New Fabric",children:[(0,U.jsx)(tS.TextInput,{label:"Fabric Name",placeholder:"e.g. Linen 100%",required:!0,mb:"sm",value:p.name,onChange:e=>g({...p,name:e.currentTarget.value})}),(0,U.jsx)(tS.TextInput,{label:"Color / Pattern",placeholder:"e.g. Beige Check",required:!0,mb:"sm",value:p.color,onChange:e=>g({...p,color:e.currentTarget.value})}),(0,U.jsx)(re,{label:"Base Price (per yard)",required:!0,mb:"lg",value:p.price,onChange:e=>g({...p,price:Number(e)})}),(0,U.jsx)(M.Button,{fullWidth:!0,onClick:_,loading:a,children:"Save Product"})]}),(0,U.jsxs)(t_,{opened:h,onClose:f,title:"Stock In (Add Roll)",children:[(0,U.jsx)(tS.TextInput,{label:"Roll Label/Number",placeholder:"e.g. #A-102",required:!0,mb:"sm",value:m.label,onChange:e=>y({...m,label:e.currentTarget.value})}),(0,U.jsx)(re,{label:"Yards Amount",placeholder:"50",required:!0,mb:"lg",value:m.quantity,onChange:e=>y({...m,quantity:Number(e)})}),(0,U.jsx)(M.Button,{fullWidth:!0,onClick:S,loading:a,children:"confirm Stock In"})]})]})}e.s(["default",()=>iv],80613)}]);