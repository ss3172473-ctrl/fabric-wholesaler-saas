[
  {
    "projectId": "4b7395b6-c4a5-4dc9-821a-0f7b24b12e0a",
    "testId": "bcedbe21-cfd1-45b8-8b52-a69e34957dd0",
    "userId": "7418f4d8-e091-70c7-c7fc-08cbb7f25950",
    "title": "TC001-user login with valid credentials",
    "description": "Test the /login endpoint to verify that a user can successfully authenticate using valid email and password credentials via Supabase Auth.",
    "code": "import requests\n\ndef test_user_login_with_valid_credentials():\n    base_url = \"http://localhost:3000\"\n    login_url = f\"{base_url}/login\"\n    timeout = 30\n\n    # Valid credentials for testing - replace with actual valid test user credentials\n    email = \"testuser@example.com\"\n    password = \"SecureP@ssw0rd!\"\n\n    data = {\n        \"email\": email,\n        \"password\": password\n    }\n\n    headers = {\n        \"Content-Type\": \"multipart/form-data\"\n    }\n\n    try:\n        response = requests.post(login_url, data=data, headers=headers, timeout=timeout)\n    except requests.RequestException as e:\n        assert False, f\"Request to /login failed: {e}\"\n\n    assert response.status_code == 200, f\"Expected status code 200, got {response.status_code}\"\n\n    # Assuming success response contains JSON with user data and access token\n    try:\n        resp_json = response.json()\n    except ValueError:\n        assert False, \"Response is not valid JSON\"\n\n    assert \"access_token\" in resp_json, \"Response JSON does not contain access_token\"\n    assert \"user\" in resp_json, \"Response JSON does not contain user information\"\n    assert resp_json[\"user\"].get(\"email\") == email, \"Logged in user email does not match\"\n\ntest_user_login_with_valid_credentials()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 38, in <module>\n  File \"<string>\", line 26, in test_user_login_with_valid_credentials\nAssertionError: Expected status code 200, got 500\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-12-23T12:42:58.077Z",
    "modified": "2025-12-23T12:43:43.224Z"
  },
  {
    "projectId": "4b7395b6-c4a5-4dc9-821a-0f7b24b12e0a",
    "testId": "93e8af2d-fd52-493b-9e74-294a3283c6e7",
    "userId": "7418f4d8-e091-70c7-c7fc-08cbb7f25950",
    "title": "TC002-admin create customer with valid data",
    "description": "Test the /admin/customers/create endpoint to ensure that an admin can create a new customer account by providing all required fields including email, password, name, company, and phone.",
    "code": "import requests\nfrom requests.exceptions import RequestException\nfrom datetime import datetime\nimport random\nimport string\n\nBASE_URL = \"http://localhost:3000\"\nTIMEOUT = 30\n\ndef random_email():\n    return f\"testadmin+{''.join(random.choices(string.ascii_lowercase+string.digits, k=8))}@example.com\"\n\ndef test_admin_create_customer_with_valid_data():\n    url = f\"{BASE_URL}/admin/customers/create\"\n    # Create a unique email to avoid conflicts\n    email = random_email()\n    password = \"StrongP@ssw0rd!\"\n    name = \"Test Admin Customer\"\n    company = \"Test Company Inc.\"\n    phone = \"+1234567890\"\n\n    # Prepare multipart/form-data payload\n    # requests can handle multipart/form-data by passing dict to 'files' or 'data' param,\n    # but to mimic multipart/form-data and avoid FormData issues, we use 'files' param with tuples.\n    # Since no files are uploaded, just send data as tuples.\n\n    payload = {\n        'email': (None, email),\n        'password': (None, password),\n        'name': (None, name),\n        'company': (None, company),\n        'phone': (None, phone)\n    }\n\n    created_customer_id = None\n\n    try:\n        response = requests.post(url, files=payload, timeout=TIMEOUT)\n    except RequestException as e:\n        assert False, f\"Request to create customer failed: {e}\"\n\n    # Assert successful status code (201 Created or 200 OK)\n    assert response.status_code in (200, 201), f\"Unexpected status code: {response.status_code}, Response: {response.text}\"\n\n    # Parse response json\n    try:\n        resp_json = response.json()\n    except Exception:\n        assert False, f\"Response is not valid JSON: {response.text}\"\n\n    # The PRD does not describe response schema, but normally new resource id is returned.\n    # We try common keys and presence of customer data to validate success.\n\n    # Check for expected fields or success indicator\n    assert 'email' in resp_json and resp_json['email'] == email, f\"Response email mismatch or missing. Got: {resp_json}\"\n    # Optionally extract customer ID if available for deletion\n    if 'id' in resp_json:\n        created_customer_id = resp_json['id']\n\n    # If no explicit ID, try common alternatives\n    if not created_customer_id and 'customerId' in resp_json:\n        created_customer_id = resp_json['customerId']\n\n    # Cleanup - attempt to delete created customer if deletion endpoint exists\n    # As PRD doesn't specify a deletion API, handle only if possible.\n    if created_customer_id:\n        delete_url = f\"{BASE_URL}/admin/customers/{created_customer_id}\"\n        try:\n            del_resp = requests.delete(delete_url, timeout=TIMEOUT)\n            # We tolerate any status code for deletion; just log errors if any\n        except Exception:\n            pass\n\ntest_admin_create_customer_with_valid_data()",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 74, in <module>\n  File \"<string>\", line 43, in test_admin_create_customer_with_valid_data\nAssertionError: Unexpected status code: 500, Response: <!DOCTYPE html><html><head><meta charSet=\"utf-8\" data-next-head=\"\"/><meta name=\"viewport\" content=\"width=device-width\" data-next-head=\"\"/><style data-next-hide-fouc=\"true\">body{display:none}</style><noscript data-next-hide-fouc=\"true\"><style>body{display:block}</style></noscript><noscript data-n-css=\"\"></noscript><script defer=\"\" noModule=\"\" src=\"/_next/static/chunks/node_modules_next_dist_build_polyfills_polyfill-nomodule.js\"></script><script src=\"/_next/static/chunks/node_modules_next_dist_compiled_8ca6b690._.js\" defer=\"\"></script><script src=\"/_next/static/chunks/node_modules_next_dist_shared_lib_8bac8163._.js\" defer=\"\"></script><script src=\"/_next/static/chunks/node_modules_next_dist_client_5a8a528e._.js\" defer=\"\"></script><script src=\"/_next/static/chunks/node_modules_next_dist_b3fb3b5f._.js\" defer=\"\"></script><script src=\"/_next/static/chunks/node_modules_next_app_72f3d36f.js\" defer=\"\"></script><script src=\"/_next/static/chunks/%5Bnext%5D_entry_page-loader_ts_742e4b53._.js\" defer=\"\"></script><script src=\"/_next/static/chunks/node_modules_react-dom_4411d9bd._.js\" defer=\"\"></script><script src=\"/_next/static/chunks/node_modules_7f09fef0._.js\" defer=\"\"></script><script src=\"/_next/static/chunks/%5Broot-of-the-server%5D__45f039c3._.js\" defer=\"\"></script><script src=\"/_next/static/chunks/pages__app_2da965e7._.js\" defer=\"\"></script><script src=\"/_next/static/chunks/turbopack-pages__app_0fce199e._.js\" defer=\"\"></script><script src=\"/_next/static/chunks/node_modules_next_dist_shared_lib_9a2a7093._.js\" defer=\"\"></script><script src=\"/_next/static/chunks/node_modules_next_dist_a183fb77._.js\" defer=\"\"></script><script src=\"/_next/static/chunks/node_modules_next_error_1cfbb379.js\" defer=\"\"></script><script src=\"/_next/static/chunks/%5Bnext%5D_entry_page-loader_ts_43b523b5._.js\" defer=\"\"></script><script src=\"/_next/static/chunks/%5Broot-of-the-server%5D__092393de._.js\" defer=\"\"></script><script src=\"/_next/static/chunks/pages__error_2da965e7._.js\" defer=\"\"></script><script src=\"/_next/static/chunks/turbopack-pages__error_af01c4e3._.js\" defer=\"\"></script><script src=\"/_next/static/development/_ssgManifest.js\" defer=\"\"></script><script src=\"/_next/static/development/_buildManifest.js\" defer=\"\"></script><noscript id=\"__next_css__DO_NOT_USE__\"></noscript></head><body><div id=\"__next\"></div><script id=\"__NEXT_DATA__\" type=\"application/json\">{\"props\":{\"pageProps\":{\"statusCode\":500,\"hostname\":\"localhost\"}},\"page\":\"/_error\",\"query\":{},\"buildId\":\"development\",\"isFallback\":false,\"err\":{\"name\":\"Error\",\"source\":\"server\",\"message\":\"Failed to find Server Action. This request might be from an older or newer deployment.\\nRead more: https://nextjs.org/docs/messages/failed-to-find-server-action\",\"stack\":\"Error: Failed to find Server Action. This request might be from an older or newer deployment.\\nRead more: https://nextjs.org/docs/messages/failed-to-find-server-action\\n    at /Users/leesungjun/영진 장부처리 자동화/node_modules/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js:35:2378\\n    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)\\n    at async handleAction (/Users/leesungjun/영진 장부처리 자동화/node_modules/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js:34:23598)\\n    at async renderToHTMLOrFlightImpl (/Users/leesungjun/영진 장부처리 자동화/node_modules/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js:41:42106)\\n    at async doRender (/Users/leesungjun/영진 장부처리 자동화/.next/dev/server/chunks/ssr/node_modules_next_dist_f8f5a377._.js:2934:28)\\n    at async AppPageRouteModule.handleResponse (/Users/leesungjun/영진 장부처리 자동화/node_modules/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js:43:64241)\\n    at async handleResponse (/Users/leesungjun/영진 장부처리 자동화/.next/dev/server/chunks/ssr/node_modules_next_dist_f8f5a377._.js:3140:32)\\n    at async Module.handler (/Users/leesungjun/영진 장부처리 자동화/.next/dev/server/chunks/ssr/node_modules_next_dist_f8f5a377._.js:3511:20)\\n    at async DevServer.renderToResponseWithComponentsImpl (/Users/leesungjun/영진 장부처리 자동화/node_modules/next/dist/server/base-server.js:1422:9)\\n    at async DevServer.renderPageComponent (/Users/leesungjun/영진 장부처리 자동화/node_modules/next/dist/server/base-server.js:1474:24)\\n    at async DevServer.renderToResponseImpl (/Users/leesungjun/영진 장부처리 자동화/node_modules/next/dist/server/base-server.js:1524:32)\\n    at async DevServer.pipeImpl (/Users/leesungjun/영진 장부처리 자동화/node_modules/next/dist/server/base-server.js:1018:25)\\n    at async NextNodeServer.handleCatchallRenderRequest (/Users/leesungjun/영진 장부처리 자동화/node_modules/next/dist/server/next-server.js:395:17)\\n    at async DevServer.handleRequestImpl (/Users/leesungjun/영진 장부처리 자동화/node_modules/next/dist/server/base-server.js:909:17)\\n    at async /Users/leesungjun/영진 장부처리 자동화/node_modules/next/dist/server/dev/next-dev-server.js:387:20\\n    at async Span.traceAsyncFn (/Users/leesungjun/영진 장부처리 자동화/node_modules/next/dist/trace/trace.js:157:20)\\n    at async DevServer.handleRequest (/Users/leesungjun/영진 장부처리 자동화/node_modules/next/dist/server/dev/next-dev-server.js:383:24)\\n    at async invokeRender (/Users/leesungjun/영진 장부처리 자동화/node_modules/next/dist/server/lib/router-server.js:248:21)\\n    at async handleRequest (/Users/leesungjun/영진 장부처리 자동화/node_modules/next/dist/server/lib/router-server.js:447:24)\\n    at async requestHandlerImpl (/Users/leesungjun/영진 장부처리 자동화/node_modules/next/dist/server/lib/router-server.js:496:13)\\n    at async Server.requestListener (/Users/leesungjun/영진 장부처리 자동화/node_modules/next/dist/server/lib/start-server.js:226:13)\"},\"gip\":true,\"scriptLoader\":[]}</script></body></html>\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-12-23T12:42:58.085Z",
    "modified": "2025-12-23T12:43:35.049Z"
  },
  {
    "projectId": "4b7395b6-c4a5-4dc9-821a-0f7b24b12e0a",
    "testId": "6554581f-acdf-46e9-9603-75e31c1a6b7b",
    "userId": "7418f4d8-e091-70c7-c7fc-08cbb7f25950",
    "title": "TC003-customer place order with multiple fabric rolls",
    "description": "Test the /shop/order endpoint to verify that a customer can place an order containing multiple fabric roll items, each with productId, quantity, and price, and optionally include a note.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:3000\"\nTIMEOUT = 30\n\n# Mock user credentials for login\nUSER_EMAIL = \"testuser@example.com\"\nUSER_PASSWORD = \"TestPassword123!\"\n\n# Mock admin credentials for creating a product\nADMIN_EMAIL = \"admin@example.com\"\nADMIN_PASSWORD = \"AdminPassword123!\"\n\n# Headers for JSON requests\nHEADERS_JSON = {\n    \"Content-Type\": \"application/json\"\n}\n\ndef test_customer_place_order_with_multiple_fabric_rolls():\n    # 1. Login: get user auth token (simulate Supabase auth)\n    login_url = f\"{BASE_URL}/login\"\n    login_files = [\n        (\"email\", USER_EMAIL),\n        (\"password\", USER_PASSWORD)\n    ]\n    resp_login = requests.post(login_url, files=login_files, timeout=TIMEOUT)\n    assert resp_login.status_code == 200, f\"Login failed with status {resp_login.status_code}\"\n    login_json = resp_login.json()\n    assert \"access_token\" in login_json, \"No access_token in login response\"\n    access_token = login_json[\"access_token\"]\n    auth_headers = {\n        \"Authorization\": f\"Bearer {access_token}\",\n        \"Content-Type\": \"application/json\"\n    }\n\n    # 2. Inventory: create two fabric roll products\n    # Assuming an authenticated admin endpoint available at /admin/inventory/create (not explicitly given, we mock creation)\n    # Since inventory creation logic is to be verified (mock/ or check page logic), we'll create products via admin customer creation syntax if possible, else skip actual product create.\n    # But PRD mentions inventory management API not explicitly present - we will assume an endpoint exists:\n    inventory_create_url = f\"{BASE_URL}/admin/inventory/create\"\n    product1_payload = {\n        \"name\": \"Fabric Roll A\",\n        \"description\": \"High quality cotton fabric roll\",\n        \"price\": 25.50,\n        \"stock\": 100\n    }\n    product2_payload = {\n        \"name\": \"Fabric Roll B\",\n        \"description\": \"Premium linen fabric roll\",\n        \"price\": 40.00,\n        \"stock\": 50\n    }\n\n    # For admin authentication, login admin user\n    admin_login_files = [\n        (\"email\", ADMIN_EMAIL),\n        (\"password\", ADMIN_PASSWORD)\n    ]\n    admin_login_resp = requests.post(login_url, files=admin_login_files, timeout=TIMEOUT)\n    assert admin_login_resp.status_code == 200, \"Admin login failed\"\n    admin_token = admin_login_resp.json().get(\"access_token\")\n    assert admin_token, \"No admin access_token\"\n    admin_headers = {\n        \"Authorization\": f\"Bearer {admin_token}\",\n        \"Content-Type\": \"application/json\"\n    }\n\n    product_ids = []\n    try:\n        # Create product 1\n        resp_product1 = requests.post(inventory_create_url, json=product1_payload, headers=admin_headers, timeout=TIMEOUT)\n        assert resp_product1.status_code == 201, f\"Failed to create product1, status {resp_product1.status_code}\"\n        product1_data = resp_product1.json()\n        product_id_1 = product1_data.get(\"id\")\n        assert product_id_1, \"No product1 id returned\"\n        product_ids.append(product_id_1)\n\n        # Create product 2\n        resp_product2 = requests.post(inventory_create_url, json=product2_payload, headers=admin_headers, timeout=TIMEOUT)\n        assert resp_product2.status_code == 201, f\"Failed to create product2, status {resp_product2.status_code}\"\n        product2_data = resp_product2.json()\n        product_id_2 = product2_data.get(\"id\")\n        assert product_id_2, \"No product2 id returned\"\n        product_ids.append(product_id_2)\n\n        # 3. Shop Order: place order with multiple items (using the products created)\n        order_url = f\"{BASE_URL}/shop/order\"\n        order_payload = {\n            \"items\": [\n                {\n                    \"productId\": product_id_1,\n                    \"quantity\": 3,\n                    \"price\": product1_payload[\"price\"]\n                },\n                {\n                    \"productId\": product_id_2,\n                    \"quantity\": 2,\n                    \"price\": product2_payload[\"price\"]\n                }\n            ],\n            \"note\": \"Please deliver between 9 AM and 5 PM\"\n        }\n\n        resp_order = requests.post(order_url, json=order_payload, headers=auth_headers, timeout=TIMEOUT)\n        assert resp_order.status_code == 201, f\"Order creation failed with status {resp_order.status_code}\"\n        order_resp_json = resp_order.json()\n        assert \"orderId\" in order_resp_json, \"No orderId in order response\"\n        order_id = order_resp_json[\"orderId\"]\n\n        # 4. Order Approval: simulate admin approval of order\n        # Assume endpoint /admin/orders/{order_id}/approve with POST to approve\n        approve_url = f\"{BASE_URL}/admin/orders/{order_id}/approve\"\n        resp_approve = requests.post(approve_url, headers=admin_headers, timeout=TIMEOUT)\n        assert resp_approve.status_code == 200, f\"Order approval failed with status {resp_approve.status_code}\"\n        approve_json = resp_approve.json()\n        assert approve_json.get(\"status\") == \"approved\", \"Order status is not approved after approval\"\n\n        # 5. Settlement: verify settlement calculation\n        # Assume endpoint /admin/settlements/calculate that returns settlement data for approved orders\n        settlement_url = f\"{BASE_URL}/admin/settlements/calculate\"\n        resp_settlement = requests.get(settlement_url, headers=admin_headers, timeout=TIMEOUT)\n        assert resp_settlement.status_code == 200, f\"Settlement calculation failed with status {resp_settlement.status_code}\"\n        settlement_data = resp_settlement.json()\n        # Check that the recently approved order amount is included in settlement results\n        order_amount = (product1_payload[\"price\"] * 3) + (product2_payload[\"price\"] * 2)\n        orders_in_settlement = settlement_data.get(\"orders\", [])\n        found_order = False\n        for o in orders_in_settlement:\n            if o.get(\"orderId\") == order_id and abs(o.get(\"totalAmount\", 0) - order_amount) < 0.01:\n                found_order = True\n                break\n        assert found_order, \"Approved order not found or total amount mismatch in settlement data\"\n\n    finally:\n        # Cleanup: delete created products and order if possible\n        # Delete order - assume DELETE /admin/orders/{order_id}\n        if 'order_id' in locals():\n            requests.delete(f\"{BASE_URL}/admin/orders/{order_id}\", headers=admin_headers, timeout=TIMEOUT)\n        for pid in product_ids:\n            requests.delete(f\"{BASE_URL}/admin/inventory/{pid}\", headers=admin_headers, timeout=TIMEOUT)\n\ntest_customer_place_order_with_multiple_fabric_rolls()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 142, in <module>\n  File \"<string>\", line 27, in test_customer_place_order_with_multiple_fabric_rolls\nAssertionError: Login failed with status 500\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-12-23T12:42:58.090Z",
    "modified": "2025-12-23T12:44:33.499Z"
  }
]
